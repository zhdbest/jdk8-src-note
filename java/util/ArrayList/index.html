<!DOCTYPE html>
<html
  lang="zh-cn"
  class="color-toggle-hidden"
  
>
  <head>
    <meta charset="UTF-8" />
<meta name="referrer" content="no-referrer" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<meta name="color-scheme" content="light dark" />
<meta name="generator" content="Hugo 0.127.0">


  <meta name="description" content="1. private static final long serialVersionUID = 8683452581122892189L; 2. private static final int DEFAULT_CAPACITY = 10; 3. private static final Object[] EMPTY_ELEMENTDATA = {}; 4. private static final Object[] DEFAULTCAPACITY_EMPTY_ELEMENTDATA = {}; 5. transient Object[] elementData; 6. private int size; 7. public ArrayList(int initialCapacity) 8. public ArrayList() 9. public ArrayList(Collection&lt;? extends E&gt; c) 10. public void trimToSize() 11. public void ensureCapacity(int minCapacity) 12. private static int calculateCapacity(Object[] elementData, int minCapacity) 13." />

    <title>ArrayList | JDK8源码阅读笔记</title>

    <link rel="icon" type="image/svg+xml" href="/jdk8-src-note/favicon/favicon.svg" />
<link
  rel="icon"
  type="image/png"
  sizes="32x32"
  href="/jdk8-src-note/favicon/favicon-32x32.png"
/>
<link
  rel="icon"
  type="image/png"
  sizes="16x16"
  href="/jdk8-src-note/favicon/favicon-16x16.png"
/>

    

    
  <meta
    property="og:title"
    content="ArrayList"
  />
  <meta property="og:site_name" content="JDK8源码阅读笔记" />
  <meta property="og:description" content="1. private static final long serialVersionUID = 8683452581122892189L; 2. private static final int DEFAULT_CAPACITY = 10; 3. private static final Object[] EMPTY_ELEMENTDATA = {}; 4. private static final Object[] DEFAULTCAPACITY_EMPTY_ELEMENTDATA = {}; 5. transient Object[] elementData; 6. private int size; 7. public ArrayList(int initialCapacity) 8. public ArrayList() 9. public ArrayList(Collection&lt;? extends E&gt; c) 10. public void trimToSize() 11. public void ensureCapacity(int minCapacity) 12. private static int calculateCapacity(Object[] elementData, int minCapacity) 13." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://hongmao.run/jdk8-src-note/java/util/ArrayList/" />

<meta property="article:section" content="Java" />
    <meta
      property="article:published_time"
      content="2021-09-05T10:17:35+08:00"
    />
    <meta
      property="article:modified_time"
      content="2021-09-05T10:17:35+08:00"
    />


  <meta name="twitter:card" content="summary" />
<meta name="twitter:title" content="ArrayList" />
  <meta name="twitter:description" content="1. private static final long serialVersionUID = 8683452581122892189L; 2. private static final int DEFAULT_CAPACITY = 10; 3. private static final Object[] EMPTY_ELEMENTDATA = {}; 4. private static final Object[] DEFAULTCAPACITY_EMPTY_ELEMENTDATA = {}; 5. transient Object[] elementData; 6. private int size; 7. public ArrayList(int initialCapacity) 8. public ArrayList() 9. public ArrayList(Collection&lt;? extends E&gt; c) 10. public void trimToSize() 11. public void ensureCapacity(int minCapacity) 12. private static int calculateCapacity(Object[] elementData, int minCapacity) 13." />


  <script type="application/ld+json">
  {
      "@context": "http://schema.org",
      "@type": "TechArticle",
      "articleSection": "Java",
      "name": "ArrayList",
      "url" : "https://hongmao.run/jdk8-src-note/java/util/ArrayList/",
      "headline": "ArrayList",
      "description": "1. private static final long serialVersionUID = 8683452581122892189L; 2. private static final int DEFAULT_CAPACITY = 10; 3. private static final Object[] EMPTY_ELEMENTDATA = {}; 4. private static final Object[] DEFAULTCAPACITY_EMPTY_ELEMENTDATA = {}; 5. transient Object[] elementData; 6. private int size; 7. public ArrayList(int initialCapacity) 8. public ArrayList() 9. public ArrayList(Collection\u003c? extends E\u003e c) 10. public void trimToSize() 11. public void ensureCapacity(int minCapacity) 12. private static int calculateCapacity(Object[] elementData, int minCapacity) 13.",
      "wordCount" : "4954",
      "inLanguage": "zh-cn",
      "isFamilyFriendly": "true",
      "mainEntityOfPage": {
          "@type": "WebPage",
          "@id": "https://hongmao.run/jdk8-src-note/java/util/ArrayList/"
      },
      "copyrightHolder" : "JDK8源码阅读笔记",
      "copyrightYear" : "2021",
      "dateCreated": "2021-09-05T10:17:35.00Z",
      "datePublished": "2021-09-05T10:17:35.00Z",
      "dateModified": "2021-09-05T10:17:35.00Z",
      "publisher":{
          "@type":"Organization",
          "name": "JDK8源码阅读笔记",
          "url": "https://hongmao.run/jdk8-src-note/",
          "logo": {
              "@type": "ImageObject",
              "url": "https://hongmao.run/jdk8-src-note/brand.svg",
              "width":"32",
              "height":"32"
          }
      }
  }
  </script>


    
  <script src="/jdk8-src-note/js/colortheme-5cd55a83.bundle.min.js"></script>
<script src="/jdk8-src-note/js/main-09678822.bundle.min.js"></script>

<link
  rel="preload"
  as="font"
  href="/jdk8-src-note/fonts/Metropolis.woff2"
  type="font/woff2"
  crossorigin="anonymous"
/>
<link
  rel="preload"
  as="font"
  href="/jdk8-src-note/fonts/LiberationSans.woff2"
  type="font/woff2"
  crossorigin="anonymous"
/>

<link
  rel="preload"
  href="/jdk8-src-note/main-a559ecaa.min.css"
  as="style"
/>
<link
  rel="stylesheet"
  href="/jdk8-src-note/main-a559ecaa.min.css"
  media="all"
/>

<link
  rel="preload"
  href="/jdk8-src-note/mobile-79ddc617.min.css"
  as="style"
/>
<link
  rel="stylesheet"
  href="/jdk8-src-note/mobile-79ddc617.min.css"
  media="screen and (max-width: 45rem)"
/>

<link
  rel="preload"
  href="/jdk8-src-note/print-735ccc12.min.css"
  as="style"
/>
<link
  rel="stylesheet"
  href="/jdk8-src-note/print-735ccc12.min.css"
  media="print"
/>

<link
  rel="preload"
  href="/jdk8-src-note/custom.css"
  as="style"
/>
<link
  rel="stylesheet"
  href="/jdk8-src-note/custom.css"
  media="all"
/>
  <link href="https://hongmao.run/jdk8-src-note/java/util/ArrayList/" rel="canonical" type="text/html" />

<!-- Made with Geekdoc theme https://github.com/thegeeklab/hugo-geekdoc -->

    

  </head>

  <body itemscope itemtype="https://schema.org/WebPage">
    
  <!-- geekdoc include: /sprites/abstractClass.svg -->
  <!-- Copyright 2000-2022 JetBrains s.r.o. and contributors. Use of this source code is governed by the Apache 2.0 license. -->
<svg id="abstractClass" class="svg-sprite" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg">
<path d="M12.9497 3.05025C15.6834 5.78392 15.6834 10.2161 12.9497 12.9497C10.216 15.6834 5.78388 15.6834 3.05021 12.9497C0.316541 10.2161 0.316541 5.78392 3.05021 3.05025C5.78388 0.316583 10.216 0.316583 12.9497 3.05025Z" fill="#E7EFFD"/>
<path fill-rule="evenodd" clip-rule="evenodd" d="M14.9143 6.90481L13.9264 7.06045C13.7359 5.85124 13.1755 4.69027 12.2426 3.75736C11.3097 2.82445 10.1487 2.26404 8.93951 2.07352L9.09515 1.0857C10.5062 1.30802 11.8623 1.96287 12.9497 3.05025C14.0371 4.13763 14.6919 5.49375 14.9143 6.90481ZM6.90477 1.0857L7.06041 2.07352C5.8512 2.26404 4.69023 2.82445 3.75732 3.75736C2.82441 4.69027 2.26399 5.85124 2.07348 7.06045L1.08566 6.90481C1.30798 5.49375 1.96283 4.13763 3.05021 3.05025C4.13759 1.96287 5.49371 1.30802 6.90477 1.0857ZM1.08566 9.09519C1.30798 10.5063 1.96283 11.8624 3.05021 12.9497C4.13759 14.0371 5.49371 14.692 6.90477 14.9143L7.0604 13.9265C5.8512 13.736 4.69023 13.1755 3.75732 12.2426C2.82441 11.3097 2.26399 10.1488 2.07348 8.93955L1.08566 9.09519ZM9.09515 14.9143L8.93951 13.9265C10.1487 13.736 11.3097 13.1755 12.2426 12.2426C13.1755 11.3097 13.7359 10.1488 13.9264 8.93955L14.9143 9.09519C14.6919 10.5063 14.0371 11.8624 12.9497 12.9497C11.8623 14.0371 10.5062 14.692 9.09515 14.9143Z" fill="#3574F0"/>
<path d="M8.13295 11.5C9.61223 11.5 10.8836 10.6105 11.2075 9.33909H10.2213C9.90229 10.0739 9.11914 10.6057 8.13295 10.6057C6.77936 10.6057 5.80284 9.51796 5.80284 8C5.80284 6.48204 6.77936 5.39434 8.13295 5.39434C9.11914 5.39434 9.90229 5.92611 10.2213 6.66091H11.2075C10.8836 5.3895 9.61223 4.5 8.13295 4.5C6.21859 4.5 4.79248 5.99378 4.79248 8C4.79248 10.0062 6.21859 11.5 8.13295 11.5Z" fill="#3574F0"/>
</svg>


  <!-- geekdoc include: /sprites/annotation.svg -->
  <!-- Copyright 2000-2023 JetBrains s.r.o. and contributors. Use of this source code is governed by the Apache 2.0 license. -->
<svg id="annotation" class="svg-sprite" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg">
<circle cx="8" cy="8" r="7" fill="#F2FCF3"/>
<path d="M9.72989 5.38506V6.35862H9.70012C9.35494 5.69 8.71609 5.3046 7.87126 5.3046C6.38276 5.3046 5.26437 6.47931 5.26437 8.04023C5.26437 9.60115 6.38276 10.7759 7.87126 10.7759C8.81103 10.7759 9.58828 10.339 10.0026 9.65425C10.442 10.3357 11.2602 10.7517 12.2885 10.7517C13.9218 10.7517 15 9.60115 15 7.91954C15 4.11379 11.854 1 8 1C4.14598 1 1 4.18621 1 8.08046C1 11.8862 4.14598 15 8 15C9.85057 15 11.5161 14.2356 12.4333 13.4069L11.7092 12.6103C10.8966 13.3345 9.5931 13.9943 8 13.9943C4.70115 13.9943 2.00575 11.331 2.00575 8.08046C2.00575 4.74138 4.70115 2.00575 8 2.00575C11.2989 2.00575 13.9943 4.66897 13.9943 7.91954C13.9943 9.02989 13.3264 9.78621 12.2885 9.78621C11.3471 9.78621 10.6552 9.1908 10.6552 8.32184V5.38506H9.72989ZM7.95977 9.8908C6.99425 9.8908 6.27011 9.09425 6.27011 8.04023C6.27011 6.98621 6.99425 6.18966 7.95977 6.18966C8.92529 6.18966 9.64943 6.98621 9.64943 8.04023C9.64943 9.09425 8.92529 9.8908 7.95977 9.8908Z" fill="#208A3C"/>
</svg>


  <!-- geekdoc include: /sprites/class.svg -->
  <!-- Copyright 2000-2022 JetBrains s.r.o. and contributors. Use of this source code is governed by the Apache 2.0 license. -->
<svg id="class" class="svg-sprite" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg">
<circle cx="8" cy="8" r="6.5" fill="#E7EFFD" stroke="#3574F0"/>
<path d="M8.13295 11.5C9.61223 11.5 10.8836 10.6105 11.2075 9.33909H10.2213C9.90229 10.0739 9.11914 10.6057 8.13295 10.6057C6.77936 10.6057 5.80284 9.51796 5.80284 8C5.80284 6.48204 6.77936 5.39434 8.13295 5.39434C9.11914 5.39434 9.90229 5.92611 10.2213 6.66091H11.2075C10.8836 5.3895 9.61223 4.5 8.13295 4.5C6.21859 4.5 4.79248 5.99378 4.79248 8C4.79248 10.0062 6.21859 11.5 8.13295 11.5Z" fill="#3574F0"/>
</svg>


  <!-- geekdoc include: /sprites/enum.svg -->
  <!-- Copyright 2000-2022 JetBrains s.r.o. and contributors. Use of this source code is governed by the Apache 2.0 license. -->
<svg id="enum" class="svg-sprite" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg">
<circle cx="8" cy="8" r="6.5" fill="#E7EFFD" stroke="#3574F0"/>
<path d="M5.48999 11.5H10.51V10.585H6.47999V8.435H10.07V7.515H6.47999V5.415H10.41V4.5H5.48999V11.5Z" fill="#3574F0"/>
</svg>


  <!-- geekdoc include: /sprites/exception.svg -->
  <!-- Copyright 2000-2022 JetBrains s.r.o. and contributors. Use of this source code is governed by the Apache 2.0 license. -->
<svg id="exception" class="svg-sprite" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg">
<circle cx="8" cy="8" r="6.5" fill="#E7EFFD" stroke="#3574F0"/>
<path d="M9 4.5L6 8H10L7 11.5" stroke="#3574F0" stroke-linecap="round"/>
</svg>


  <!-- geekdoc include: /sprites/interface.svg -->
  <!-- Copyright 2000-2022 JetBrains s.r.o. and contributors. Use of this source code is governed by the Apache 2.0 license. -->
<svg id="interface" class="svg-sprite" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg">
<circle cx="8" cy="8" r="6.5" fill="#F2FCF3" stroke="#5FB865"/>
<path fill-rule="evenodd" clip-rule="evenodd" d="M10 4.5V5.5L8.5 5.5V10.5H10V11.5L8.5 11.5H7.5L6 11.5V10.5H7.5V5.5L6 5.5V4.5H7.5H8.5H10Z" fill="#5FB865"/>
</svg>


  <!-- geekdoc include: /sprites/package.svg -->
  <!-- Copyright 2000-2022 JetBrains s.r.o. and contributors. Use of this source code is governed by the Apache 2.0 license. -->
<svg id="package" class="svg-sprite" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg">
<path fill-rule="evenodd" clip-rule="evenodd" d="M1 3.86667C1 2.83574 1.73127 2 2.63333 2H6.1217C6.39413 2 6.65477 2.11115 6.84336 2.30775L8.46667 4H13C14.1046 4 15 4.89543 15 6V12.1333C15 13.1643 14.2687 14 13.3667 14H2.63333C1.73127 14 1 13.1643 1 12.1333V3.86667ZM6 10C6.55228 10 7 9.55228 7 9C7 8.44772 6.55228 8 6 8C5.44772 8 5 8.44772 5 9C5 9.55228 5.44772 10 6 10Z" fill="#EBECF0"/>
<path fill-rule="evenodd" clip-rule="evenodd" d="M8.04022 5L6.1217 3H2.63333C2.40481 3 2 3.25841 2 3.86667V12.1333C2 12.7416 2.40481 13 2.63333 13H13.3667C13.5952 13 14 12.7416 14 12.1333V6C14 5.44771 13.5523 5 13 5H8.04022ZM8.46667 4L6.84336 2.30775C6.65477 2.11115 6.39413 2 6.1217 2H2.63333C1.73127 2 1 2.83574 1 3.86667V12.1333C1 13.1643 1.73127 14 2.63333 14H13.3667C14.2687 14 15 13.1643 15 12.1333V6C15 4.89543 14.1046 4 13 4H8.46667ZM4 9C4 7.89543 4.89543 7 6 7C7.10457 7 8 7.89543 8 9C8 10.1046 7.10457 11 6 11C4.89543 11 4 10.1046 4 9ZM7 9C7 9.55228 6.55228 10 6 10C5.44772 10 5 9.55228 5 9C5 8.44772 5.44772 8 6 8C6.55228 8 7 8.44772 7 9Z" fill="#6C707E"/>
</svg>


  <!-- geekdoc include: /sprites/geekdoc.svg -->
  <svg class="svg-sprite" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><svg viewBox="-7.27 -7.27 38.55 38.55" id="gdoc_arrow_back" xmlns="http://www.w3.org/2000/svg"><path d="M24 10.526v2.947H5.755l8.351 8.421-2.105 2.105-12-12 12-12 2.105 2.105-8.351 8.421H24z"/></svg><svg viewBox="-7.27 -7.27 38.55 38.55" id="gdoc_arrow_left_alt" xmlns="http://www.w3.org/2000/svg"><path d="M5.965 10.526V6.035L0 12l5.965 5.965v-4.491H24v-2.947H5.965z"/></svg><svg viewBox="-7.27 -7.27 38.55 38.55" id="gdoc_arrow_right_alt" xmlns="http://www.w3.org/2000/svg"><path d="M18.035 10.526V6.035L24 12l-5.965 5.965v-4.491H0v-2.947h18.035z"/></svg><svg viewBox="-7.27 -7.27 42.55 42.55" id="gdoc_bitbucket" xmlns="http://www.w3.org/2000/svg"><path d="M15.905 13.355c.189 1.444-1.564 2.578-2.784 1.839-1.375-.602-1.375-2.784-.034-3.403 1.151-.705 2.818.223 2.818 1.564zm1.907-.361c-.309-2.44-3.076-4.056-5.328-3.042-1.426.636-2.389 2.148-2.32 3.747.086 2.097 2.08 3.815 4.176 3.626s3.729-2.234 3.472-4.331zm4.108-9.315c-.756-.997-2.045-1.169-3.179-1.358-3.214-.516-6.513-.533-9.727.034-1.066.172-2.269.361-2.939 1.323 1.1 1.031 2.664 1.186 4.073 1.358 2.544.327 5.156.344 7.699.017 1.426-.172 3.008-.309 4.073-1.375zm.979 17.788c-.481 1.684-.206 3.953-1.994 4.932-3.076 1.701-6.806 1.89-10.191 1.289-1.787-.327-3.884-.894-4.864-2.578-.43-1.65-.705-3.334-.98-5.018l.103-.275.309-.155c5.121 3.386 12.288 3.386 17.427 0 .808.241.206 1.22.189 1.805zM26.01 4.951c-.584 3.764-1.255 7.51-1.908 11.257-.189 1.1-1.255 1.719-2.148 2.183-3.214 1.615-6.96 1.89-10.483 1.512-2.389-.258-4.829-.894-6.771-2.389-.911-.705-.911-1.908-1.083-2.922-.602-3.523-1.289-7.046-1.719-10.604.206-1.547 1.942-2.217 3.231-2.698C6.848.654 8.686.362 10.508.19c3.884-.378 7.854-.241 11.618.859 1.341.395 2.784.945 3.695 2.097.412.533.275 1.203.189 1.805z"/></svg><svg viewBox="-7.27 -7.27 38.55 38.55" id="gdoc_bookmark" xmlns="http://www.w3.org/2000/svg"><path d="M15.268 4.392q.868 0 1.532.638t.664 1.506v17.463l-7.659-3.268-7.608 3.268V6.536q0-.868.664-1.506t1.532-.638h10.876zm4.34 14.144V4.392q0-.868-.638-1.532t-1.506-.664H6.537q0-.868.664-1.532T8.733 0h10.876q.868 0 1.532.664t.664 1.532v17.412z"/></svg><svg viewBox="-7.27 -7.27 42.55 42.55" id="gdoc_brightness_auto" xmlns="http://www.w3.org/2000/svg"><path d="M16.846 18.938h2.382L15.22 7.785h-2.44L8.772 18.938h2.382l.871-2.44h3.95zm7.087-9.062L27.999 14l-4.066 4.124v5.809h-5.809L14 27.999l-4.124-4.066H4.067v-5.809L.001 14l4.066-4.124V4.067h5.809L14 .001l4.124 4.066h5.809v5.809zm-11.385 4.937L14 10.282l1.452 4.531h-2.904z"/></svg><svg viewBox="-7.27 -7.27 42.55 42.55" id="gdoc_brightness_dark" xmlns="http://www.w3.org/2000/svg"><path d="M14 21.435q3.079 0 5.257-2.178T21.435 14t-2.178-5.257T14 6.565q-1.51 0-3.079.697 1.917.871 3.108 2.701T15.22 14t-1.191 4.037-3.108 2.701q1.568.697 3.079.697zm9.933-11.559L27.999 14l-4.066 4.124v5.809h-5.809L14 27.999l-4.124-4.066H4.067v-5.809L.001 14l4.066-4.124V4.067h5.809L14 .001l4.124 4.066h5.809v5.809z"/></svg><svg viewBox="-7.27 -7.27 42.55 42.55" id="gdoc_brightness_light" xmlns="http://www.w3.org/2000/svg"><path d="M14 21.435q3.079 0 5.257-2.178T21.435 14t-2.178-5.257T14 6.565 8.743 8.743 6.565 14t2.178 5.257T14 21.435zm9.933-3.311v5.809h-5.809L14 27.999l-4.124-4.066H4.067v-5.809L.001 14l4.066-4.124V4.067h5.809L14 .001l4.124 4.066h5.809v5.809L27.999 14z"/></svg><svg viewBox="-7.27 -7.27 42.55 42.55" id="gdoc_check" xmlns="http://www.w3.org/2000/svg"><path d="M8.885 20.197 25.759 3.323l2.24 2.24L8.885 24.677 0 15.792l2.24-2.24z"/></svg><svg viewBox="-7.27 -7.27 42.55 42.55" id="gdoc_check_circle_outline" xmlns="http://www.w3.org/2000/svg"><path d="M14 25.239q4.601 0 7.92-3.319T25.239 14 21.92 6.08 14 2.761 6.08 6.08 2.761 14t3.319 7.92T14 25.239zM14 0q5.784 0 9.892 4.108T28 14t-4.108 9.892T14 28t-9.892-4.108T0 14t4.108-9.892T14 0zm6.441 7.822 1.972 1.972-11.239 11.239L4.207 14l1.972-1.972 4.995 4.995z"/></svg><svg viewBox="-7.27 -7.27 42.55 42.55" id="gdoc_cloud_off" xmlns="http://www.w3.org/2000/svg"><path d="M9.023 10.5H7q-1.914 0-3.281 1.395t-1.367 3.309 1.367 3.281T7 19.852h11.375zM3.5 4.976l1.477-1.477L24.5 23.022l-1.477 1.477-2.352-2.297H6.999q-2.898 0-4.949-2.051t-2.051-4.949q0-2.844 1.969-4.867t4.758-2.133zm19.086 5.578q2.242.164 3.828 1.832T28 16.351q0 3.008-2.461 4.758l-1.695-1.695q1.805-.984 1.805-3.063 0-1.422-1.039-2.461t-2.461-1.039h-1.75v-.602q0-2.68-1.859-4.539t-4.539-1.859q-1.531 0-2.953.711l-1.75-1.695Q11.431 3.5 14.001 3.5q2.953 0 5.496 2.078t3.09 4.977z"/></svg><svg viewBox="-7.27 -7.27 42.55 42.55" id="gdoc_code" xmlns="http://www.w3.org/2000/svg"><path d="M9.917 24.5a1.75 1.75 0 1 0-3.501.001 1.75 1.75 0 0 0 3.501-.001zm0-21a1.75 1.75 0 1 0-3.501.001A1.75 1.75 0 0 0 9.917 3.5zm11.666 2.333a1.75 1.75 0 1 0-3.501.001 1.75 1.75 0 0 0 3.501-.001zm1.75 0a3.502 3.502 0 0 1-1.75 3.026c-.055 6.581-4.721 8.039-7.82 9.023-2.898.911-3.846 1.349-3.846 3.117v.474a3.502 3.502 0 0 1 1.75 3.026c0 1.932-1.568 3.5-3.5 3.5s-3.5-1.568-3.5-3.5c0-1.294.711-2.424 1.75-3.026V6.526A3.502 3.502 0 0 1 4.667 3.5c0-1.932 1.568-3.5 3.5-3.5s3.5 1.568 3.5 3.5a3.502 3.502 0 0 1-1.75 3.026v9.06c.93-.456 1.914-.766 2.807-1.039 3.391-1.075 5.323-1.878 5.359-5.687a3.502 3.502 0 0 1-1.75-3.026c0-1.932 1.568-3.5 3.5-3.5s3.5 1.568 3.5 3.5z"/></svg><svg viewBox="-7.27 -7.27 42.55 42.55" id="gdoc_copy" xmlns="http://www.w3.org/2000/svg"><path d="M23.502 25.438V7.626H9.562v17.812h13.94zm0-20.315q1.013 0 1.787.745t.774 1.757v17.812q0 1.013-.774 1.787t-1.787.774H9.562q-1.013 0-1.787-.774t-.774-1.787V7.625q0-1.013.774-1.757t1.787-.745h13.94zM19.689 0v2.562H4.438v17.812H1.936V2.562q0-1.013.745-1.787T4.438.001h15.251z"/></svg><svg viewBox="-7.27 -7.27 42.55 42.55" id="gdoc_dangerous" xmlns="http://www.w3.org/2000/svg"><path d="M21.802 19.833 15.969 14l5.833-5.833-1.969-1.969L14 12.031 8.167 6.198 6.198 8.167 12.031 14l-5.833 5.833 1.969 1.969L14 15.969l5.833 5.833zM19.833 0 28 8.167v11.666L19.833 28H8.167L0 19.833V8.167L8.167 0h11.666z"/></svg><svg viewBox="-7.27 -7.27 46.55 46.55" id="gdoc_date" xmlns="http://www.w3.org/2000/svg"><path d="M27.192 28.844V11.192H4.808v17.652h22.384zm0-25.689q1.277 0 2.253.976t.976 2.253v22.459q0 1.277-.976 2.216t-2.253.939H4.808q-1.352 0-2.291-.901t-.939-2.253V6.385q0-1.277.939-2.253t2.291-.976h1.577V.001h3.23v3.155h12.769V.001h3.23v3.155h1.577zm-3.155 11.267v3.155h-3.23v-3.155h3.23zm-6.46 0v3.155h-3.155v-3.155h3.155zm-6.384 0v3.155h-3.23v-3.155h3.23z"/></svg><svg viewBox="-7.27 -7.27 46.55 46.55" id="gdoc_download" xmlns="http://www.w3.org/2000/svg"><path d="M2.866 28.209h26.269v3.79H2.866v-3.79zm26.268-16.925L16 24.418 2.866 11.284h7.493V.001h11.283v11.283h7.493z"/></svg><svg viewBox="-7.27 -7.27 46.55 46.55" id="gdoc_email" xmlns="http://www.w3.org/2000/svg"><path d="M28.845 9.615v-3.23L16 14.422 3.155 6.385v3.23L16 17.577zm0-6.46q1.277 0 2.216.977T32 6.385v19.23q0 1.277-.939 2.253t-2.216.977H3.155q-1.277 0-2.216-.977T0 25.615V6.385q0-1.277.939-2.253t2.216-.977h25.69z"/></svg><svg viewBox="-7.27 -7.27 42.55 42.55" id="gdoc_error_outline" xmlns="http://www.w3.org/2000/svg"><path d="M14 25.239q4.601 0 7.92-3.319T25.239 14 21.92 6.08 14 2.761 6.08 6.08 2.761 14t3.319 7.92T14 25.239zM14 0q5.784 0 9.892 4.108T28 14t-4.108 9.892T14 28t-9.892-4.108T0 14t4.108-9.892T14 0zm-1.38 6.967h2.761v8.413H12.62V6.967zm0 11.239h2.761v2.826H12.62v-2.826z"/></svg><svg viewBox="-7.27 -7.27 42.55 42.55" id="gdoc_fire" xmlns="http://www.w3.org/2000/svg"><path d="M17.689 21.998q-.32.32-.8.576t-.864.384q-1.152.384-2.272.032t-1.888-.992q-.128-.128-.096-.256t.16-.192q1.216-.384 1.92-1.216t.96-1.792q.192-.896-.064-1.728t-.384-1.728q-.128-.704-.096-1.376t.288-1.312q0-.128.128-.128t.192.064q.384.832.992 1.472t1.28 1.216 1.216 1.248.672 1.568q.064.384.064.704.064.96-.32 1.92t-1.088 1.536zm3.84-10.944q-.768-.704-1.6-1.28t-1.6-1.344q-1.536-1.536-2.016-3.584t.16-4.16q.128-.32-.096-.544t-.544-.096q-.768.32-1.44.768t-1.312.896q-1.984 1.664-3.136 3.936T8.633 10.51t.8 5.088q0 .128.032.256t.032.256q0 .576-.512.832t-1.024-.192q-.128-.192-.192-.32-1.024-1.28-1.376-2.912t-.096-3.232q.064-.384-.288-.576t-.608.128q-1.28 1.664-1.856 3.68t-.448 4.064q0 .576.096 1.184t.288 1.184q.448 1.536 1.216 2.816 1.216 2.048 3.264 3.424t4.416 1.696q2.496.32 5.024-.256t4.448-2.304q1.408-1.344 2.208-3.104t.864-3.68-.704-3.712q-.064-.128-.096-.224t-.096-.224q-.576-1.088-1.28-1.984-.256-.384-.544-.704t-.672-.64z"/></svg><svg viewBox="-7.27 -7.27 42.55 42.55" id="gdoc_git" xmlns="http://www.w3.org/2000/svg"><path d="M27.472 12.753 15.247.529a1.803 1.803 0 0 0-2.55 0l-2.84 2.84 2.137 2.137a2.625 2.625 0 0 1 3.501 3.501l3.499 3.499a2.625 2.625 0 1 1-1.237 1.237l-3.499-3.499c-.083.04-.169.075-.257.106v7.3a2.626 2.626 0 1 1-1.75 0v-7.3a2.626 2.626 0 0 1-1.494-3.607L8.62 4.606l-8.09 8.09a1.805 1.805 0 0 0 0 2.551l12.225 12.224a1.803 1.803 0 0 0 2.55 0l12.168-12.168a1.805 1.805 0 0 0 0-2.551z"/></svg><svg viewBox="-7.27 -7.27 46.55 46.55" id="gdoc_gitea" xmlns="http://www.w3.org/2000/svg"><path d="M5.581 7.229c-2.46-.005-5.755 1.559-5.573 5.48.284 6.125 6.56 6.693 9.068 6.743.275 1.149 3.227 5.112 5.412 5.32h9.573c5.741-.381 10.04-17.363 6.853-17.427-5.271.248-8.395.373-11.073.395v5.3l-.835-.369-.005-4.928c-3.075-.001-5.781-.144-10.919-.397-.643-.004-1.539-.113-2.501-.116zm.348 2.166h.293c.349 3.14.917 4.976 2.067 7.781-2.933-.347-5.429-1.199-5.888-4.38-.237-1.647.563-3.365 3.528-3.401zm11.409 3.087c.2.003.404.04.596.128l.999.431-.716 1.305h-.007a.996.996 0 0 0-.321.053l.006-.002c-.349.114-.593.406-.593.749 0 .097.019.189.055.275l-.002-.006a.767.767 0 0 0 .151.233l-.001-.001-1.235 2.248a.99.99 0 0 0-.302.052l.006-.002c-.349.114-.593.406-.593.749 0 .097.019.189.055.275l-.002-.006c.128.31.457.527.843.527a.987.987 0 0 0 .31-.049l-.006.002c.348-.114.592-.406.592-.749 0-.097-.02-.19-.056-.277l.002.006a.784.784 0 0 0-.211-.293l1.203-2.189a.999.999 0 0 0 .397-.041l-.006.002a.942.942 0 0 0 .285-.15l-.001.001c.464.195.844.353 1.117.488.411.203.556.337.6.487.044.147-.004.429-.236.925-.173.369-.46.893-.799 1.511h-.02a.991.991 0 0 0-.321.053l.006-.002c-.349.114-.593.406-.593.749 0 .097.019.189.055.275l-.002-.006c.128.31.457.527.843.527a.987.987 0 0 0 .31-.049l-.006.002c.348-.114.592-.406.592-.749a.703.703 0 0 0-.055-.275l.002.006a.802.802 0 0 0-.183-.27l.001.001c.335-.611.623-1.136.808-1.531.251-.536.381-.935.267-1.32s-.467-.636-.933-.867c-.307-.151-.689-.311-1.147-.503a.723.723 0 0 0-.052-.324l.002.006a.792.792 0 0 0-.194-.279l.704-1.284 3.899 1.684c.704.305.995 1.053.653 1.68l-2.68 4.907c-.343.625-1.184.884-1.888.58l-5.516-2.384c-.704-.304-.996-1.053-.653-1.68l2.68-4.905c.235-.431.707-.687 1.207-.707z"/></svg><svg viewBox="-7.27 -7.27 46.55 46.55" id="gdoc_github" xmlns="http://www.w3.org/2000/svg"><path d="M16 .394c8.833 0 15.999 7.166 15.999 15.999 0 7.062-4.583 13.062-10.937 15.187-.813.146-1.104-.354-1.104-.771 0-.521.021-2.25.021-4.396 0-1.5-.5-2.458-1.083-2.958 3.562-.396 7.312-1.75 7.312-7.896 0-1.75-.625-3.167-1.646-4.291.167-.417.708-2.042-.167-4.25-1.333-.417-4.396 1.646-4.396 1.646a15.032 15.032 0 0 0-8 0S8.937 6.602 7.603 7.018c-.875 2.208-.333 3.833-.167 4.25-1.021 1.125-1.646 2.542-1.646 4.291 0 6.125 3.729 7.5 7.291 7.896-.458.417-.875 1.125-1.021 2.146-.917.417-3.25 1.125-4.646-1.333-.875-1.521-2.458-1.646-2.458-1.646-1.562-.021-.104.979-.104.979 1.042.479 1.771 2.333 1.771 2.333.938 2.854 5.396 1.896 5.396 1.896 0 1.333.021 2.583.021 2.979 0 .417-.292.917-1.104.771C4.582 29.455-.001 23.455-.001 16.393-.001 7.56 7.165.394 15.998.394zM6.063 23.372c.042-.083-.021-.187-.146-.25-.125-.042-.229-.021-.271.042-.042.083.021.187.146.25.104.062.229.042.271-.042zm.646.709c.083-.062.062-.208-.042-.333-.104-.104-.25-.146-.333-.062-.083.062-.062.208.042.333.104.104.25.146.333.062zm.625.937c.104-.083.104-.25 0-.396-.083-.146-.25-.208-.354-.125-.104.062-.104.229 0 .375s.271.208.354.146zm.875.875c.083-.083.042-.271-.083-.396-.146-.146-.333-.167-.417-.062-.104.083-.062.271.083.396.146.146.333.167.417.062zm1.187.521c.042-.125-.083-.271-.271-.333-.167-.042-.354.021-.396.146s.083.271.271.312c.167.062.354 0 .396-.125zm1.313.104c0-.146-.167-.25-.354-.229-.187 0-.333.104-.333.229 0 .146.146.25.354.229.187 0 .333-.104.333-.229zm1.208-.208c-.021-.125-.187-.208-.375-.187-.187.042-.312.167-.292.312.021.125.187.208.375.167s.312-.167.292-.292z"/></svg><svg viewBox="-7.27 -7.27 42.55 42.55" id="gdoc_gitlab" xmlns="http://www.w3.org/2000/svg"><path d="M1.629 11.034 14 26.888.442 17.048a1.09 1.09 0 0 1-.39-1.203l1.578-4.811zm7.217 0h10.309l-5.154 15.854zM5.753 1.475l3.093 9.559H1.63l3.093-9.559a.548.548 0 0 1 1.031 0zm20.618 9.559 1.578 4.811c.141.437-.016.922-.39 1.203l-13.558 9.84 12.371-15.854zm0 0h-7.216l3.093-9.559a.548.548 0 0 1 1.031 0z"/></svg><svg viewBox="-7.27 -7.27 46.55 46.55" id="gdoc_heart" xmlns="http://www.w3.org/2000/svg"><path d="M16 29.714a1.11 1.11 0 0 1-.786-.321L4.072 18.643c-.143-.125-4.071-3.714-4.071-8 0-5.232 3.196-8.357 8.535-8.357 3.125 0 6.053 2.464 7.464 3.857 1.411-1.393 4.339-3.857 7.464-3.857 5.339 0 8.535 3.125 8.535 8.357 0 4.286-3.928 7.875-4.089 8.035L16.785 29.392c-.214.214-.5.321-.786.321z"/></svg><svg viewBox="-7.27 -7.27 42.55 42.55" id="gdoc_home" xmlns="http://www.w3.org/2000/svg"><path d="M24.003 15.695v8.336c0 .608-.504 1.111-1.111 1.111h-6.669v-6.669h-4.446v6.669H5.108a1.119 1.119 0 0 1-1.111-1.111v-8.336c0-.035.017-.069.017-.104L14 7.359l9.986 8.232a.224.224 0 0 1 .017.104zm3.873-1.198-1.077 1.285a.578.578 0 0 1-.365.191h-.052a.547.547 0 0 1-.365-.122L14 5.831 1.983 15.851a.594.594 0 0 1-.417.122.578.578 0 0 1-.365-.191L.124 14.497a.57.57 0 0 1 .069-.781L12.679 3.314c.729-.608 1.91-.608 2.64 0l4.237 3.543V3.471c0-.313.243-.556.556-.556h3.334c.313 0 .556.243.556.556v7.085l3.803 3.161c.226.191.26.556.069.781z"/></svg><svg viewBox="-7.27 -7.27 42.55 42.55" id="gdoc_info_outline" xmlns="http://www.w3.org/2000/svg"><path d="M12.62 9.793V6.967h2.761v2.826H12.62zM14 25.239q4.601 0 7.92-3.319T25.239 14 21.92 6.08 14 2.761 6.08 6.08 2.761 14t3.319 7.92T14 25.239zM14 0q5.784 0 9.892 4.108T28 14t-4.108 9.892T14 28t-9.892-4.108T0 14t4.108-9.892T14 0zm-1.38 21.033V12.62h2.761v8.413H12.62z"/></svg><svg viewBox="-7.27 -7.27 42.55 42.55" id="gdoc_keyboard_arrow_down" xmlns="http://www.w3.org/2000/svg"><path d="M3.281 5.36 14 16.079 24.719 5.36 28 8.641l-14 14-14-14z"/></svg><svg viewBox="-7.27 -7.27 46.55 46.55" id="gdoc_keyboard_arrow_left" xmlns="http://www.w3.org/2000/svg"><path d="M25.875 28.25 22.125 32 6.126 16.001 22.125.002l3.75 3.75-12.25 12.25z"/></svg><svg viewBox="-7.27 -7.27 46.55 46.55" id="gdoc_keyboard_arrow_right" xmlns="http://www.w3.org/2000/svg"><path d="M6.125 28.25 18.375 16 6.125 3.75 9.875 0l15.999 15.999L9.875 31.998z"/></svg><svg viewBox="-7.27 -7.27 42.55 42.55" id="gdoc_keyboard_arrow_up" xmlns="http://www.w3.org/2000/svg"><path d="M24.719 22.64 14 11.921 3.281 22.64 0 19.359l14-14 14 14z"/></svg><svg viewBox="-7.27 -7.27 42.55 42.55" id="gdoc_language" xmlns="http://www.w3.org/2000/svg"><path d="M20.112 16.826h4.732q.394-1.84.394-2.826t-.394-2.826h-4.732q.197 1.38.197 2.826t-.197 2.826zm-2.497 7.756q1.643-.526 3.418-2.005t2.695-2.991h-4.141q-.657 2.629-1.972 4.995zm-.329-7.756q.197-1.38.197-2.826t-.197-2.826h-6.573q-.197 1.38-.197 2.826t.197 2.826h6.573zM14 25.173q1.84-2.695 2.695-5.587h-5.39q.854 2.892 2.695 5.587zM8.413 8.413q.789-2.826 1.972-4.995-1.643.526-3.451 2.005T4.272 8.414h4.141zM4.272 19.587q.854 1.512 2.662 2.991t3.451 2.005q-1.315-2.366-1.972-4.995H4.272zm-1.117-2.761h4.732Q7.69 15.446 7.69 14t.197-2.826H3.155q-.394 1.84-.394 2.826t.394 2.826zM14 2.826q-1.84 2.695-2.695 5.587h5.39Q15.841 5.521 14 2.826zm9.727 5.587q-.92-1.512-2.695-2.991t-3.418-2.005q1.183 2.169 1.972 4.995h4.141zM14 0q5.784 0 9.892 4.108T28 14t-4.108 9.892T14 28t-9.892-4.108T0 14t4.108-9.892T14 0z"/></svg><svg viewBox="-7.27 -7.27 46.55 46.55" id="gdoc_link" xmlns="http://www.w3.org/2000/svg"><path d="M24.037 7.963q3.305 0 5.634 2.366T32 16t-2.329 5.671-5.634 2.366h-6.46v-3.08h6.46q2.028 0 3.493-1.465t1.465-3.493-1.465-3.493-3.493-1.465h-6.46v-3.08h6.46zM9.615 17.578v-3.155h12.77v3.155H9.615zM3.005 16q0 2.028 1.465 3.493t3.493 1.465h6.46v3.08h-6.46q-3.305 0-5.634-2.366T0 16.001t2.329-5.671 5.634-2.366h6.46v3.08h-6.46q-2.028 0-3.493 1.465t-1.465 3.493z"/></svg><svg viewBox="-7.27 -7.27 46.55 46.55" id="gdoc_mastodon" xmlns="http://www.w3.org/2000/svg"><path d="M30.924 10.506c0-6.941-4.548-8.976-4.548-8.976C24.083.477 20.144.034 16.054.001h-.101C11.862.034 7.926.477 5.633 1.53c0 0-4.548 2.035-4.548 8.976 0 1.589-.031 3.491.02 5.505.165 6.79 1.245 13.479 7.522 15.14 2.893.765 5.379.927 7.38.816 3.629-.2 5.667-1.296 5.667-1.296l-.12-2.633s-2.593.817-5.505.719c-2.887-.099-5.932-.311-6.399-3.855a7.069 7.069 0 0 1-.064-.967v-.028.001s2.833.693 6.423.857c2.195.1 4.253-.129 6.344-.377 4.009-.479 7.5-2.949 7.939-5.207.689-3.553.633-8.676.633-8.676zm-5.366 8.945h-3.329v-8.159c0-1.72-.724-2.592-2.171-2.592-1.6 0-2.403 1.035-2.403 3.083v4.465h-3.311v-4.467c0-2.048-.803-3.083-2.403-3.083-1.447 0-2.171.873-2.171 2.592v8.159H6.441v-8.404c0-1.719.437-3.084 1.316-4.093.907-1.011 2.092-1.528 3.565-1.528 1.704 0 2.995.655 3.848 1.965l.828 1.391.829-1.391c.853-1.311 2.144-1.965 3.848-1.965 1.472 0 2.659.517 3.565 1.528.877 1.009 1.315 2.375 1.315 4.093z"/></svg><svg viewBox="-7.27 -7.27 46.55 46.55" id="gdoc_matrix" xmlns="http://www.w3.org/2000/svg"><path d="M.843.734v30.532H3.04v.733H0V0h3.04v.733zm9.391 9.68v1.543h.044a4.417 4.417 0 0 1 1.489-1.365c.577-.327 1.248-.487 2-.487.72 0 1.377.143 1.975.419.597.277 1.047.776 1.36 1.477.339-.499.8-.941 1.379-1.323.579-.383 1.267-.573 2.061-.573.604 0 1.163.075 1.68.223a3.34 3.34 0 0 1 1.324.707c.368.327.652.745.861 1.268.203.523.307 1.151.307 1.889v7.637h-3.132v-6.468c0-.381-.013-.745-.043-1.083a2.315 2.315 0 0 0-.246-.893l.006.013a1.484 1.484 0 0 0-.577-.593l-.007-.004c-.259-.147-.609-.221-1.047-.221-.443 0-.8.085-1.071.252-.267.166-.483.39-.635.656l-.005.009a2.558 2.558 0 0 0-.307.915l-.002.013a7.156 7.156 0 0 0-.08 1.044v6.359h-3.133v-6.4c0-.339-.005-.671-.024-1.003a2.772 2.772 0 0 0-.197-.936l.007.019a1.41 1.41 0 0 0-.548-.667l-.006-.003c-.259-.167-.635-.253-1.139-.253-.148 0-.345.032-.585.099-.24.068-.48.191-.707.376-.228.184-.425.449-.585.793-.16.345-.24.8-.24 1.36v6.621H7.279v-11.42zm20.923 20.852V.734H28.96V.001H32V32h-3.04v-.733z"/></svg><svg viewBox="-7.27 -7.27 46.55 46.55" id="gdoc_menu" xmlns="http://www.w3.org/2000/svg"><path d="M.001 5.334h31.998v3.583H.001V5.334zm0 12.416v-3.5h31.998v3.5H.001zm0 8.916v-3.583h31.998v3.583H.001z"/></svg><svg viewBox="-7.27 -7.27 42.55 42.55" id="gdoc_notification" xmlns="http://www.w3.org/2000/svg"><path d="m22.615 19.384 2.894 2.894v1.413H2.49v-1.413l2.894-2.894V12.25q0-3.365 1.716-5.856t4.745-3.231v-1.01q0-.875.606-1.514T13.999 0t1.548.639.606 1.514v1.01q3.029.74 4.745 3.231t1.716 5.856v7.134zM14 27.999q-1.211 0-2.053-.808t-.841-2.019h5.788q0 1.144-.875 1.986T14 27.999z"/></svg><svg viewBox="-7.27 -7.27 42.55 42.55" id="gdoc_path" xmlns="http://www.w3.org/2000/svg"><path d="M28 12.62h-9.793V8.414h-2.826v11.173h2.826v-4.206H28V26.62h-9.793v-4.206H12.62v-14H9.794v4.206H.001V1.381h9.793v4.206h8.413V1.381H28V12.62z"/></svg><svg viewBox="-7.27 -7.27 46.55 46.55" id="gdoc_person" xmlns="http://www.w3.org/2000/svg"><path d="M16 20.023q5.052 0 10.526 2.199t5.473 5.754v4.023H0v-4.023q0-3.555 5.473-5.754t10.526-2.199zM16 16q-3.275 0-5.614-2.339T8.047 8.047t2.339-5.661T16 0t5.614 2.386 2.339 5.661-2.339 5.614T16 16z"/></svg><svg viewBox="-7.27 -7.27 46.55 46.55" id="gdoc_search" xmlns="http://www.w3.org/2000/svg"><path d="M11.925 20.161q3.432 0 5.834-2.402t2.402-5.834-2.402-5.834-5.834-2.402-5.834 2.402-2.402 5.834 2.402 5.834 5.834 2.402zm10.981 0L32 29.255 29.255 32l-9.094-9.094v-1.458l-.515-.515q-3.26 2.831-7.721 2.831-4.976 0-8.45-3.432T.001 11.925t3.474-8.45 8.45-3.474 8.407 3.474 3.432 8.45q0 1.802-.858 4.075t-1.973 3.646l.515.515h1.458z"/></svg><svg viewBox="-7.27 -7.27 42.55 42.55" id="gdoc_shield" xmlns="http://www.w3.org/2000/svg"><path d="M22.167 15.166V3.5h-8.166v20.726c.93-.492 2.424-1.349 3.883-2.497 1.95-1.531 4.284-3.919 4.284-6.562zm3.499-13.999v14c0 7.674-10.737 12.523-11.192 12.724-.146.073-.31.109-.474.109s-.328-.036-.474-.109c-.456-.201-11.192-5.049-11.192-12.724v-14C2.334.529 2.863 0 3.501 0H24.5c.638 0 1.167.529 1.167 1.167z"/></svg><svg viewBox="-7.27 -7.27 42.55 42.55" id="gdoc_star" xmlns="http://www.w3.org/2000/svg"><path d="M14 22.052 5.324 27.31l2.3-9.859L0 10.813l10.056-.854L14 .692l3.944 9.267L28 10.813l-7.624 6.638 2.3 9.859z"/></svg><svg viewBox="-7.27 -7.27 42.55 42.55" id="gdoc_tag" xmlns="http://www.w3.org/2000/svg"><path d="M17.52 17.52v-7.041h-7.041v7.041h7.041zM28 10.479h-7.041v7.041H28v3.439h-7.041V28H17.52v-7.041h-7.041V28H7.04v-7.041H-.001V17.52H7.04v-7.041H-.001V7.04H7.04V-.001h3.439V7.04h7.041V-.001h3.439V7.04H28v3.439z"/></svg><svg viewBox="-7.27 -7.27 46.55 46.55" id="gdoc_timer" xmlns="http://www.w3.org/2000/svg"><path d="M16 29q4.428 0 7.536-3.143t3.107-7.571-3.107-7.536T16 7.643 8.464 10.75t-3.107 7.536 3.107 7.571T16 29zM26.714 9.786q1.214 1.571 2.107 4.036t.893 4.464q0 5.643-4 9.678T16 32t-9.714-4.036-4-9.678 4-9.678T16 4.572q1.929 0 4.464.929t4.107 2.143l2.143-2.214q1.143.929 2.143 2.143zM14.5 19.857v-9.143h3v9.143h-3zM20.571.001v3.071h-9.143V.001h9.143z"/></svg><svg viewBox="-7.27 -7.27 46.55 46.55" id="gdoc_xmpp" xmlns="http://www.w3.org/2000/svg"><path d="M31.995 4.237c-.449.175-1.12.433-1.936.745-1.544.591-2.328.891-2.924 1.093-.613.208-1.287.409-2.635.813-.911.272-1.672.495-2.212.651-.031.875 0 2.177-.292 3.635a21.837 21.837 0 0 1-2.016 5.765c-1.496 2.944-3.236 4.817-3.88 5.476-.056-.059-.112-.117-.168-.179-.707-.763-2.403-2.703-3.815-5.683-1.053-2.223-1.484-4.044-1.605-4.584-.356-1.589-.427-2.955-.427-4.117 0-.075-.036-.129-.101-.149-.721-.223-1.765-.519-2.887-.853-1.271-.379-2.193-.744-3.408-1.2-.493-.185-1.409-.547-2.217-.859C.723 4.499.113 4.236.041 4.236c-.005 0-.015 0-.023.012a.131.131 0 0 0-.019.076c.009.593.08 1.361.256 2.365.615 3.503 2.688 7.061 4.36 9.244 0 0 3.717 5.035 9.128 8.144l.303.176c-.009.008-.02.015-.028.021-1.717 1.316-3.201 1.977-3.579 2.14a15.71 15.71 0 0 1-2.219.772v.407a25.31 25.31 0 0 0 2.72-.487 26.72 26.72 0 0 0 5.075-1.792c.136.067.276.136.42.204 1.527.725 3.571 1.627 6.073 2.048.613.103 1.136.165 1.507.195a.109.109 0 0 0 .115-.091.55.55 0 0 0 .004-.217.107.107 0 0 0-.063-.073c-.505-.209-1.201-.4-1.983-.719-.935-.381-2.241-1.067-3.648-2.128a13.528 13.528 0 0 1-.367-.287c4.64-2.656 7.989-6.588 7.989-6.588 1.735-2.036 4.441-5.623 5.431-9.795.349-1.473.539-2.741.5-3.628z"/></svg></defs></svg>




    <div
      class="wrapper "
    >
      <input type="checkbox" class="hidden" id="menu-control" />
      <input type="checkbox" class="hidden" id="menu-header-control" />
      
      <header class="gdoc-header">
  <div class="container flex align-center justify-between">
    
      <label for="menu-control" class="gdoc-nav__control" tabindex="0">
        <svg class="gdoc-icon gdoc_menu">
          <title>打开导航</title>
          <use xlink:href="#gdoc_menu"></use>
        </svg>
        <svg class="gdoc-icon gdoc_arrow_back">
          <title>关闭导航</title>
          <use xlink:href="#gdoc_arrow_back"></use>
        </svg>
      </label>
    
    <div>
      <a class="gdoc-brand gdoc-header__link" href="https://hongmao.run/jdk8-src-note/">
        <span class="flex align-center">
          <img
            class="gdoc-brand__img"
            src="/jdk8-src-note/brand.svg"
            alt=""
          />
          <span class="gdoc-brand__title">JDK8源码阅读笔记</span>
        </span>
      </a>
    </div>
    <div class="gdoc-menu-header">
      <span class="gdoc-menu-header__items">
        


        <span id="gdoc-color-theme">
          <svg class="gdoc-icon gdoc_brightness_dark">
            <title>切换暗/亮/自动模式</title>
            <use xlink:href="#gdoc_brightness_dark"></use>
          </svg>
          <svg class="gdoc-icon gdoc_brightness_light">
            <title>切换暗/亮/自动模式</title>
            <use xlink:href="#gdoc_brightness_light"></use>
          </svg>
          <svg class="gdoc-icon gdoc_brightness_auto">
            <title>切换暗/亮/自动模式</title>
            <use xlink:href="#gdoc_brightness_auto"></use>
          </svg>
        </span>

        <span class="gdoc-menu-header__home">
          <a href="https://hongmao.run/jdk8-src-note/" class="gdoc-header__link">
            <svg class="gdoc-icon gdoc_home">
              <title>返回首页</title>
              <use xlink:href="#gdoc_home"></use>
            </svg>
          </a>
        </span>

        



        <span class="gdoc-menu-header__control">
          <label for="menu-header-control">
            <svg class="gdoc-icon gdoc_keyboard_arrow_right">
              <use xlink:href="#gdoc_keyboard_arrow_right"></use>
              <title>关闭菜单栏</title>
            </svg>
          </label>
        </span>
      </span>
      <label for="menu-header-control" class="gdoc-menu-header__control">
        <svg class="gdoc-icon gdoc_keyboard_arrow_left">
          <use xlink:href="#gdoc_keyboard_arrow_left"></use>
          <title>打开菜单栏</title>
        </svg>
      </label>
    </div>
  </div>
</header>



      <main class="container flex flex-even">
        
          <aside class="gdoc-nav">
            <nav>
  
  <div class="gdoc-search flex align-center">
    <svg class="gdoc-icon gdoc_search"><use xlink:href="#gdoc_search"></use></svg>
    <input
      type="text"
      id="gdoc-search-input"
      class="gdoc-search__input"
      placeholder="搜索..."
      aria-label="搜索"
      maxlength="64"
      data-site-base-url="https://hongmao.run/jdk8-src-note/"
      data-site-lang="zh-cn"
    />
    <ul id="gdoc-search-results" class="gdoc-search__list"></ul>
  </div>




  <section class="gdoc-nav--main">
    <h2>导航</h2>
    
      

  
  


  <ul class="gdoc-nav__list">
    
      
      


      <li>
        
        
          
          
          
          
          
          
          

          
          

          
            <input
              type="checkbox"
              
                class="hidden"
              
            />
            <label
              
            >
              <span class="flex">
                
                  <svg class="gdoc-icon package"><use xlink:href="#package"></use></svg>
                
                <a
                  href="/jdk8-src-note/java"
                  class="gdoc-nav__entry"
                >
                  java
                </a>
              </span>
              
            </label>
          
        

        
          
  
  


  <ul class="gdoc-nav__list">
    
      
      


      <li>
        
        
          
          
          
          
          
          
          

          
          

          
            <input
              type="checkbox"
              
                class="gdoc-nav__toggle" id="navtree-1ec2fefc"
                
              
            />
            <label
              
                for="navtree-1ec2fefc" class="flex justify-between align-center"
              
            >
              <span class="flex">
                
                  <svg class="gdoc-icon package"><use xlink:href="#package"></use></svg>
                
                <a
                  href="/jdk8-src-note/java/io"
                  class="gdoc-nav__entry"
                >
                  io
                </a>
              </span>
              
                <svg class="gdoc-icon toggle gdoc_keyboard_arrow_left">
                  <use xlink:href="#gdoc_keyboard_arrow_left"></use>
                </svg>
                <svg class="gdoc-icon toggle gdoc_keyboard_arrow_down">
                  <use xlink:href="#gdoc_keyboard_arrow_down"></use>
                </svg>
              
            </label>
          
        

        
          
  
  


  <ul class="gdoc-nav__list">
    
      
      


      <li>
        
        
          
          
          
          
          
          
          

          
          

          
            <input
              type="checkbox"
              
                class="hidden"
              
            />
            <label
              
            >
              <span class="flex">
                
                  <svg class="gdoc-icon interface"><use xlink:href="#interface"></use></svg>
                
                <a
                  href="/jdk8-src-note/java/io/Closeable"
                  class="gdoc-nav__entry"
                >
                  Closeable
                </a>
              </span>
              
            </label>
          
        

        
      </li>
    
  </ul>

        
      </li>
    
      
      


      <li>
        
        
          
          
          
          
          
          
          

          
          

          
            <input
              type="checkbox"
              
                class="gdoc-nav__toggle" id="navtree-16f8457f"
                
              
            />
            <label
              
                for="navtree-16f8457f" class="flex justify-between align-center"
              
            >
              <span class="flex">
                
                  <svg class="gdoc-icon package"><use xlink:href="#package"></use></svg>
                
                <a
                  href="/jdk8-src-note/java/lang"
                  class="gdoc-nav__entry"
                >
                  lang
                </a>
              </span>
              
                <svg class="gdoc-icon toggle gdoc_keyboard_arrow_left">
                  <use xlink:href="#gdoc_keyboard_arrow_left"></use>
                </svg>
                <svg class="gdoc-icon toggle gdoc_keyboard_arrow_down">
                  <use xlink:href="#gdoc_keyboard_arrow_down"></use>
                </svg>
              
            </label>
          
        

        
          
  
  


  <ul class="gdoc-nav__list">
    
      
      


      <li>
        
        
          
          
          
          
          
          
          

          
          

          
            <input
              type="checkbox"
              
                class="gdoc-nav__toggle" id="navtree-6ee8b8ce"
                
              
            />
            <label
              
                for="navtree-6ee8b8ce" class="flex justify-between align-center"
              
            >
              <span class="flex">
                
                  <svg class="gdoc-icon package"><use xlink:href="#package"></use></svg>
                
                <a
                  href="/jdk8-src-note/java/lang/reflect"
                  class="gdoc-nav__entry"
                >
                  reflect
                </a>
              </span>
              
                <svg class="gdoc-icon toggle gdoc_keyboard_arrow_left">
                  <use xlink:href="#gdoc_keyboard_arrow_left"></use>
                </svg>
                <svg class="gdoc-icon toggle gdoc_keyboard_arrow_down">
                  <use xlink:href="#gdoc_keyboard_arrow_down"></use>
                </svg>
              
            </label>
          
        

        
          
  
  


  <ul class="gdoc-nav__list">
    
      
      


      <li>
        
        
          
          
          
          
          
          
          

          
          

          
            <input
              type="checkbox"
              
                class="hidden"
              
            />
            <label
              
            >
              <span class="flex">
                
                  <svg class="gdoc-icon interface"><use xlink:href="#interface"></use></svg>
                
                <a
                  href="/jdk8-src-note/java/lang/reflect/Member"
                  class="gdoc-nav__entry"
                >
                  Member
                </a>
              </span>
              
            </label>
          
        

        
      </li>
    
  </ul>

        
      </li>
    
      
      


      <li>
        
        
          
          
          
          
          
          
          

          
          

          
            <input
              type="checkbox"
              
                class="hidden"
              
            />
            <label
              
            >
              <span class="flex">
                
                  <svg class="gdoc-icon interface"><use xlink:href="#interface"></use></svg>
                
                <a
                  href="/jdk8-src-note/java/lang/AutoCloseable"
                  class="gdoc-nav__entry"
                >
                  AutoCloseable
                </a>
              </span>
              
            </label>
          
        

        
      </li>
    
  </ul>

        
      </li>
    
      
      


      <li>
        
        
          
          
          
          
          
          
          

          
          

          
            <input
              type="checkbox"
              
                class="gdoc-nav__toggle" id="navtree-e912e976"
                
              
            />
            <label
              
                for="navtree-e912e976" class="flex justify-between align-center"
              
            >
              <span class="flex">
                
                  <svg class="gdoc-icon package"><use xlink:href="#package"></use></svg>
                
                <a
                  href="/jdk8-src-note/java/nio"
                  class="gdoc-nav__entry"
                >
                  nio
                </a>
              </span>
              
                <svg class="gdoc-icon toggle gdoc_keyboard_arrow_left">
                  <use xlink:href="#gdoc_keyboard_arrow_left"></use>
                </svg>
                <svg class="gdoc-icon toggle gdoc_keyboard_arrow_down">
                  <use xlink:href="#gdoc_keyboard_arrow_down"></use>
                </svg>
              
            </label>
          
        

        
          
  
  


  <ul class="gdoc-nav__list">
    
      
      


      <li>
        
        
          
          
          
          
          
          
          

          
          

          
            <input
              type="checkbox"
              
                class="hidden"
              
            />
            <label
              
            >
              <span class="flex">
                
                  <svg class="gdoc-icon abstractClass"><use xlink:href="#abstractClass"></use></svg>
                
                <a
                  href="/jdk8-src-note/java/nio/Buffer"
                  class="gdoc-nav__entry"
                >
                  Buffer
                </a>
              </span>
              
            </label>
          
        

        
      </li>
    
      
      


      <li>
        
        
          
          
          
          
          
          
          

          
          

          
            <input
              type="checkbox"
              
                class="hidden"
              
            />
            <label
              
            >
              <span class="flex">
                
                  <svg class="gdoc-icon exception"><use xlink:href="#exception"></use></svg>
                
                <a
                  href="/jdk8-src-note/java/nio/BufferOverflowException"
                  class="gdoc-nav__entry"
                >
                  BufferOverflowException
                </a>
              </span>
              
            </label>
          
        

        
      </li>
    
      
      


      <li>
        
        
          
          
          
          
          
          
          

          
          

          
            <input
              type="checkbox"
              
                class="hidden"
              
            />
            <label
              
            >
              <span class="flex">
                
                  <svg class="gdoc-icon exception"><use xlink:href="#exception"></use></svg>
                
                <a
                  href="/jdk8-src-note/java/nio/BufferUnderflowException"
                  class="gdoc-nav__entry"
                >
                  BufferUnderflowException
                </a>
              </span>
              
            </label>
          
        

        
      </li>
    
      
      


      <li>
        
        
          
          
          
          
          
          
          

          
          

          
            <input
              type="checkbox"
              
                class="hidden"
              
            />
            <label
              
            >
              <span class="flex">
                
                  <svg class="gdoc-icon abstractClass"><use xlink:href="#abstractClass"></use></svg>
                
                <a
                  href="/jdk8-src-note/java/nio/ByteBuffer"
                  class="gdoc-nav__entry"
                >
                  ByteBuffer
                </a>
              </span>
              
            </label>
          
        

        
      </li>
    
      
      


      <li>
        
        
          
          
          
          
          
          
          

          
          

          
            <input
              type="checkbox"
              
                class="hidden"
              
            />
            <label
              
            >
              <span class="flex">
                
                  <svg class="gdoc-icon class"><use xlink:href="#class"></use></svg>
                
                <a
                  href="/jdk8-src-note/java/nio/ByteOrder"
                  class="gdoc-nav__entry"
                >
                  ByteOrder
                </a>
              </span>
              
            </label>
          
        

        
      </li>
    
      
      


      <li>
        
        
          
          
          
          
          
          
          

          
          

          
            <input
              type="checkbox"
              
                class="hidden"
              
            />
            <label
              
            >
              <span class="flex">
                
                  <svg class="gdoc-icon exception"><use xlink:href="#exception"></use></svg>
                
                <a
                  href="/jdk8-src-note/java/nio/InvalidMarkException"
                  class="gdoc-nav__entry"
                >
                  InvalidMarkException
                </a>
              </span>
              
            </label>
          
        

        
      </li>
    
      
      


      <li>
        
        
          
          
          
          
          
          
          

          
          

          
            <input
              type="checkbox"
              
                class="hidden"
              
            />
            <label
              
            >
              <span class="flex">
                
                  <svg class="gdoc-icon exception"><use xlink:href="#exception"></use></svg>
                
                <a
                  href="/jdk8-src-note/java/nio/ReadOnlyBufferException"
                  class="gdoc-nav__entry"
                >
                  ReadOnlyBufferException
                </a>
              </span>
              
            </label>
          
        

        
      </li>
    
  </ul>

        
      </li>
    
      
      


      <li>
        
        
          
          
          
          
          
          
          

          
          

          
            <input
              type="checkbox"
              
                class="gdoc-nav__toggle" id="navtree-5046b546"
                checked
              
            />
            <label
              
                for="navtree-5046b546" class="flex justify-between align-center"
              
            >
              <span class="flex">
                
                  <svg class="gdoc-icon package"><use xlink:href="#package"></use></svg>
                
                <a
                  href="/jdk8-src-note/java/util"
                  class="gdoc-nav__entry"
                >
                  util
                </a>
              </span>
              
                <svg class="gdoc-icon toggle gdoc_keyboard_arrow_left">
                  <use xlink:href="#gdoc_keyboard_arrow_left"></use>
                </svg>
                <svg class="gdoc-icon toggle gdoc_keyboard_arrow_down">
                  <use xlink:href="#gdoc_keyboard_arrow_down"></use>
                </svg>
              
            </label>
          
        

        
          
  
  


  <ul class="gdoc-nav__list">
    
      
      


      <li>
        
        
          
          
          
          
          
          
          

          
          

          
        

        
      </li>
    
      
      


      <li>
        
        
          
          
          
          
          
          
          

          
          

          
            <input
              type="checkbox"
              
                class="hidden"
              
            />
            <label
              
            >
              <span class="flex">
                
                  <svg class="gdoc-icon abstractClass"><use xlink:href="#abstractClass"></use></svg>
                
                <a
                  href="/jdk8-src-note/java/util/AbstractCollection"
                  class="gdoc-nav__entry"
                >
                  AbstractCollection
                </a>
              </span>
              
            </label>
          
        

        
      </li>
    
      
      


      <li>
        
        
          
          
          
          
          
          
          

          
          

          
            <input
              type="checkbox"
              
                class="hidden"
              
            />
            <label
              
            >
              <span class="flex">
                
                  <svg class="gdoc-icon abstractClass"><use xlink:href="#abstractClass"></use></svg>
                
                <a
                  href="/jdk8-src-note/java/util/AbstractList"
                  class="gdoc-nav__entry"
                >
                  AbstractList
                </a>
              </span>
              
            </label>
          
        

        
      </li>
    
      
      


      <li>
        
        
          
          
          
          
          
          
          

          
          

          
            <input
              type="checkbox"
              
                class="hidden"
              
            />
            <label
              
            >
              <span class="flex">
                
                  <svg class="gdoc-icon abstractClass"><use xlink:href="#abstractClass"></use></svg>
                
                <a
                  href="/jdk8-src-note/java/util/AbstractMap"
                  class="gdoc-nav__entry"
                >
                  AbstractMap
                </a>
              </span>
              
            </label>
          
        

        
      </li>
    
      
      


      <li>
        
        
          
          
          
          
          
          
          

          
          

          
            <input
              type="checkbox"
              
                class="hidden"
              
            />
            <label
              
            >
              <span class="flex">
                
                  <svg class="gdoc-icon abstractClass"><use xlink:href="#abstractClass"></use></svg>
                
                <a
                  href="/jdk8-src-note/java/util/AbstractSequentialList"
                  class="gdoc-nav__entry"
                >
                  AbstractSequentialList
                </a>
              </span>
              
            </label>
          
        

        
      </li>
    
      
      


      <li>
        
        
          
          
          
          
          
          
          

          
          

          
            <input
              type="checkbox"
              
                class="hidden"
              
            />
            <label
              
            >
              <span class="flex">
                
                  <svg class="gdoc-icon class"><use xlink:href="#class"></use></svg>
                
                <a
                  href="/jdk8-src-note/java/util/ArrayList"
                  class="gdoc-nav__entry is-active"
                >
                  ArrayList
                </a>
              </span>
              
            </label>
          
        

        
      </li>
    
      
      


      <li>
        
        
          
          
          
          
          
          
          

          
          

          
            <input
              type="checkbox"
              
                class="hidden"
              
            />
            <label
              
            >
              <span class="flex">
                
                  <svg class="gdoc-icon interface"><use xlink:href="#interface"></use></svg>
                
                <a
                  href="/jdk8-src-note/java/util/Collection"
                  class="gdoc-nav__entry"
                >
                  Collection
                </a>
              </span>
              
            </label>
          
        

        
      </li>
    
      
      


      <li>
        
        
          
          
          
          
          
          
          

          
          

          
            <input
              type="checkbox"
              
                class="hidden"
              
            />
            <label
              
            >
              <span class="flex">
                
                  <svg class="gdoc-icon interface"><use xlink:href="#interface"></use></svg>
                
                <a
                  href="/jdk8-src-note/java/util/Deque"
                  class="gdoc-nav__entry"
                >
                  Deque
                </a>
              </span>
              
            </label>
          
        

        
      </li>
    
      
      


      <li>
        
        
          
          
          
          
          
          
          

          
          

          
            <input
              type="checkbox"
              
                class="hidden"
              
            />
            <label
              
            >
              <span class="flex">
                
                  <svg class="gdoc-icon interface"><use xlink:href="#interface"></use></svg>
                
                <a
                  href="/jdk8-src-note/java/util/Iterator"
                  class="gdoc-nav__entry"
                >
                  Iterator
                </a>
              </span>
              
            </label>
          
        

        
      </li>
    
      
      


      <li>
        
        
          
          
          
          
          
          
          

          
          

          
            <input
              type="checkbox"
              
                class="hidden"
              
            />
            <label
              
            >
              <span class="flex">
                
                  <svg class="gdoc-icon class"><use xlink:href="#class"></use></svg>
                
                <a
                  href="/jdk8-src-note/java/util/LinkedList"
                  class="gdoc-nav__entry"
                >
                  LinkedList
                </a>
              </span>
              
            </label>
          
        

        
      </li>
    
      
      


      <li>
        
        
          
          
          
          
          
          
          

          
          

          
            <input
              type="checkbox"
              
                class="hidden"
              
            />
            <label
              
            >
              <span class="flex">
                
                  <svg class="gdoc-icon interface"><use xlink:href="#interface"></use></svg>
                
                <a
                  href="/jdk8-src-note/java/util/List"
                  class="gdoc-nav__entry"
                >
                  List
                </a>
              </span>
              
            </label>
          
        

        
      </li>
    
      
      


      <li>
        
        
          
          
          
          
          
          
          

          
          

          
            <input
              type="checkbox"
              
                class="hidden"
              
            />
            <label
              
            >
              <span class="flex">
                
                  <svg class="gdoc-icon interface"><use xlink:href="#interface"></use></svg>
                
                <a
                  href="/jdk8-src-note/java/util/ListIterator"
                  class="gdoc-nav__entry"
                >
                  ListIterator
                </a>
              </span>
              
            </label>
          
        

        
      </li>
    
      
      


      <li>
        
        
          
          
          
          
          
          
          

          
          

          
            <input
              type="checkbox"
              
                class="hidden"
              
            />
            <label
              
            >
              <span class="flex">
                
                  <svg class="gdoc-icon interface"><use xlink:href="#interface"></use></svg>
                
                <a
                  href="/jdk8-src-note/java/util/Map"
                  class="gdoc-nav__entry"
                >
                  Map
                </a>
              </span>
              
            </label>
          
        

        
      </li>
    
      
      


      <li>
        
        
          
          
          
          
          
          
          

          
          

          
            <input
              type="checkbox"
              
                class="hidden"
              
            />
            <label
              
            >
              <span class="flex">
                
                  <svg class="gdoc-icon interface"><use xlink:href="#interface"></use></svg>
                
                <a
                  href="/jdk8-src-note/java/util/Queue"
                  class="gdoc-nav__entry"
                >
                  Queue
                </a>
              </span>
              
            </label>
          
        

        
      </li>
    
      
      


      <li>
        
        
          
          
          
          
          
          
          

          
          

          
            <input
              type="checkbox"
              
                class="hidden"
              
            />
            <label
              
            >
              <span class="flex">
                
                  <svg class="gdoc-icon interface"><use xlink:href="#interface"></use></svg>
                
                <a
                  href="/jdk8-src-note/java/util/RandomAccess"
                  class="gdoc-nav__entry"
                >
                  RandomAccess
                </a>
              </span>
              
            </label>
          
        

        
      </li>
    
      
      


      <li>
        
        
          
          
          
          
          
          
          

          
          

          
            <input
              type="checkbox"
              
                class="hidden"
              
            />
            <label
              
            >
              <span class="flex">
                
                  <svg class="gdoc-icon class"><use xlink:href="#class"></use></svg>
                
                <a
                  href="/jdk8-src-note/java/util/Vector"
                  class="gdoc-nav__entry"
                >
                  Vector
                </a>
              </span>
              
            </label>
          
        

        
      </li>
    
  </ul>

        
      </li>
    
  </ul>

        
      </li>
    
      
      


      <li>
        
        
          
          
          
          
          
          
          

          
          

          
            <input
              type="checkbox"
              
                class="hidden"
              
            />
            <label
              
            >
              <span class="flex">
                
                  <svg class="gdoc-icon package"><use xlink:href="#package"></use></svg>
                
                <a
                  href="/jdk8-src-note/javax"
                  class="gdoc-nav__entry"
                >
                  javax
                </a>
              </span>
              
            </label>
          
        

        
          
  
  


  <ul class="gdoc-nav__list">
    
      
      


      <li>
        
        
          
          
          
          
          
          
          

          
          

          
            <input
              type="checkbox"
              
                class="gdoc-nav__toggle" id="navtree-5738ba92"
                
              
            />
            <label
              
                for="navtree-5738ba92" class="flex justify-between align-center"
              
            >
              <span class="flex">
                
                  <svg class="gdoc-icon package"><use xlink:href="#package"></use></svg>
                
                <a
                  href="/jdk8-src-note/javax/annotation"
                  class="gdoc-nav__entry"
                >
                  annotation
                </a>
              </span>
              
                <svg class="gdoc-icon toggle gdoc_keyboard_arrow_left">
                  <use xlink:href="#gdoc_keyboard_arrow_left"></use>
                </svg>
                <svg class="gdoc-icon toggle gdoc_keyboard_arrow_down">
                  <use xlink:href="#gdoc_keyboard_arrow_down"></use>
                </svg>
              
            </label>
          
        

        
          
  
  


  <ul class="gdoc-nav__list">
    
      
      


      <li>
        
        
          
          
          
          
          
          
          

          
          

          
            <input
              type="checkbox"
              
                class="hidden"
              
            />
            <label
              
            >
              <span class="flex">
                
                  <svg class="gdoc-icon annotation"><use xlink:href="#annotation"></use></svg>
                
                <a
                  href="/jdk8-src-note/javax/annotation/Resource"
                  class="gdoc-nav__entry"
                >
                  Resource
                </a>
              </span>
              
            </label>
          
        

        
      </li>
    
  </ul>

        
      </li>
    
  </ul>

        
      </li>
    
  </ul>






    
  </section>

  


  <section class="gdoc-nav--more">
    
  </section>
</nav>

          </aside>
        


        <div class="gdoc-page">
          
  


  






<div
  class="gdoc-page__header flex flex-wrap
  
    justify-between
  
  hidden-mobile
  "
  itemprop="breadcrumb"
>
  
    <div>
      <svg class="gdoc-icon gdoc_path hidden-mobile"><use xlink:href="#gdoc_path"></use></svg>
      <ol class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList">
        
        
        
        
  
  
    
    
    
    
  
  
    
    
    
    
  
  
    
    
    
    
  
  
    <li itemprop='itemListElement' itemscope itemtype='https://schema.org/ListItem'><a itemscope itemtype='https://schema.org/WebPage' itemprop='item' itemid='/jdk8-src-note/' href='/jdk8-src-note/'><span itemprop='name'>JDK8源码阅读笔记</span></a><meta itemprop='position' content='2' /></li><li> / </li><li itemprop='itemListElement' itemscope itemtype='https://schema.org/ListItem'><a itemscope itemtype='https://schema.org/WebPage' itemprop='item' itemid='/jdk8-src-note/java/' href='/jdk8-src-note/java/'><span itemprop='name'>java</span></a><meta itemprop='position' content='3' /></li><li> / </li><li itemprop='itemListElement' itemscope itemtype='https://schema.org/ListItem'><a itemscope itemtype='https://schema.org/WebPage' itemprop='item' itemid='/jdk8-src-note/java/util/' href='/jdk8-src-note/java/util/'><span itemprop='name'>util</span></a><meta itemprop='position' content='4' /></li><li> / </li><li itemprop='itemListElement' itemscope itemtype='https://schema.org/ListItem'><span itemprop='name'>ArrayList</span><meta itemprop='position' content='5' /></li>
  

  

  

  

      </ol>
    </div>
  
  
</div>



  <article
    class="gdoc-markdown gdoc-markdown__align--left"
  >
    <h1>ArrayList</h1>
    <hr>
<div class="gdoc-toc gdoc-toc__level--6">
      <nav id="TableOfContents">
  <ul>
    <li><a href="#1-private-static-final-long-serialversionuid--8683452581122892189l">1. private static final long serialVersionUID = 8683452581122892189L;</a></li>
    <li><a href="#2-private-static-final-int-default_capacity--10">2. private static final int DEFAULT_CAPACITY = 10;</a></li>
    <li><a href="#3-private-static-final-object-empty_elementdata--">3. private static final Object[] EMPTY_ELEMENTDATA = {};</a></li>
    <li><a href="#4-private-static-final-object-defaultcapacity_empty_elementdata--">4. private static final Object[] DEFAULTCAPACITY_EMPTY_ELEMENTDATA = {};</a></li>
    <li><a href="#5-transient-object-elementdata">5. transient Object[] elementData;</a></li>
    <li><a href="#6-private-int-size">6. private int size;</a></li>
    <li><a href="#7-public-arraylistint-initialcapacity">7. public ArrayList(int initialCapacity)</a></li>
    <li><a href="#8-public-arraylist">8. public ArrayList()</a></li>
    <li><a href="#9-public-arraylistcollection-extends-e-c">9. public ArrayList(Collection&lt;? extends E&gt; c)</a></li>
    <li><a href="#10-public-void-trimtosize">10. public void trimToSize()</a></li>
    <li><a href="#11-public-void-ensurecapacityint-mincapacity">11. public void ensureCapacity(int minCapacity)</a></li>
    <li><a href="#12-private-static-int-calculatecapacityobject-elementdata-int-mincapacity">12. private static int calculateCapacity(Object[] elementData, int minCapacity)</a></li>
    <li><a href="#13-private-void-ensurecapacityinternalint-mincapacity">13. private void ensureCapacityInternal(int minCapacity)</a></li>
    <li><a href="#14-private-void-ensureexplicitcapacityint-mincapacity">14. private void ensureExplicitCapacity(int minCapacity)</a></li>
    <li><a href="#15-private-static-final-int-max_array_size--integermax_value---8">15. private static final int MAX_ARRAY_SIZE = Integer.MAX_VALUE - 8</a></li>
    <li><a href="#16-private-void-growint-mincapacity">16. private void grow(int minCapacity)</a></li>
    <li><a href="#17-private-static-int-hugecapacityint-mincapacity">17. private static int hugeCapacity(int minCapacity)</a></li>
    <li><a href="#18-public-int-size">18. public int size()</a></li>
    <li><a href="#19-public-boolean-isempty">19. public boolean isEmpty()</a></li>
    <li><a href="#20-public-boolean-containsobject-o">20. public boolean contains(Object o)</a></li>
    <li><a href="#21-public-int-indexofobject-o">21. public int indexOf(Object o)</a></li>
    <li><a href="#22-public-int-lastindexofobject-o">22. public int lastIndexOf(Object o)</a></li>
    <li><a href="#23-public-object-clone">23. public Object clone()</a></li>
    <li><a href="#24-public-object-toarray">24. public Object[] toArray()</a></li>
    <li><a href="#25-public-ltt-t-toarrayt-a">25. public &lt;T&gt; T[] toArray(T[] a)</a></li>
    <li><a href="#26-e-elementdataint-index">26. E elementData(int index)</a></li>
    <li><a href="#27-public-e-getint-index">27. public E get(int index)</a></li>
    <li><a href="#28-public-e-setint-index-e-element">28. public E set(int index, E element)</a></li>
    <li><a href="#29-public-boolean-adde-e">29. public boolean add(E e)</a></li>
    <li><a href="#30-public-void-addint-index-e-element">30. public void add(int index, E element)</a></li>
    <li><a href="#31-public-e-removeint-index">31. public E remove(int index)</a></li>
    <li><a href="#32-public-boolean-removeobject-o">32. public boolean remove(Object o)</a></li>
    <li><a href="#33-private-void-fastremoveint-index">33. private void fastRemove(int index)</a></li>
    <li><a href="#34-public-void-clear">34. public void clear()</a></li>
    <li><a href="#35-public-boolean-addallcollection-extends-e-c">35. public boolean addAll(Collection&lt;? extends E&gt; c)</a></li>
    <li><a href="#36-public-boolean-addallint-index-collection-extends-e-c">36. public boolean addAll(int index, Collection&lt;? extends E&gt; c)</a></li>
    <li><a href="#37-protected-void-removerangeint-fromindex-int-toindex">37. protected void removeRange(int fromIndex, int toIndex)</a></li>
    <li><a href="#38-private-void-rangecheckint-index">38. private void rangeCheck(int index)</a></li>
    <li><a href="#39-private-void-rangecheckforaddint-index">39. private void rangeCheckForAdd(int index)</a></li>
    <li><a href="#40-private-string-outofboundsmsgint-index">40. private String outOfBoundsMsg(int index)</a></li>
    <li><a href="#41-public-boolean-removeallcollection-c">41. public boolean removeAll(Collection<!-- raw HTML omitted --> c)</a></li>
    <li><a href="#42-public-boolean-retainallcollection-c">42. public boolean retainAll(Collection<!-- raw HTML omitted --> c)</a></li>
    <li><a href="#43-private-boolean-batchremovecollection-c-boolean-complement">43. private boolean batchRemove(Collection<!-- raw HTML omitted --> c, boolean complement)</a></li>
    <li><a href="#44-private-void-writeobjectjavaioobjectoutputstream-s">44. private void writeObject(java.io.ObjectOutputStream s)</a></li>
    <li><a href="#45-private-void-readobjectjavaioobjectinputstream-s">45. private void readObject(java.io.ObjectInputStream s)</a></li>
    <li><a href="#46-public-listiteratorlte-listiteratorint-index">46. public ListIterator&lt;E&gt; listIterator(int index)</a></li>
    <li><a href="#47-public-listiteratorlte-listiterator">47. public ListIterator&lt;E&gt; listIterator()</a></li>
    <li><a href="#48-public-iteratorlte-iterator">48. public Iterator&lt;E&gt; iterator()</a></li>
    <li><a href="#49-private-class-itr-implements-iteratorlte">49. private class Itr implements Iterator&lt;E&gt;</a>
      <ul>
        <li><a href="#491-int-cursor">49.1 int cursor;</a></li>
        <li><a href="#492-int-lastret---1">49.2 int lastRet = -1;</a></li>
        <li><a href="#493-int-expectedmodcount--modcount">49.3 int expectedModCount = modCount;</a></li>
        <li><a href="#494-itr">49.4 Itr()</a></li>
        <li><a href="#495-public-boolean-hasnext">49.5 public boolean hasNext()</a></li>
        <li><a href="#496-public-e-next">49.6 public E next()</a></li>
        <li><a href="#497-public-void-remove">49.7 public void remove()</a></li>
        <li><a href="#498-public-void-foreachremainingconsumer-consumer">49.8 public void forEachRemaining(Consumer consumer)</a></li>
        <li><a href="#499-final-void-checkforcomodification">49.9 final void checkForComodification()</a></li>
      </ul>
    </li>
    <li><a href="#50-private-class-listitr-extends-itr-implements-listiteratorlte">50. private class ListItr extends Itr implements ListIterator&lt;E&gt;</a>
      <ul>
        <li><a href="#501-listitrint-index">50.1 ListItr(int index)</a></li>
        <li><a href="#502-public-boolean-hasprevious">50.2 public boolean hasPrevious()</a></li>
        <li><a href="#503-public-int-nextindex">50.3 public int nextIndex()</a></li>
        <li><a href="#504-public-int-previousindex">50.4 public int previousIndex()</a></li>
        <li><a href="#505-public-e-previous">50.5 public E previous()</a></li>
        <li><a href="#506-public-void-sete-e">50.6 public void set(E e)</a></li>
        <li><a href="#507-public-void-adde-e">50.7 public void add(E e)</a></li>
      </ul>
    </li>
    <li><a href="#51-public-listlte-sublistint-fromindex-int-toindex">51. public List&lt;E&gt; subList(int fromIndex, int toIndex)</a></li>
    <li><a href="#52-static-void-sublistrangecheckint-fromindex-int-toindex-int-size">52. static void subListRangeCheck(int fromIndex, int toIndex, int size)</a></li>
    <li><a href="#53-private-class-sublist-extends-abstractlistlte-implements-randomaccess">53. private class SubList extends AbstractList&lt;E&gt; implements RandomAccess</a>
      <ul>
        <li><a href="#531-private-final-abstractlistlte-parent">53.1 private final AbstractList&lt;E&gt; parent;</a></li>
        <li><a href="#532-private-final-int-parentoffset">53.2 private final int parentOffset;</a></li>
        <li><a href="#533-private-final-int-offset">53.3 private final int offset;</a></li>
        <li><a href="#534-int-size">53.4 int size;</a></li>
        <li><a href="#535-sublistabstractlistlte-parent-int-offset-int-fromindex-int-toindex">53.5 SubList(AbstractList&lt;E&gt; parent, int offset, int fromIndex, int toIndex)</a></li>
        <li><a href="#536-public-e-setint-index-e-e">53.6 public E set(int index, E e)</a></li>
        <li><a href="#537-public-e-getint-index">53.7 public E get(int index)</a></li>
        <li><a href="#538-public-int-size">53.8 public int size()</a></li>
        <li><a href="#539-public-void-addint-index-e-e">53.9 public void add(int index, E e)</a></li>
        <li><a href="#5310-public-e-removeint-index">53.10 public E remove(int index)</a></li>
        <li><a href="#5311-protected-void-removerangeint-fromindex-int-toindex">53.11 protected void removeRange(int fromIndex, int toIndex)</a></li>
        <li><a href="#5312-public-boolean-addallcollection-extends-e-c">53.12 public boolean addAll(Collection&lt;? extends E&gt; c)</a></li>
        <li><a href="#5313-public-boolean-addallint-index-collection-extends-e-c">53.13 public boolean addAll(int index, Collection&lt;? extends E&gt; c)</a></li>
        <li><a href="#5314-public-iteratorlte-iterator">53.14 public Iterator&lt;E&gt; iterator()</a></li>
        <li><a href="#5315-public-listiteratorlte-listiteratorfinal-int-index">53.15 public ListIterator&lt;E&gt; listIterator(final int index)</a></li>
        <li><a href="#5316-public-listlte-sublistint-fromindex-int-toindex">53.16 public List&lt;E&gt; subList(int fromIndex, int toIndex)</a></li>
        <li><a href="#5317-private-void-rangecheckint-index">53.17 private void rangeCheck(int index)</a></li>
        <li><a href="#5318-private-void-rangecheckforaddint-index">53.18 private void rangeCheckForAdd(int index)</a></li>
        <li><a href="#5319-private-string-outofboundsmsgint-index">53.19 private String outOfBoundsMsg(int index)</a></li>
        <li><a href="#5320-private-void-checkforcomodification">53.20 private void checkForComodification()</a></li>
        <li><a href="#5321-public-spliteratorlte-spliterator">53.21 public Spliterator&lt;E&gt; spliterator()</a></li>
      </ul>
    </li>
    <li><a href="#54-public-void-foreachconsumer-super-e-action">54. public void forEach(Consumer&lt;? super E&gt; action)</a></li>
    <li><a href="#55-public-spliteratorlte-spliterator">55. public Spliterator&lt;E&gt; spliterator()</a></li>
    <li><a href="#56-static-final-class-arraylistspliteratorlte-implements-spliteratorlte">56. static final class ArrayListSpliterator&lt;E&gt; implements Spliterator&lt;E&gt;</a>
      <ul>
        <li><a href="#561-private-final-arraylistlte-list">56.1 private final ArrayList&lt;E&gt; list;</a></li>
        <li><a href="#562-private-int-index">56.2 private int index;</a></li>
        <li><a href="#563-private-int-fence">56.3 private int fence;</a></li>
        <li><a href="#564-private-int-expectedmodcount">56.4 private int expectedModCount;</a></li>
        <li><a href="#565-arraylistspliteratorarraylistlte-list-int-origin-int-fence-int-expectedmodcount">56.5 ArrayListSpliterator(ArrayList&lt;E&gt; list, int origin, int fence, int expectedModCount)</a></li>
        <li><a href="#566-private-int-getfence">56.6 private int getFence()</a></li>
        <li><a href="#567-public-arraylistspliteratorlte-trysplit">56.7 public ArrayListSpliterator&lt;E&gt; trySplit()</a></li>
        <li><a href="#568-public-boolean-tryadvanceconsumer-super-e-action">56.8 public boolean tryAdvance(Consumer&lt;? super E&gt; action)</a></li>
        <li><a href="#569-public-void-foreachremainingconsumer-super-e-action">56.9 public void forEachRemaining(Consumer&lt;? super E&gt; action)</a></li>
        <li><a href="#5610-public-long-estimatesize">56.10 public long estimateSize()</a></li>
        <li><a href="#5611-public-int-characteristics">56.11 public int characteristics()</a></li>
      </ul>
    </li>
    <li><a href="#57-public-boolean-removeifpredicate-super-e-filter">57. public boolean removeIf(Predicate&lt;? super E&gt; filter)</a></li>
    <li><a href="#58-public-void-replaceallunaryoperatorlte-operator">58. public void replaceAll(UnaryOperator&lt;E&gt; operator)</a></li>
    <li><a href="#59-public-void-sortcomparator-super-e-c">59. public void sort(Comparator&lt;? super E&gt; c)</a></li>
  </ul>
</nav>
      <hr />
    </div>

<div style='text-align: center'>
    <img src='https://img.hongmao.run/blog/2021/07/ArrayList.png' width='70%' alt=''>
</div>


<hr>
<p><code>List</code>接口的可变数组实现，实现了所有可选的列表操作，并允许存放所有元素，包括<code>null</code>。除了实现<code>List</code>接口之外，<code>ArrayList</code>类还提供一些方法来操作用于内部存储列表数组的大小。该类和<code>Vector</code>类大体类似，除了本类是非同步的。</p>
<p><code>size</code>、<code>isEmpty</code>、<code>get</code>、<code>set</code>、<code>iterator</code>和<code>listIterator</code>操作均在恒定时间内运行。<code>add</code>操作执行需要均摊恒定时间，也即新增<code>n</code>个元素需要的时间为<code>O(n)</code>。所有其他操作都在线性时间内运行（粗略地说）。该实现与<code>LinkedList</code>实现相比，常量因子较低。</p>
<p>每个<code>ArrayList</code>实例都有一个容量。容量是用于在列表中存储元素的数组的大小。它总是至少与列表大小一样大。将元素添加到<code>ArrayList</code>，其容量会自动增长。除了添加元素具有固定的摊销时间成本外，没有指定扩充策略的详细信息。</p>
<p>在添加大量元素之前，应用程序可以使用<code>ensureCapacity</code>操作先增加<code>ArrayList</code>实例的容量。这可以减少增量重新分配的数量。</p>
<p>需要注意，本实现是非同步的，如果多个线程同时访问<code>ArrayList</code>实例，并且至少一个线程修改了列表结构，则它必须通过外部实现同步。（结构上的修改是指添加或删除一个或多个元素，或显式调整后备数组大小的任何操作；仅设置元素的值不是结构上的修改。）通常，是通过在自然封装列表的某个对象上进行同步来完成此操作。</p>
<p>如果不存在这样的对象，则应使用<code>Collections#synchronizedList</code>方法“包装”列表。最好在创建列表时完成此操作，以防止意外不同步的访问列表：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#000">List</span> <span style="color:#000">list</span> <span style="color:#000">=</span> <span style="color:#000">Collections</span>.<span style="color:#836c28">synchronizedList</span>(<span style="color:#a90d91">new</span> <span style="color:#000">ArrayList</span>(...));
</span></span></code></pre></div><p>此类的<code>iterator()</code>和<code>listIterator(int)</code>方法返回的迭代器采用的是“快速失败”机制：如果列表在迭代器创建后的任意时间、以任意方式进行了结构上的改动，除了通过迭代器自己的<code>ListIterator#remove()</code>或<code>ListIterator#add(Object)</code>方法外，迭代器都将抛出<code>ConcurrentModificationException</code>异常。因此，面对并发修改，迭代器会快速干净地失败，而不会在未来的不确定时间面临任意、不确定行为的风险。</p>
<p>请注意，迭代器的“快速失败”行为无法得到保证，因为通常来说，在存在不同步的并发修改的情况下，不可能做出任何严格的保证。“快速失败”的迭代器会尽最大努力抛出<code>ConcurrentModificationException</code>。因此，编写依赖于此异常的程序以确保其正确性是错误的：迭代器的“快速失败”行为应仅用于检测bug。</p>
<p>该类是Java集合框架的成员类。</p>
<hr>
<div class="flex align-center gdoc-page__anchorwrap">
    <h1 id="1-private-static-final-long-serialversionuid--8683452581122892189l"
    >
        1. private static final long serialVersionUID = 8683452581122892189L;
    </h1>
    <a data-clipboard-text="https://hongmao.run/jdk8-src-note/java/util/ArrayList/#1-private-static-final-long-serialversionuid--8683452581122892189l" class="gdoc-page__anchor clip flex align-center" title="锚定到： 1. private static final long serialVersionUID = 8683452581122892189L;" aria-label="锚定到： 1. private static final long serialVersionUID = 8683452581122892189L;" href="#1-private-static-final-long-serialversionuid--8683452581122892189l">
        <svg class="gdoc-icon gdoc_link"><use xlink:href="#gdoc_link"></use></svg>
    </a>
</div>
<p>序列化版本唯一ID。</p>
<hr>
<div class="flex align-center gdoc-page__anchorwrap">
    <h1 id="2-private-static-final-int-default_capacity--10"
    >
        2. private static final int DEFAULT_CAPACITY = 10;
    </h1>
    <a data-clipboard-text="https://hongmao.run/jdk8-src-note/java/util/ArrayList/#2-private-static-final-int-default_capacity--10" class="gdoc-page__anchor clip flex align-center" title="锚定到： 2. private static final int DEFAULT_CAPACITY = 10;" aria-label="锚定到： 2. private static final int DEFAULT_CAPACITY = 10;" href="#2-private-static-final-int-default_capacity--10">
        <svg class="gdoc-icon gdoc_link"><use xlink:href="#gdoc_link"></use></svg>
    </a>
</div>
<p>当前列表的默认初始容量。</p>
<hr>
<div class="flex align-center gdoc-page__anchorwrap">
    <h1 id="3-private-static-final-object-empty_elementdata--"
    >
        3. private static final Object[] EMPTY_ELEMENTDATA = {};
    </h1>
    <a data-clipboard-text="https://hongmao.run/jdk8-src-note/java/util/ArrayList/#3-private-static-final-object-empty_elementdata--" class="gdoc-page__anchor clip flex align-center" title="锚定到： 3. private static final Object[] EMPTY_ELEMENTDATA = {};" aria-label="锚定到： 3. private static final Object[] EMPTY_ELEMENTDATA = {};" href="#3-private-static-final-object-empty_elementdata--">
        <svg class="gdoc-icon gdoc_link"><use xlink:href="#gdoc_link"></use></svg>
    </a>
</div>
<p>用于空实例的共享空数组实例。</p>
<hr>
<div class="flex align-center gdoc-page__anchorwrap">
    <h1 id="4-private-static-final-object-defaultcapacity_empty_elementdata--"
    >
        4. private static final Object[] DEFAULTCAPACITY_EMPTY_ELEMENTDATA = {};
    </h1>
    <a data-clipboard-text="https://hongmao.run/jdk8-src-note/java/util/ArrayList/#4-private-static-final-object-defaultcapacity_empty_elementdata--" class="gdoc-page__anchor clip flex align-center" title="锚定到： 4. private static final Object[] DEFAULTCAPACITY_EMPTY_ELEMENTDATA = {};" aria-label="锚定到： 4. private static final Object[] DEFAULTCAPACITY_EMPTY_ELEMENTDATA = {};" href="#4-private-static-final-object-defaultcapacity_empty_elementdata--">
        <svg class="gdoc-icon gdoc_link"><use xlink:href="#gdoc_link"></use></svg>
    </a>
</div>
<p>共享的空数组实例，用于默认大小的空实例。将它与<code>EMPTY_ELEMENTDATA</code>区别开来，是为了了解添加第一个元素时要扩充多少。</p>
<hr>
<div class="flex align-center gdoc-page__anchorwrap">
    <h1 id="5-transient-object-elementdata"
    >
        5. transient Object[] elementData;
    </h1>
    <a data-clipboard-text="https://hongmao.run/jdk8-src-note/java/util/ArrayList/#5-transient-object-elementdata" class="gdoc-page__anchor clip flex align-center" title="锚定到： 5. transient Object[] elementData;" aria-label="锚定到： 5. transient Object[] elementData;" href="#5-transient-object-elementdata">
        <svg class="gdoc-icon gdoc_link"><use xlink:href="#gdoc_link"></use></svg>
    </a>
</div>
<p>数组缓冲区，<code>ArrayList</code>的元素便存储在其中。<code>ArrayList</code>的容量就是这个数组缓冲区的长度。添加第一个元素时，任何满足<code>elementData == DEFAULTCAPACITY_EMPTY_ELEMENTDATA</code>的空<code>ArrayList</code>的容量都将扩展为<code>DEFAULT_CAPACITY</code>。</p>
<p>该属性的访问修饰符非私有，以简化嵌套类访问。</p>
<hr>
<div class="flex align-center gdoc-page__anchorwrap">
    <h1 id="6-private-int-size"
    >
        6. private int size;
    </h1>
    <a data-clipboard-text="https://hongmao.run/jdk8-src-note/java/util/ArrayList/#6-private-int-size" class="gdoc-page__anchor clip flex align-center" title="锚定到： 6. private int size;" aria-label="锚定到： 6. private int size;" href="#6-private-int-size">
        <svg class="gdoc-icon gdoc_link"><use xlink:href="#gdoc_link"></use></svg>
    </a>
</div>
<p><code>ArrayList</code>的大小（包含的元素数量）。</p>
<hr>
<div class="flex align-center gdoc-page__anchorwrap">
    <h1 id="7-public-arraylistint-initialcapacity"
    >
        7. public ArrayList(int initialCapacity)
    </h1>
    <a data-clipboard-text="https://hongmao.run/jdk8-src-note/java/util/ArrayList/#7-public-arraylistint-initialcapacity" class="gdoc-page__anchor clip flex align-center" title="锚定到： 7. public ArrayList(int initialCapacity)" aria-label="锚定到： 7. public ArrayList(int initialCapacity)" href="#7-public-arraylistint-initialcapacity">
        <svg class="gdoc-icon gdoc_link"><use xlink:href="#gdoc_link"></use></svg>
    </a>
</div>
<p>构造一个具有指定初始容量的空列表。</p>
<p>源码如下：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#a90d91">public</span> <span style="color:#000">ArrayList</span>(<span style="color:#a90d91">int</span> <span style="color:#000">initialCapacity</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">if</span> (<span style="color:#000">initialCapacity</span> <span style="color:#000">&gt;</span> <span style="color:#000">0</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#177500">// 指定容量大于0，初始化一个指定容量的数组赋值给elementData</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a90d91">this</span>.<span style="color:#836c28">elementData</span> <span style="color:#000">=</span> <span style="color:#a90d91">new</span> <span style="color:#000">Object</span><span style="color:#000">[</span><span style="color:#000">initialCapacity</span><span style="color:#000">]</span>;
</span></span><span style="display:flex;"><span>    } <span style="color:#a90d91">else</span> <span style="color:#a90d91">if</span> (<span style="color:#000">initialCapacity</span> <span style="color:#000">==</span> <span style="color:#000">0</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#177500">// 指定容量等于0，elementData直接取空数组</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a90d91">this</span>.<span style="color:#836c28">elementData</span> <span style="color:#000">=</span> <span style="color:#000">EMPTY_ELEMENTDATA</span>;
</span></span><span style="display:flex;"><span>    } <span style="color:#a90d91">else</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#177500">// 指定容量小于0，抛出异常</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a90d91">throw</span> <span style="color:#a90d91">new</span> <span style="color:#000">IllegalArgumentException</span>(<span style="color:#c41a16">&#34;Illegal Capacity: &#34;</span><span style="color:#000">+</span>
</span></span><span style="display:flex;"><span>                                           <span style="color:#000">initialCapacity</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><hr>
<div class="flex align-center gdoc-page__anchorwrap">
    <h1 id="8-public-arraylist"
    >
        8. public ArrayList()
    </h1>
    <a data-clipboard-text="https://hongmao.run/jdk8-src-note/java/util/ArrayList/#8-public-arraylist" class="gdoc-page__anchor clip flex align-center" title="锚定到： 8. public ArrayList()" aria-label="锚定到： 8. public ArrayList()" href="#8-public-arraylist">
        <svg class="gdoc-icon gdoc_link"><use xlink:href="#gdoc_link"></use></svg>
    </a>
</div>
<p>构造一个初始容量为10的空列表。</p>
<p>源码如下：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#a90d91">public</span> <span style="color:#000">ArrayList</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">this</span>.<span style="color:#836c28">elementData</span> <span style="color:#000">=</span> <span style="color:#000">DEFAULTCAPACITY_EMPTY_ELEMENTDATA</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><hr>
<div class="flex align-center gdoc-page__anchorwrap">
    <h1 id="9-public-arraylistcollection-extends-e-c"
    >
        9. public ArrayList(Collection&lt;? extends E&gt; c)
    </h1>
    <a data-clipboard-text="https://hongmao.run/jdk8-src-note/java/util/ArrayList/#9-public-arraylistcollection-extends-e-c" class="gdoc-page__anchor clip flex align-center" title="锚定到： 9. public ArrayList(Collection&lt;? extends E&gt; c)" aria-label="锚定到： 9. public ArrayList(Collection&lt;? extends E&gt; c)" href="#9-public-arraylistcollection-extends-e-c">
        <svg class="gdoc-icon gdoc_link"><use xlink:href="#gdoc_link"></use></svg>
    </a>
</div>
<p>构造一个包含给定的集合中所有元素的列表，元素插入本列表时按照集合的迭代器返回元素的顺序。</p>
<p>源码如下：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#a90d91">public</span> <span style="color:#000">ArrayList</span>(<span style="color:#000">Collection</span><span style="color:#000">&lt;?</span> <span style="color:#a90d91">extends</span> <span style="color:#000">E</span><span style="color:#000">&gt;</span> <span style="color:#000">c</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// 先将指定集合转换为对象数组</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">Object</span><span style="color:#000">[]</span> <span style="color:#000">a</span> <span style="color:#000">=</span> <span style="color:#000">c</span>.<span style="color:#836c28">toArray</span>();
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// 将数组长度赋值给列表的size，然后判断size是否为0</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">if</span> ((<span style="color:#000">size</span> <span style="color:#000">=</span> <span style="color:#000">a</span>.<span style="color:#836c28">length</span>) <span style="color:#000">!=</span> <span style="color:#000">0</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#177500">// 如果指定的集合不为空，然后判断该指定集合是否是ArrayList</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a90d91">if</span> (<span style="color:#000">c</span>.<span style="color:#836c28">getClass</span>() <span style="color:#000">==</span> <span style="color:#000">ArrayList</span>.<span style="color:#836c28">class</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#177500">// 指定集合是ArrayList，直接把数组a赋值给当前集合的elementData数组</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">elementData</span> <span style="color:#000">=</span> <span style="color:#000">a</span>;
</span></span><span style="display:flex;"><span>        } <span style="color:#a90d91">else</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#177500">// 指定集合不是ArrayList，需要将数组a复制给elementData数组</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">elementData</span> <span style="color:#000">=</span> <span style="color:#000">Arrays</span>.<span style="color:#836c28">copyOf</span>(<span style="color:#000">a</span>, <span style="color:#000">size</span>, <span style="color:#000">Object</span><span style="color:#000">[]</span>.<span style="color:#836c28">class</span>);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    } <span style="color:#a90d91">else</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#177500">// 指定的集合为空，给elementData字段赋值一个空数组</span>
</span></span><span style="display:flex;"><span>        <span style="color:#177500">// replace with empty array.</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">elementData</span> <span style="color:#000">=</span> <span style="color:#000">EMPTY_ELEMENTDATA</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>至于为什么不能把指定的集合<code>c</code>转为数组<code>a</code>之后，把这个数组<code>a</code>直接赋值给当前的<code>ArrayList</code>的<code>elementData</code>呢？</p>
<p>这是由于此处存在Java的一个bug（<a
  class="gdoc-markdown__link"
  href="https://bugs.java.com/bugdatabase/view_bug.do?bug_id=6260652"
>6260652</a>），也就是<code>c.toArray</code>可能返回的不是<code>Object[]</code>类型。如下测试用例所示：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#000">@Test</span>
</span></span><span style="display:flex;"><span><span style="color:#a90d91">public</span> <span style="color:#a90d91">void</span> <span style="color:#000">testArrayListWithCollection</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// list1，类型是Arrays中自已实现的ArrayList，其内部用于存储列表元素的数组类型为：E[]，E为泛型</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">List</span><span style="color:#000">&lt;</span><span style="color:#000">Integer</span><span style="color:#000">&gt;</span> <span style="color:#000">list1</span> <span style="color:#000">=</span> <span style="color:#000">Arrays</span>.<span style="color:#836c28">asList</span>(<span style="color:#000">1</span>, <span style="color:#000">2</span>, <span style="color:#000">3</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#000">System</span>.<span style="color:#836c28">out</span>.<span style="color:#836c28">println</span>(<span style="color:#000">list1</span>.<span style="color:#836c28">toArray</span>().<span style="color:#836c28">getClass</span>());
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// list2，类型是java.util.ArrayList，即使声明这是一个Integer列表，但其用于存储列表元素的数组类型仍为：Object[]</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">List</span><span style="color:#000">&lt;</span><span style="color:#000">Integer</span><span style="color:#000">&gt;</span> <span style="color:#000">list2</span> <span style="color:#000">=</span> <span style="color:#a90d91">new</span> <span style="color:#000">ArrayList</span><span style="color:#000">&lt;&gt;</span>();
</span></span><span style="display:flex;"><span>    <span style="color:#000">list2</span>.<span style="color:#836c28">add</span>(<span style="color:#000">1</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#000">System</span>.<span style="color:#836c28">out</span>.<span style="color:#836c28">println</span>(<span style="color:#000">list2</span>.<span style="color:#836c28">toArray</span>().<span style="color:#836c28">getClass</span>());
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// 使用参数为一个集合的构造器构造一个java.util.ArrayList实例，即使该集合的toArray()方法返回的并非Object[]类型，则该构造器也会对其进行转换</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">List</span><span style="color:#000">&lt;</span><span style="color:#000">Integer</span><span style="color:#000">&gt;</span> <span style="color:#000">list3</span> <span style="color:#000">=</span> <span style="color:#a90d91">new</span> <span style="color:#000">ArrayList</span><span style="color:#000">&lt;&gt;</span>(<span style="color:#000">list1</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#000">System</span>.<span style="color:#836c28">out</span>.<span style="color:#836c28">println</span>(<span style="color:#000">list3</span>.<span style="color:#836c28">toArray</span>().<span style="color:#836c28">getClass</span>());
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>输出：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>class <span style="color:#000">[</span>Ljava.lang.Integer;
</span></span><span style="display:flex;"><span>class <span style="color:#000">[</span>Ljava.lang.Object;
</span></span><span style="display:flex;"><span>class <span style="color:#000">[</span>Ljava.lang.Object;
</span></span></code></pre></div><hr>
<div class="flex align-center gdoc-page__anchorwrap">
    <h1 id="10-public-void-trimtosize"
    >
        10. public void trimToSize()
    </h1>
    <a data-clipboard-text="https://hongmao.run/jdk8-src-note/java/util/ArrayList/#10-public-void-trimtosize" class="gdoc-page__anchor clip flex align-center" title="锚定到： 10. public void trimToSize()" aria-label="锚定到： 10. public void trimToSize()" href="#10-public-void-trimtosize">
        <svg class="gdoc-icon gdoc_link"><use xlink:href="#gdoc_link"></use></svg>
    </a>
</div>
<p>将该<code>ArrayList</code>实例的容量调整为列表当前的大小。应用程序可以使用此操作来最大程度地减少<code>ArrayList</code>实例的存储。</p>
<p>源码如下：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#a90d91">public</span> <span style="color:#a90d91">void</span> <span style="color:#000">trimToSize</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// 修改次数加1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">modCount</span><span style="color:#000">++</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// 只有当前列表的元素个数小于数组长度时才执行此操作</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">if</span> (<span style="color:#000">size</span> <span style="color:#000">&lt;</span> <span style="color:#000">elementData</span>.<span style="color:#836c28">length</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#177500">// 列表的元素个数为0，则置elementData数组为空数组</span>
</span></span><span style="display:flex;"><span>        <span style="color:#177500">// 否则，执行数组复制，将数组中有元素的部分复制出来赋值给elementData数组</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">elementData</span> <span style="color:#000">=</span> (<span style="color:#000">size</span> <span style="color:#000">==</span> <span style="color:#000">0</span>)
</span></span><span style="display:flex;"><span>          <span style="color:#000">?</span> <span style="color:#000">EMPTY_ELEMENTDATA</span>
</span></span><span style="display:flex;"><span>          : <span style="color:#000">Arrays</span>.<span style="color:#836c28">copyOf</span>(<span style="color:#000">elementData</span>, <span style="color:#000">size</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><hr>
<div class="flex align-center gdoc-page__anchorwrap">
    <h1 id="11-public-void-ensurecapacityint-mincapacity"
    >
        11. public void ensureCapacity(int minCapacity)
    </h1>
    <a data-clipboard-text="https://hongmao.run/jdk8-src-note/java/util/ArrayList/#11-public-void-ensurecapacityint-mincapacity" class="gdoc-page__anchor clip flex align-center" title="锚定到： 11. public void ensureCapacity(int minCapacity)" aria-label="锚定到： 11. public void ensureCapacity(int minCapacity)" href="#11-public-void-ensurecapacityint-mincapacity">
        <svg class="gdoc-icon gdoc_link"><use xlink:href="#gdoc_link"></use></svg>
    </a>
</div>
<p>确保本列表的容量至少可以容纳参数<code>minCapacity</code>指定的元素个数，如有必要的话会增加此<code>ArrayList</code>实例的容量。</p>
<p>源码如下：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#a90d91">public</span> <span style="color:#a90d91">void</span> <span style="color:#000">ensureCapacity</span>(<span style="color:#a90d91">int</span> <span style="color:#000">minCapacity</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// 先计算一个最小扩充值</span>
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// 如果当前列表的elementData数组不是默认容量的空数组，则最小扩充值取0</span>
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// 否则最小扩充值默认容量，也即10</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">int</span> <span style="color:#000">minExpand</span> <span style="color:#000">=</span> (<span style="color:#000">elementData</span> <span style="color:#000">!=</span> <span style="color:#000">DEFAULTCAPACITY_EMPTY_ELEMENTDATA</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#177500">// any size if not default element table</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">?</span> <span style="color:#000">0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#177500">// larger than default for default empty table. It&#39;s already</span>
</span></span><span style="display:flex;"><span>        <span style="color:#177500">// supposed to be at default size.</span>
</span></span><span style="display:flex;"><span>        : <span style="color:#000">DEFAULT_CAPACITY</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// 如果指定的最小容量大于最小扩充值，则调用ensureExplicitCapacity方法进行精确扩容</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">if</span> (<span style="color:#000">minCapacity</span> <span style="color:#000">&gt;</span> <span style="color:#000">minExpand</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#000">ensureExplicitCapacity</span>(<span style="color:#000">minCapacity</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><hr>
<div class="flex align-center gdoc-page__anchorwrap">
    <h1 id="12-private-static-int-calculatecapacityobject-elementdata-int-mincapacity"
    >
        12. private static int calculateCapacity(Object[] elementData, int minCapacity)
    </h1>
    <a data-clipboard-text="https://hongmao.run/jdk8-src-note/java/util/ArrayList/#12-private-static-int-calculatecapacityobject-elementdata-int-mincapacity" class="gdoc-page__anchor clip flex align-center" title="锚定到： 12. private static int calculateCapacity(Object[] elementData, int minCapacity)" aria-label="锚定到： 12. private static int calculateCapacity(Object[] elementData, int minCapacity)" href="#12-private-static-int-calculatecapacityobject-elementdata-int-mincapacity">
        <svg class="gdoc-icon gdoc_link"><use xlink:href="#gdoc_link"></use></svg>
    </a>
</div>
<p>计算最小容量值。</p>
<p>源码如下：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#a90d91">private</span> <span style="color:#a90d91">static</span> <span style="color:#a90d91">int</span> <span style="color:#000">calculateCapacity</span>(<span style="color:#000">Object</span><span style="color:#000">[]</span> <span style="color:#000">elementData</span>, <span style="color:#a90d91">int</span> <span style="color:#000">minCapacity</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// 如果指定的元素数组是默认容量空数组，则返回默认容量空数组和指定最小容量这二者的最大值</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">if</span> (<span style="color:#000">elementData</span> <span style="color:#000">==</span> <span style="color:#000">DEFAULTCAPACITY_EMPTY_ELEMENTDATA</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#a90d91">return</span> <span style="color:#000">Math</span>.<span style="color:#836c28">max</span>(<span style="color:#000">DEFAULT_CAPACITY</span>, <span style="color:#000">minCapacity</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// 如果指定的元素数组已非默认容量空数组，此时直接返回最小容量</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">return</span> <span style="color:#000">minCapacity</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><hr>
<div class="flex align-center gdoc-page__anchorwrap">
    <h1 id="13-private-void-ensurecapacityinternalint-mincapacity"
    >
        13. private void ensureCapacityInternal(int minCapacity)
    </h1>
    <a data-clipboard-text="https://hongmao.run/jdk8-src-note/java/util/ArrayList/#13-private-void-ensurecapacityinternalint-mincapacity" class="gdoc-page__anchor clip flex align-center" title="锚定到： 13. private void ensureCapacityInternal(int minCapacity)" aria-label="锚定到： 13. private void ensureCapacityInternal(int minCapacity)" href="#13-private-void-ensurecapacityinternalint-mincapacity">
        <svg class="gdoc-icon gdoc_link"><use xlink:href="#gdoc_link"></use></svg>
    </a>
</div>
<p>内部使用的（私有的）容量确保方法。</p>
<p>源码如下：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#a90d91">private</span> <span style="color:#a90d91">void</span> <span style="color:#000">ensureCapacityInternal</span>(<span style="color:#a90d91">int</span> <span style="color:#000">minCapacity</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// 先调用计算容量方法获得最小容量值，再调用ensureExplicitCapacity明确扩容</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">ensureExplicitCapacity</span>(<span style="color:#000">calculateCapacity</span>(<span style="color:#000">elementData</span>, <span style="color:#000">minCapacity</span>));
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><hr>
<div class="flex align-center gdoc-page__anchorwrap">
    <h1 id="14-private-void-ensureexplicitcapacityint-mincapacity"
    >
        14. private void ensureExplicitCapacity(int minCapacity)
    </h1>
    <a data-clipboard-text="https://hongmao.run/jdk8-src-note/java/util/ArrayList/#14-private-void-ensureexplicitcapacityint-mincapacity" class="gdoc-page__anchor clip flex align-center" title="锚定到： 14. private void ensureExplicitCapacity(int minCapacity)" aria-label="锚定到： 14. private void ensureExplicitCapacity(int minCapacity)" href="#14-private-void-ensureexplicitcapacityint-mincapacity">
        <svg class="gdoc-icon gdoc_link"><use xlink:href="#gdoc_link"></use></svg>
    </a>
</div>
<p>明确的扩容方法，判断若指定的最小容量大于当前元素数组的容量，则对数组进行扩容。</p>
<p>源码如下：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#a90d91">private</span> <span style="color:#a90d91">void</span> <span style="color:#000">ensureExplicitCapacity</span>(<span style="color:#a90d91">int</span> <span style="color:#000">minCapacity</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#000">modCount</span><span style="color:#000">++</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// overflow-conscious code</span>
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// 指定的最小容量大于元素数组的长度才进行扩容</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">if</span> (<span style="color:#000">minCapacity</span> <span style="color:#000">-</span> <span style="color:#000">elementData</span>.<span style="color:#836c28">length</span> <span style="color:#000">&gt;</span> <span style="color:#000">0</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#000">grow</span>(<span style="color:#000">minCapacity</span>);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><hr>
<div class="flex align-center gdoc-page__anchorwrap">
    <h1 id="15-private-static-final-int-max_array_size--integermax_value---8"
    >
        15. private static final int MAX_ARRAY_SIZE = Integer.MAX_VALUE - 8
    </h1>
    <a data-clipboard-text="https://hongmao.run/jdk8-src-note/java/util/ArrayList/#15-private-static-final-int-max_array_size--integermax_value---8" class="gdoc-page__anchor clip flex align-center" title="锚定到： 15. private static final int MAX_ARRAY_SIZE = Integer.MAX_VALUE - 8" aria-label="锚定到： 15. private static final int MAX_ARRAY_SIZE = Integer.MAX_VALUE - 8" href="#15-private-static-final-int-max_array_size--integermax_value---8">
        <svg class="gdoc-icon gdoc_link"><use xlink:href="#gdoc_link"></use></svg>
    </a>
</div>
<p>可分配的数组的最大大小。一些虚拟机在数组中保留一些头字。尝试分配更大的数组可能会导致 <code>OutOfMemoryError</code>：请求的数组大小超出虚拟机限制。</p>
<hr>
<div class="flex align-center gdoc-page__anchorwrap">
    <h1 id="16-private-void-growint-mincapacity"
    >
        16. private void grow(int minCapacity)
    </h1>
    <a data-clipboard-text="https://hongmao.run/jdk8-src-note/java/util/ArrayList/#16-private-void-growint-mincapacity" class="gdoc-page__anchor clip flex align-center" title="锚定到： 16. private void grow(int minCapacity)" aria-label="锚定到： 16. private void grow(int minCapacity)" href="#16-private-void-growint-mincapacity">
        <svg class="gdoc-icon gdoc_link"><use xlink:href="#gdoc_link"></use></svg>
    </a>
</div>
<p>增加容量以确保它至少可以容纳由最小容量参数指定的元素数量。</p>
<p>源码如下：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#a90d91">private</span> <span style="color:#a90d91">void</span> <span style="color:#000">grow</span>(<span style="color:#a90d91">int</span> <span style="color:#000">minCapacity</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// overflow-conscious code</span>
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// 取出原容量</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">int</span> <span style="color:#000">oldCapacity</span> <span style="color:#000">=</span> <span style="color:#000">elementData</span>.<span style="color:#836c28">length</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// 先计算一个新容量，基本上是扩容1.5倍（其实0.5并不准确，因为右移一位计算时没有小数，小数位全舍弃）</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">int</span> <span style="color:#000">newCapacity</span> <span style="color:#000">=</span> <span style="color:#000">oldCapacity</span> <span style="color:#000">+</span> (<span style="color:#000">oldCapacity</span> <span style="color:#000">&gt;&gt;</span> <span style="color:#000">1</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// 扩容“1.5”倍后，判断是否能满足最小容量需求</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">if</span> (<span style="color:#000">newCapacity</span> <span style="color:#000">-</span> <span style="color:#000">minCapacity</span> <span style="color:#000">&lt;</span> <span style="color:#000">0</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#177500">// 仍无法满足最小容量需求，则此时新容量直接取参数中指定的最小容量</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">newCapacity</span> <span style="color:#000">=</span> <span style="color:#000">minCapacity</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// 判断新容量是否大于最大数组容量</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">if</span> (<span style="color:#000">newCapacity</span> <span style="color:#000">-</span> <span style="color:#000">MAX_ARRAY_SIZE</span> <span style="color:#000">&gt;</span> <span style="color:#000">0</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#177500">// 新容量大于最大数组容量，此时调用hugeCapacity来获取新容量</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">newCapacity</span> <span style="color:#000">=</span> <span style="color:#000">hugeCapacity</span>(<span style="color:#000">minCapacity</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// minCapacity is usually close to size, so this is a win:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// 对元素数组执行复制，复制后的数组容量为上面计算出的容量</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">elementData</span> <span style="color:#000">=</span> <span style="color:#000">Arrays</span>.<span style="color:#836c28">copyOf</span>(<span style="color:#000">elementData</span>, <span style="color:#000">newCapacity</span>);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><hr>
<div class="flex align-center gdoc-page__anchorwrap">
    <h1 id="17-private-static-int-hugecapacityint-mincapacity"
    >
        17. private static int hugeCapacity(int minCapacity)
    </h1>
    <a data-clipboard-text="https://hongmao.run/jdk8-src-note/java/util/ArrayList/#17-private-static-int-hugecapacityint-mincapacity" class="gdoc-page__anchor clip flex align-center" title="锚定到： 17. private static int hugeCapacity(int minCapacity)" aria-label="锚定到： 17. private static int hugeCapacity(int minCapacity)" href="#17-private-static-int-hugecapacityint-mincapacity">
        <svg class="gdoc-icon gdoc_link"><use xlink:href="#gdoc_link"></use></svg>
    </a>
</div>
<p>获取最大容量。</p>
<p>源码如下：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#a90d91">private</span> <span style="color:#a90d91">static</span> <span style="color:#a90d91">int</span> <span style="color:#000">hugeCapacity</span>(<span style="color:#a90d91">int</span> <span style="color:#000">minCapacity</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">if</span> (<span style="color:#000">minCapacity</span> <span style="color:#000">&lt;</span> <span style="color:#000">0</span>) <span style="color:#177500">// overflow</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a90d91">throw</span> <span style="color:#a90d91">new</span> <span style="color:#000">OutOfMemoryError</span>();
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// 如参数指定的最小容量 大于 最大数组容量，则新容量取Integer的最大值</span>
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// 否则取最大数组容量</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">return</span> (<span style="color:#000">minCapacity</span> <span style="color:#000">&gt;</span> <span style="color:#000">MAX_ARRAY_SIZE</span>) <span style="color:#000">?</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">Integer</span>.<span style="color:#836c28">MAX_VALUE</span> :
</span></span><span style="display:flex;"><span>        <span style="color:#000">MAX_ARRAY_SIZE</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>之前说<code>MAX_ARRAY_SIZE = Integer.MAX_VALUE - 8</code>，因为有的虚拟机中实现的数组可能会有头字，进而导致数组的最大容量无法达到<code>Integer.MAX_VALUE</code>，那如果按照本方法中的扩容策略，容量最大还是可以取到<code>Integer.MAX_VALUE</code>的，那岂不还是会出现未知的风险？</p>
<p>所以，ArrayList的最大容量并非<code>Integer.MAX_VALUE - 8</code>，而是<code>Integer.MAX_VALUE</code>。</p>
<hr>
<div class="flex align-center gdoc-page__anchorwrap">
    <h1 id="18-public-int-size"
    >
        18. public int size()
    </h1>
    <a data-clipboard-text="https://hongmao.run/jdk8-src-note/java/util/ArrayList/#18-public-int-size" class="gdoc-page__anchor clip flex align-center" title="锚定到： 18. public int size()" aria-label="锚定到： 18. public int size()" href="#18-public-int-size">
        <svg class="gdoc-icon gdoc_link"><use xlink:href="#gdoc_link"></use></svg>
    </a>
</div>
<p>返回当前列表中元素的个数，即私有属性<code>size</code>。</p>
<p>源码如下：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#a90d91">public</span> <span style="color:#a90d91">int</span> <span style="color:#000">size</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">return</span> <span style="color:#000">size</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><hr>
<div class="flex align-center gdoc-page__anchorwrap">
    <h1 id="19-public-boolean-isempty"
    >
        19. public boolean isEmpty()
    </h1>
    <a data-clipboard-text="https://hongmao.run/jdk8-src-note/java/util/ArrayList/#19-public-boolean-isempty" class="gdoc-page__anchor clip flex align-center" title="锚定到： 19. public boolean isEmpty()" aria-label="锚定到： 19. public boolean isEmpty()" href="#19-public-boolean-isempty">
        <svg class="gdoc-icon gdoc_link"><use xlink:href="#gdoc_link"></use></svg>
    </a>
</div>
<p>判断当前<code>ArrayList</code>实例的元素数量（即<code>size</code>）是否为0。</p>
<p>源码如下：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#a90d91">public</span> <span style="color:#a90d91">boolean</span> <span style="color:#000">isEmpty</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">return</span> <span style="color:#000">size</span> <span style="color:#000">==</span> <span style="color:#000">0</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><hr>
<div class="flex align-center gdoc-page__anchorwrap">
    <h1 id="20-public-boolean-containsobject-o"
    >
        20. public boolean contains(Object o)
    </h1>
    <a data-clipboard-text="https://hongmao.run/jdk8-src-note/java/util/ArrayList/#20-public-boolean-containsobject-o" class="gdoc-page__anchor clip flex align-center" title="锚定到： 20. public boolean contains(Object o)" aria-label="锚定到： 20. public boolean contains(Object o)" href="#20-public-boolean-containsobject-o">
        <svg class="gdoc-icon gdoc_link"><use xlink:href="#gdoc_link"></use></svg>
    </a>
</div>
<p>判断当前列表是否包含参数中指定的元素。</p>
<p>如果当前列表包含指定的元素，则返回<code>true</code>。更正式地说，当且仅当当前列表至少包含一个元素<code>e</code>可满足<code>(o==null ? e==null : o.equals(e))</code>时返回<code>true</code>。 源码如下：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#a90d91">public</span> <span style="color:#a90d91">boolean</span> <span style="color:#000">contains</span>(<span style="color:#000">Object</span> <span style="color:#000">o</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// 先获取指定元素的索引，然后判断索引是否大于等于0，不大于等于0说明没找到</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">return</span> <span style="color:#000">indexOf</span>(<span style="color:#000">o</span>) <span style="color:#000">&gt;=</span> <span style="color:#000">0</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><hr>
<div class="flex align-center gdoc-page__anchorwrap">
    <h1 id="21-public-int-indexofobject-o"
    >
        21. public int indexOf(Object o)
    </h1>
    <a data-clipboard-text="https://hongmao.run/jdk8-src-note/java/util/ArrayList/#21-public-int-indexofobject-o" class="gdoc-page__anchor clip flex align-center" title="锚定到： 21. public int indexOf(Object o)" aria-label="锚定到： 21. public int indexOf(Object o)" href="#21-public-int-indexofobject-o">
        <svg class="gdoc-icon gdoc_link"><use xlink:href="#gdoc_link"></use></svg>
    </a>
</div>
<p>返回参数中给定的元素在本列表中第一次出现的索引位置。如果给定的元素在本列表不存在，则返回<code>-1</code>。更准确的说，返回可满足<code>(o==null ? get(i)==null : o.equals(get(i)))</code>的最小索引<code>i</code>，如果该索引不存在的话，返回<code>-1</code>。</p>
<p>源码如下：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#a90d91">public</span> <span style="color:#a90d91">int</span> <span style="color:#000">indexOf</span>(<span style="color:#000">Object</span> <span style="color:#000">o</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// 根据指定元素是否为null采用不同的方式处理</span>
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// 均是从头开始遍历列表，命中了则返回当前索引</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">if</span> (<span style="color:#000">o</span> <span style="color:#000">==</span> <span style="color:#a90d91">null</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#a90d91">for</span> (<span style="color:#a90d91">int</span> <span style="color:#000">i</span> <span style="color:#000">=</span> <span style="color:#000">0</span>; <span style="color:#000">i</span> <span style="color:#000">&lt;</span> <span style="color:#000">size</span>; <span style="color:#000">i</span><span style="color:#000">++</span>)
</span></span><span style="display:flex;"><span>            <span style="color:#a90d91">if</span> (<span style="color:#000">elementData</span><span style="color:#000">[</span><span style="color:#000">i</span><span style="color:#000">]==</span><span style="color:#a90d91">null</span>)
</span></span><span style="display:flex;"><span>                <span style="color:#a90d91">return</span> <span style="color:#000">i</span>;
</span></span><span style="display:flex;"><span>    } <span style="color:#a90d91">else</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a90d91">for</span> (<span style="color:#a90d91">int</span> <span style="color:#000">i</span> <span style="color:#000">=</span> <span style="color:#000">0</span>; <span style="color:#000">i</span> <span style="color:#000">&lt;</span> <span style="color:#000">size</span>; <span style="color:#000">i</span><span style="color:#000">++</span>)
</span></span><span style="display:flex;"><span>            <span style="color:#a90d91">if</span> (<span style="color:#000">o</span>.<span style="color:#836c28">equals</span>(<span style="color:#000">elementData</span><span style="color:#000">[</span><span style="color:#000">i</span><span style="color:#000">]</span>))
</span></span><span style="display:flex;"><span>                <span style="color:#a90d91">return</span> <span style="color:#000">i</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// 未找到指定元素的索引，返回-1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">return</span> <span style="color:#000">-</span><span style="color:#000">1</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><hr>
<div class="flex align-center gdoc-page__anchorwrap">
    <h1 id="22-public-int-lastindexofobject-o"
    >
        22. public int lastIndexOf(Object o)
    </h1>
    <a data-clipboard-text="https://hongmao.run/jdk8-src-note/java/util/ArrayList/#22-public-int-lastindexofobject-o" class="gdoc-page__anchor clip flex align-center" title="锚定到： 22. public int lastIndexOf(Object o)" aria-label="锚定到： 22. public int lastIndexOf(Object o)" href="#22-public-int-lastindexofobject-o">
        <svg class="gdoc-icon gdoc_link"><use xlink:href="#gdoc_link"></use></svg>
    </a>
</div>
<p>本方法与<code>indexOf</code>类似，不同之处在于，本方法是从后向前遍历，找到符合条件的最大索引。</p>
<p>返回参数中给定的元素在本列表中最后一次出现的索引位置。如果给定的元素在本列表不存在，则返回<code>-1</code>。更准确的说，返回可满足<code>(o==null ? get(i)==null : o.equals(get(i)))</code>的最大索引<code>i</code>，如果该索引不存在的话，返回<code>-1</code>。</p>
<p>源码如下：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#a90d91">public</span> <span style="color:#a90d91">int</span> <span style="color:#000">lastIndexOf</span>(<span style="color:#000">Object</span> <span style="color:#000">o</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">if</span> (<span style="color:#000">o</span> <span style="color:#000">==</span> <span style="color:#a90d91">null</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#a90d91">for</span> (<span style="color:#a90d91">int</span> <span style="color:#000">i</span> <span style="color:#000">=</span> <span style="color:#000">size</span><span style="color:#000">-</span><span style="color:#000">1</span>; <span style="color:#000">i</span> <span style="color:#000">&gt;=</span> <span style="color:#000">0</span>; <span style="color:#000">i</span><span style="color:#000">--</span>)
</span></span><span style="display:flex;"><span>            <span style="color:#a90d91">if</span> (<span style="color:#000">elementData</span><span style="color:#000">[</span><span style="color:#000">i</span><span style="color:#000">]==</span><span style="color:#a90d91">null</span>)
</span></span><span style="display:flex;"><span>                <span style="color:#a90d91">return</span> <span style="color:#000">i</span>;
</span></span><span style="display:flex;"><span>    } <span style="color:#a90d91">else</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a90d91">for</span> (<span style="color:#a90d91">int</span> <span style="color:#000">i</span> <span style="color:#000">=</span> <span style="color:#000">size</span><span style="color:#000">-</span><span style="color:#000">1</span>; <span style="color:#000">i</span> <span style="color:#000">&gt;=</span> <span style="color:#000">0</span>; <span style="color:#000">i</span><span style="color:#000">--</span>)
</span></span><span style="display:flex;"><span>            <span style="color:#a90d91">if</span> (<span style="color:#000">o</span>.<span style="color:#836c28">equals</span>(<span style="color:#000">elementData</span><span style="color:#000">[</span><span style="color:#000">i</span><span style="color:#000">]</span>))
</span></span><span style="display:flex;"><span>                <span style="color:#a90d91">return</span> <span style="color:#000">i</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">return</span> <span style="color:#000">-</span><span style="color:#000">1</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><hr>
<div class="flex align-center gdoc-page__anchorwrap">
    <h1 id="23-public-object-clone"
    >
        23. public Object clone()
    </h1>
    <a data-clipboard-text="https://hongmao.run/jdk8-src-note/java/util/ArrayList/#23-public-object-clone" class="gdoc-page__anchor clip flex align-center" title="锚定到： 23. public Object clone()" aria-label="锚定到： 23. public Object clone()" href="#23-public-object-clone">
        <svg class="gdoc-icon gdoc_link"><use xlink:href="#gdoc_link"></use></svg>
    </a>
</div>
<p>获取一个当前<code>ArrayList</code>实例的浅复制实例，即<code>ArrayList</code>实例是新的，但是其中的元素没有被复制，仍是原来的元素。</p>
<p>源码如下：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#a90d91">public</span> <span style="color:#000">Object</span> <span style="color:#000">clone</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">try</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#177500">// 直接调用Object类的clone方法进行克隆</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">ArrayList</span><span style="color:#000">&lt;?&gt;</span> <span style="color:#000">v</span> <span style="color:#000">=</span> (<span style="color:#000">ArrayList</span><span style="color:#000">&lt;?&gt;</span>) <span style="color:#a90d91">super</span>.<span style="color:#836c28">clone</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#177500">// 由于Object类的clone方法是浅复制，也即克隆出的新列表虽有新的内存地址，但新列表持有的对象数组仍是老List的对象数组，此时将数组再复制一份复制给新列表</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">v</span>.<span style="color:#836c28">elementData</span> <span style="color:#000">=</span> <span style="color:#000">Arrays</span>.<span style="color:#836c28">copyOf</span>(<span style="color:#000">elementData</span>, <span style="color:#000">size</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#177500">// 将新列表的修改次数归0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">v</span>.<span style="color:#836c28">modCount</span> <span style="color:#000">=</span> <span style="color:#000">0</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#a90d91">return</span> <span style="color:#000">v</span>;
</span></span><span style="display:flex;"><span>    } <span style="color:#a90d91">catch</span> (<span style="color:#000">CloneNotSupportedException</span> <span style="color:#000">e</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#177500">// this shouldn&#39;t happen, since we are Cloneable</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a90d91">throw</span> <span style="color:#a90d91">new</span> <span style="color:#000">InternalError</span>(<span style="color:#000">e</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><hr>
<div class="flex align-center gdoc-page__anchorwrap">
    <h1 id="24-public-object-toarray"
    >
        24. public Object[] toArray()
    </h1>
    <a data-clipboard-text="https://hongmao.run/jdk8-src-note/java/util/ArrayList/#24-public-object-toarray" class="gdoc-page__anchor clip flex align-center" title="锚定到： 24. public Object[] toArray()" aria-label="锚定到： 24. public Object[] toArray()" href="#24-public-object-toarray">
        <svg class="gdoc-icon gdoc_link"><use xlink:href="#gdoc_link"></use></svg>
    </a>
</div>
<p>返回一个以正确的顺序（从第一个元素到最后一个元素）包含当前列表中所有元素的数组。 返回的数组将是“安全的”，因为此列表不保留对其的引用。 （换句话说，此方法必须分配一个新数组）。因此，调用者可以自由修改返回的数组。</p>
<p>此方法充当基于数组的API和基于集合的API之间的桥梁。</p>
<p>源码如下：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#a90d91">public</span> <span style="color:#000">Object</span><span style="color:#000">[]</span> <span style="color:#000">toArray</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">return</span> <span style="color:#000">Arrays</span>.<span style="color:#836c28">copyOf</span>(<span style="color:#000">elementData</span>, <span style="color:#000">size</span>);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><hr>
<div class="flex align-center gdoc-page__anchorwrap">
    <h1 id="25-public-ltt-t-toarrayt-a"
    >
        25. public &lt;T&gt; T[] toArray(T[] a)
    </h1>
    <a data-clipboard-text="https://hongmao.run/jdk8-src-note/java/util/ArrayList/#25-public-ltt-t-toarrayt-a" class="gdoc-page__anchor clip flex align-center" title="锚定到： 25. public &lt;T&gt; T[] toArray(T[] a)" aria-label="锚定到： 25. public &lt;T&gt; T[] toArray(T[] a)" href="#25-public-ltt-t-toarrayt-a">
        <svg class="gdoc-icon gdoc_link"><use xlink:href="#gdoc_link"></use></svg>
    </a>
</div>
<p>返回一个数组，该数组按正确的顺序包含此列表中的所有元素（从第一个元素到最后一个元素）；所返回数组的运行时类型是指定数组的运行时类型。如果列表适合指定的数组，则将其返回。否则，将使用指定数组的运行时类型和此列表的大小分配一个新数组。 如果列表适合指定的数组并有剩余空间（即数组中的元素多于列表），则紧接集合结束后的数组中的元素设置为<code>null</code>。（如果调用者知道列表不包含任何<code>null</code>元素，则这对于确定列表的长度很有用。）</p>
<p>源码如下：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#a90d91">public</span> <span style="color:#000">&lt;</span><span style="color:#000">T</span><span style="color:#000">&gt;</span> <span style="color:#000">T</span><span style="color:#000">[]</span> <span style="color:#000">toArray</span>(<span style="color:#000">T</span><span style="color:#000">[]</span> <span style="color:#000">a</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">if</span> (<span style="color:#000">a</span>.<span style="color:#836c28">length</span> <span style="color:#000">&lt;</span> <span style="color:#000">size</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#177500">// 如果指定的数组a容量不足，则会将对象数组复制到新数组中，新数组的类型就是指定的数组a的类型</span>
</span></span><span style="display:flex;"><span>        <span style="color:#177500">// Make a new array of a&#39;s runtime type, but my contents:</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a90d91">return</span> (<span style="color:#000">T</span><span style="color:#000">[]</span>) <span style="color:#000">Arrays</span>.<span style="color:#836c28">copyOf</span>(<span style="color:#000">elementData</span>, <span style="color:#000">size</span>, <span style="color:#000">a</span>.<span style="color:#836c28">getClass</span>());
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// a的容量足够，将对象数组复制到其中</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">System</span>.<span style="color:#836c28">arraycopy</span>(<span style="color:#000">elementData</span>, <span style="color:#000">0</span>, <span style="color:#000">a</span>, <span style="color:#000">0</span>, <span style="color:#000">size</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// 如果对象数组a的长度大于当前列表元素个数，则最后一个元素后面的位置置为null</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">if</span> (<span style="color:#000">a</span>.<span style="color:#836c28">length</span> <span style="color:#000">&gt;</span> <span style="color:#000">size</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#000">a</span><span style="color:#000">[</span><span style="color:#000">size</span><span style="color:#000">]</span> <span style="color:#000">=</span> <span style="color:#a90d91">null</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">return</span> <span style="color:#000">a</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><hr>
<div class="flex align-center gdoc-page__anchorwrap">
    <h1 id="26-e-elementdataint-index"
    >
        26. E elementData(int index)
    </h1>
    <a data-clipboard-text="https://hongmao.run/jdk8-src-note/java/util/ArrayList/#26-e-elementdataint-index" class="gdoc-page__anchor clip flex align-center" title="锚定到： 26. E elementData(int index)" aria-label="锚定到： 26. E elementData(int index)" href="#26-e-elementdataint-index">
        <svg class="gdoc-icon gdoc_link"><use xlink:href="#gdoc_link"></use></svg>
    </a>
</div>
<p>获取指定索引位置的元素。</p>
<p>源码如下：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#000">E</span> <span style="color:#000">elementData</span>(<span style="color:#a90d91">int</span> <span style="color:#000">index</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// 取出元素后会将其强转为当前列表持有元素的类型，因为对象数组elementData中存的都是Object对象</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">return</span> (<span style="color:#000">E</span>) <span style="color:#000">elementData</span><span style="color:#000">[</span><span style="color:#000">index</span><span style="color:#000">]</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><hr>
<div class="flex align-center gdoc-page__anchorwrap">
    <h1 id="27-public-e-getint-index"
    >
        27. public E get(int index)
    </h1>
    <a data-clipboard-text="https://hongmao.run/jdk8-src-note/java/util/ArrayList/#27-public-e-getint-index" class="gdoc-page__anchor clip flex align-center" title="锚定到： 27. public E get(int index)" aria-label="锚定到： 27. public E get(int index)" href="#27-public-e-getint-index">
        <svg class="gdoc-icon gdoc_link"><use xlink:href="#gdoc_link"></use></svg>
    </a>
</div>
<p>返回此列表中指定位置的元素。</p>
<p>源码如下：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#a90d91">public</span> <span style="color:#000">E</span> <span style="color:#000">get</span>(<span style="color:#a90d91">int</span> <span style="color:#000">index</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// 首先对索引位置进行范围检查</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">rangeCheck</span>(<span style="color:#000">index</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// 调用elementData方法取出指定位置的数据</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">return</span> <span style="color:#000">elementData</span>(<span style="color:#000">index</span>);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><hr>
<div class="flex align-center gdoc-page__anchorwrap">
    <h1 id="28-public-e-setint-index-e-element"
    >
        28. public E set(int index, E element)
    </h1>
    <a data-clipboard-text="https://hongmao.run/jdk8-src-note/java/util/ArrayList/#28-public-e-setint-index-e-element" class="gdoc-page__anchor clip flex align-center" title="锚定到： 28. public E set(int index, E element)" aria-label="锚定到： 28. public E set(int index, E element)" href="#28-public-e-setint-index-e-element">
        <svg class="gdoc-icon gdoc_link"><use xlink:href="#gdoc_link"></use></svg>
    </a>
</div>
<p>用指定的元素<code>element</code>替换此列表中指定位置<code>index</code>的元素。</p>
<p>源码如下：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#a90d91">public</span> <span style="color:#000">E</span> <span style="color:#000">set</span>(<span style="color:#a90d91">int</span> <span style="color:#000">index</span>, <span style="color:#000">E</span> <span style="color:#000">element</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// 首先对索引进行范围检查</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">rangeCheck</span>(<span style="color:#000">index</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// 调用elementData方法取出指定位置当前的元素</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">E</span> <span style="color:#000">oldValue</span> <span style="color:#000">=</span> <span style="color:#000">elementData</span>(<span style="color:#000">index</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// 替换元素数组中指定位置的元素为参数中指定的元素</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">elementData</span><span style="color:#000">[</span><span style="color:#000">index</span><span style="color:#000">]</span> <span style="color:#000">=</span> <span style="color:#000">element</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// 返回旧值</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">return</span> <span style="color:#000">oldValue</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><hr>
<div class="flex align-center gdoc-page__anchorwrap">
    <h1 id="29-public-boolean-adde-e"
    >
        29. public boolean add(E e)
    </h1>
    <a data-clipboard-text="https://hongmao.run/jdk8-src-note/java/util/ArrayList/#29-public-boolean-adde-e" class="gdoc-page__anchor clip flex align-center" title="锚定到： 29. public boolean add(E e)" aria-label="锚定到： 29. public boolean add(E e)" href="#29-public-boolean-adde-e">
        <svg class="gdoc-icon gdoc_link"><use xlink:href="#gdoc_link"></use></svg>
    </a>
</div>
<p>将指定的元素追加到此列表的末尾，然后返回<code>true</code>。</p>
<p>源码如下：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#a90d91">public</span> <span style="color:#a90d91">boolean</span> <span style="color:#000">add</span>(<span style="color:#000">E</span> <span style="color:#000">e</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// 确保容量足够</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">ensureCapacityInternal</span>(<span style="color:#000">size</span> <span style="color:#000">+</span> <span style="color:#000">1</span>);  <span style="color:#177500">// Increments modCount!!</span>
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// 设置索引位置为size的元素为参数中指定的元素，然后再将size加1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">elementData</span><span style="color:#000">[</span><span style="color:#000">size</span><span style="color:#000">++]</span> <span style="color:#000">=</span> <span style="color:#000">e</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">return</span> <span style="color:#a90d91">true</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><hr>
<div class="flex align-center gdoc-page__anchorwrap">
    <h1 id="30-public-void-addint-index-e-element"
    >
        30. public void add(int index, E element)
    </h1>
    <a data-clipboard-text="https://hongmao.run/jdk8-src-note/java/util/ArrayList/#30-public-void-addint-index-e-element" class="gdoc-page__anchor clip flex align-center" title="锚定到： 30. public void add(int index, E element)" aria-label="锚定到： 30. public void add(int index, E element)" href="#30-public-void-addint-index-e-element">
        <svg class="gdoc-icon gdoc_link"><use xlink:href="#gdoc_link"></use></svg>
    </a>
</div>
<p>将指定的元素<code>element</code>插入此列表中的指定位置<code>index</code>。将当前在该位置的元素（如果有）和任何后续元素右移（将其索引加1）。</p>
<p>源码如下：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#a90d91">public</span> <span style="color:#a90d91">void</span> <span style="color:#000">add</span>(<span style="color:#a90d91">int</span> <span style="color:#000">index</span>, <span style="color:#000">E</span> <span style="color:#000">element</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// 首先对指定的索引index执行检查，看其是否符合新增的条件（大于0小于等于size）</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">rangeCheckForAdd</span>(<span style="color:#000">index</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// 确保容量足够</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">ensureCapacityInternal</span>(<span style="color:#000">size</span> <span style="color:#000">+</span> <span style="color:#000">1</span>);  <span style="color:#177500">// Increments modCount!!</span>
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// 将指定索引index之后的元素全部右移一位，即各索引加1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">System</span>.<span style="color:#836c28">arraycopy</span>(<span style="color:#000">elementData</span>, <span style="color:#000">index</span>, <span style="color:#000">elementData</span>, <span style="color:#000">index</span> <span style="color:#000">+</span> <span style="color:#000">1</span>,
</span></span><span style="display:flex;"><span>                     <span style="color:#000">size</span> <span style="color:#000">-</span> <span style="color:#000">index</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// 将指定索引位置index处的元素替换为参数中指定的元素element</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">elementData</span><span style="color:#000">[</span><span style="color:#000">index</span><span style="color:#000">]</span> <span style="color:#000">=</span> <span style="color:#000">element</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// 将列表元素个数加1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">size</span><span style="color:#000">++</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><hr>
<div class="flex align-center gdoc-page__anchorwrap">
    <h1 id="31-public-e-removeint-index"
    >
        31. public E remove(int index)
    </h1>
    <a data-clipboard-text="https://hongmao.run/jdk8-src-note/java/util/ArrayList/#31-public-e-removeint-index" class="gdoc-page__anchor clip flex align-center" title="锚定到： 31. public E remove(int index)" aria-label="锚定到： 31. public E remove(int index)" href="#31-public-e-removeint-index">
        <svg class="gdoc-icon gdoc_link"><use xlink:href="#gdoc_link"></use></svg>
    </a>
</div>
<p>删除此列表中指定位置的元素。将所有后续元素向左移动（将其索引减1）。</p>
<p>源码如下：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#a90d91">public</span> <span style="color:#000">E</span> <span style="color:#000">remove</span>(<span style="color:#a90d91">int</span> <span style="color:#000">index</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// 对索引进行范围检查</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">rangeCheck</span>(<span style="color:#000">index</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">modCount</span><span style="color:#000">++</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// 取出指定索引位置当前的元素</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">E</span> <span style="color:#000">oldValue</span> <span style="color:#000">=</span> <span style="color:#000">elementData</span>(<span style="color:#000">index</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// 计算出要移动的元素个数</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">int</span> <span style="color:#000">numMoved</span> <span style="color:#000">=</span> <span style="color:#000">size</span> <span style="color:#000">-</span> <span style="color:#000">index</span> <span style="color:#000">-</span> <span style="color:#000">1</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// 如果需移动的元素个数大于0，则将对象数组从index+1位置及之后的元素复制到index位置及之后</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">if</span> (<span style="color:#000">numMoved</span> <span style="color:#000">&gt;</span> <span style="color:#000">0</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#000">System</span>.<span style="color:#836c28">arraycopy</span>(<span style="color:#000">elementData</span>, <span style="color:#000">index</span><span style="color:#000">+</span><span style="color:#000">1</span>, <span style="color:#000">elementData</span>, <span style="color:#000">index</span>,
</span></span><span style="display:flex;"><span>                         <span style="color:#000">numMoved</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// 先将size减1，然后将最后一个元素置为null，因为该位置的元素已被复制到它的前一位了</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">elementData</span><span style="color:#000">[--</span><span style="color:#000">size</span><span style="color:#000">]</span> <span style="color:#000">=</span> <span style="color:#a90d91">null</span>; <span style="color:#177500">// clear to let GC do its work</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// 返回旧值</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">return</span> <span style="color:#000">oldValue</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><hr>
<div class="flex align-center gdoc-page__anchorwrap">
    <h1 id="32-public-boolean-removeobject-o"
    >
        32. public boolean remove(Object o)
    </h1>
    <a data-clipboard-text="https://hongmao.run/jdk8-src-note/java/util/ArrayList/#32-public-boolean-removeobject-o" class="gdoc-page__anchor clip flex align-center" title="锚定到： 32. public boolean remove(Object o)" aria-label="锚定到： 32. public boolean remove(Object o)" href="#32-public-boolean-removeobject-o">
        <svg class="gdoc-icon gdoc_link"><use xlink:href="#gdoc_link"></use></svg>
    </a>
</div>
<p>如果存在指定元素，则从该列表中删除第一次出现的该元素。如果列表不包含该元素，则该列表将不会改变。更准确地说，是删除满足<code>(o==null ? get(i)==null : o.equals(get(i)))</code>（如果存在这样的元素）的最小索引<code>i</code>对应的元素。如果此列表包含指定的元素，则返回<code>true</code>（或者等效地，如果由于本方法被调用而导致此列表有更改，则返回<code>true</code>）。</p>
<p>源码如下：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#a90d91">public</span> <span style="color:#a90d91">boolean</span> <span style="color:#000">remove</span>(<span style="color:#000">Object</span> <span style="color:#000">o</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// 根据指定的元素o是否为空走不同的逻辑</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">if</span> (<span style="color:#000">o</span> <span style="color:#000">==</span> <span style="color:#a90d91">null</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#177500">// 遍历对象数组，逐个判断每个元素是否与指定元素相等，相等则调用fastRemove进行删除</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a90d91">for</span> (<span style="color:#a90d91">int</span> <span style="color:#000">index</span> <span style="color:#000">=</span> <span style="color:#000">0</span>; <span style="color:#000">index</span> <span style="color:#000">&lt;</span> <span style="color:#000">size</span>; <span style="color:#000">index</span><span style="color:#000">++</span>)
</span></span><span style="display:flex;"><span>            <span style="color:#a90d91">if</span> (<span style="color:#000">elementData</span><span style="color:#000">[</span><span style="color:#000">index</span><span style="color:#000">]</span> <span style="color:#000">==</span> <span style="color:#a90d91">null</span>) {
</span></span><span style="display:flex;"><span>                <span style="color:#000">fastRemove</span>(<span style="color:#000">index</span>);
</span></span><span style="display:flex;"><span>                <span style="color:#177500">// 删除了数据，返回true</span>
</span></span><span style="display:flex;"><span>                <span style="color:#a90d91">return</span> <span style="color:#a90d91">true</span>;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>    } <span style="color:#a90d91">else</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a90d91">for</span> (<span style="color:#a90d91">int</span> <span style="color:#000">index</span> <span style="color:#000">=</span> <span style="color:#000">0</span>; <span style="color:#000">index</span> <span style="color:#000">&lt;</span> <span style="color:#000">size</span>; <span style="color:#000">index</span><span style="color:#000">++</span>)
</span></span><span style="display:flex;"><span>            <span style="color:#a90d91">if</span> (<span style="color:#000">o</span>.<span style="color:#836c28">equals</span>(<span style="color:#000">elementData</span><span style="color:#000">[</span><span style="color:#000">index</span><span style="color:#000">]</span>)) {
</span></span><span style="display:flex;"><span>                <span style="color:#000">fastRemove</span>(<span style="color:#000">index</span>);
</span></span><span style="display:flex;"><span>                <span style="color:#a90d91">return</span> <span style="color:#a90d91">true</span>;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// 没有删除数据，返回false</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">return</span> <span style="color:#a90d91">false</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><hr>
<div class="flex align-center gdoc-page__anchorwrap">
    <h1 id="33-private-void-fastremoveint-index"
    >
        33. private void fastRemove(int index)
    </h1>
    <a data-clipboard-text="https://hongmao.run/jdk8-src-note/java/util/ArrayList/#33-private-void-fastremoveint-index" class="gdoc-page__anchor clip flex align-center" title="锚定到： 33. private void fastRemove(int index)" aria-label="锚定到： 33. private void fastRemove(int index)" href="#33-private-void-fastremoveint-index">
        <svg class="gdoc-icon gdoc_link"><use xlink:href="#gdoc_link"></use></svg>
    </a>
</div>
<p>私有的删除方法，跳过边界检查并且不返回移除的值。</p>
<p>源码如下：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#a90d91">private</span> <span style="color:#a90d91">void</span> <span style="color:#000">fastRemove</span>(<span style="color:#a90d91">int</span> <span style="color:#000">index</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#000">modCount</span><span style="color:#000">++</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// 与根据索引删除元素的方法中类似，先计算出要移动索引的元素个数</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">int</span> <span style="color:#000">numMoved</span> <span style="color:#000">=</span> <span style="color:#000">size</span> <span style="color:#000">-</span> <span style="color:#000">index</span> <span style="color:#000">-</span> <span style="color:#000">1</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// 如果需要移动索引，则同样把index+1及后面的元素复制到从index及之后的位置</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">if</span> (<span style="color:#000">numMoved</span> <span style="color:#000">&gt;</span> <span style="color:#000">0</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#000">System</span>.<span style="color:#836c28">arraycopy</span>(<span style="color:#000">elementData</span>, <span style="color:#000">index</span><span style="color:#000">+</span><span style="color:#000">1</span>, <span style="color:#000">elementData</span>, <span style="color:#000">index</span>,
</span></span><span style="display:flex;"><span>                         <span style="color:#000">numMoved</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// 将size减1，然后将最后一个元素置空</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">elementData</span><span style="color:#000">[--</span><span style="color:#000">size</span><span style="color:#000">]</span> <span style="color:#000">=</span> <span style="color:#a90d91">null</span>; <span style="color:#177500">// clear to let GC do its work</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><hr>
<div class="flex align-center gdoc-page__anchorwrap">
    <h1 id="34-public-void-clear"
    >
        34. public void clear()
    </h1>
    <a data-clipboard-text="https://hongmao.run/jdk8-src-note/java/util/ArrayList/#34-public-void-clear" class="gdoc-page__anchor clip flex align-center" title="锚定到： 34. public void clear()" aria-label="锚定到： 34. public void clear()" href="#34-public-void-clear">
        <svg class="gdoc-icon gdoc_link"><use xlink:href="#gdoc_link"></use></svg>
    </a>
</div>
<p>从此列表中删除所有元素。该方法被调用后，该列表将为空。</p>
<p>源码如下：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#a90d91">public</span> <span style="color:#a90d91">void</span> <span style="color:#000">clear</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#000">modCount</span><span style="color:#000">++</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// clear to let GC do its work</span>
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// 遍历对象数组，将每个位置上的元素置为null</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">for</span> (<span style="color:#a90d91">int</span> <span style="color:#000">i</span> <span style="color:#000">=</span> <span style="color:#000">0</span>; <span style="color:#000">i</span> <span style="color:#000">&lt;</span> <span style="color:#000">size</span>; <span style="color:#000">i</span><span style="color:#000">++</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#000">elementData</span><span style="color:#000">[</span><span style="color:#000">i</span><span style="color:#000">]</span> <span style="color:#000">=</span> <span style="color:#a90d91">null</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// 将size置为0</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">size</span> <span style="color:#000">=</span> <span style="color:#000">0</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><hr>
<div class="flex align-center gdoc-page__anchorwrap">
    <h1 id="35-public-boolean-addallcollection-extends-e-c"
    >
        35. public boolean addAll(Collection&lt;? extends E&gt; c)
    </h1>
    <a data-clipboard-text="https://hongmao.run/jdk8-src-note/java/util/ArrayList/#35-public-boolean-addallcollection-extends-e-c" class="gdoc-page__anchor clip flex align-center" title="锚定到： 35. public boolean addAll(Collection&lt;? extends E&gt; c)" aria-label="锚定到： 35. public boolean addAll(Collection&lt;? extends E&gt; c)" href="#35-public-boolean-addallcollection-extends-e-c">
        <svg class="gdoc-icon gdoc_link"><use xlink:href="#gdoc_link"></use></svg>
    </a>
</div>
<p>按照参数中指定集合的<code>Iterator</code>返回的顺序，将指定集合中的所有元素追加到此列表的末尾。 如果在操作进行过程中修改了指定的集合，则此操作的行为是不确定的。（这意味着如果指定的集合就是本列表自身，并且本列表是非空的，则此调用的行为是不确定的。）</p>
<p>源码如下：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#a90d91">public</span> <span style="color:#a90d91">boolean</span> <span style="color:#000">addAll</span>(<span style="color:#000">Collection</span><span style="color:#000">&lt;?</span> <span style="color:#a90d91">extends</span> <span style="color:#000">E</span><span style="color:#000">&gt;</span> <span style="color:#000">c</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// 将指定集合转为数组</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">Object</span><span style="color:#000">[]</span> <span style="color:#000">a</span> <span style="color:#000">=</span> <span style="color:#000">c</span>.<span style="color:#836c28">toArray</span>();
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">int</span> <span style="color:#000">numNew</span> <span style="color:#000">=</span> <span style="color:#000">a</span>.<span style="color:#836c28">length</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// 元素插入前的常规操作：确认容量足够</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">ensureCapacityInternal</span>(<span style="color:#000">size</span> <span style="color:#000">+</span> <span style="color:#000">numNew</span>);  <span style="color:#177500">// Increments modCount</span>
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// 将指定集合转化成的数组a复制到本列表的对象数组中</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">System</span>.<span style="color:#836c28">arraycopy</span>(<span style="color:#000">a</span>, <span style="color:#000">0</span>, <span style="color:#000">elementData</span>, <span style="color:#000">size</span>, <span style="color:#000">numNew</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// 增加size</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">size</span> <span style="color:#000">+=</span> <span style="color:#000">numNew</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// 若此方法实际插入了元素，则返回true，否则返回false</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">return</span> <span style="color:#000">numNew</span> <span style="color:#000">!=</span> <span style="color:#000">0</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><hr>
<div class="flex align-center gdoc-page__anchorwrap">
    <h1 id="36-public-boolean-addallint-index-collection-extends-e-c"
    >
        36. public boolean addAll(int index, Collection&lt;? extends E&gt; c)
    </h1>
    <a data-clipboard-text="https://hongmao.run/jdk8-src-note/java/util/ArrayList/#36-public-boolean-addallint-index-collection-extends-e-c" class="gdoc-page__anchor clip flex align-center" title="锚定到： 36. public boolean addAll(int index, Collection&lt;? extends E&gt; c)" aria-label="锚定到： 36. public boolean addAll(int index, Collection&lt;? extends E&gt; c)" href="#36-public-boolean-addallint-index-collection-extends-e-c">
        <svg class="gdoc-icon gdoc_link"><use xlink:href="#gdoc_link"></use></svg>
    </a>
</div>
<p>从指定位置<code>index</code>开始，将指定集合<code>c</code>中的所有元素插入此列表。将当前位于该位置的元素（如果有的话）和任何后续元素向右移动（对它们的索引加一）。 新元素将按照指定集合的迭代器返回的顺序出现在列表中。</p>
<p>源码如下：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#a90d91">public</span> <span style="color:#a90d91">boolean</span> <span style="color:#000">addAll</span>(<span style="color:#a90d91">int</span> <span style="color:#000">index</span>, <span style="color:#000">Collection</span><span style="color:#000">&lt;?</span> <span style="color:#a90d91">extends</span> <span style="color:#000">E</span><span style="color:#000">&gt;</span> <span style="color:#000">c</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// 检查指定索引是否合法（大于0小于等于size）</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">rangeCheckForAdd</span>(<span style="color:#000">index</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// addAll的常规操作，将指定集合转为数组，然后确保容量足够</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">Object</span><span style="color:#000">[]</span> <span style="color:#000">a</span> <span style="color:#000">=</span> <span style="color:#000">c</span>.<span style="color:#836c28">toArray</span>();
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">int</span> <span style="color:#000">numNew</span> <span style="color:#000">=</span> <span style="color:#000">a</span>.<span style="color:#836c28">length</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#000">ensureCapacityInternal</span>(<span style="color:#000">size</span> <span style="color:#000">+</span> <span style="color:#000">numNew</span>);  <span style="color:#177500">// Increments modCount</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// 先判断是否要移动索引，如果插入位置不是列表末尾的话，就需要移动</span>
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// 此举是为了腾出空来放置指定集合内的元素</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">int</span> <span style="color:#000">numMoved</span> <span style="color:#000">=</span> <span style="color:#000">size</span> <span style="color:#000">-</span> <span style="color:#000">index</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">if</span> (<span style="color:#000">numMoved</span> <span style="color:#000">&gt;</span> <span style="color:#000">0</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#000">System</span>.<span style="color:#836c28">arraycopy</span>(<span style="color:#000">elementData</span>, <span style="color:#000">index</span>, <span style="color:#000">elementData</span>, <span style="color:#000">index</span> <span style="color:#000">+</span> <span style="color:#000">numNew</span>,
</span></span><span style="display:flex;"><span>                         <span style="color:#000">numMoved</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// 将指定集合转化成的数组a复制到本列表的对象数组中刚腾出来的位置</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">System</span>.<span style="color:#836c28">arraycopy</span>(<span style="color:#000">a</span>, <span style="color:#000">0</span>, <span style="color:#000">elementData</span>, <span style="color:#000">index</span>, <span style="color:#000">numNew</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#000">size</span> <span style="color:#000">+=</span> <span style="color:#000">numNew</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">return</span> <span style="color:#000">numNew</span> <span style="color:#000">!=</span> <span style="color:#000">0</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><hr>
<div class="flex align-center gdoc-page__anchorwrap">
    <h1 id="37-protected-void-removerangeint-fromindex-int-toindex"
    >
        37. protected void removeRange(int fromIndex, int toIndex)
    </h1>
    <a data-clipboard-text="https://hongmao.run/jdk8-src-note/java/util/ArrayList/#37-protected-void-removerangeint-fromindex-int-toindex" class="gdoc-page__anchor clip flex align-center" title="锚定到： 37. protected void removeRange(int fromIndex, int toIndex)" aria-label="锚定到： 37. protected void removeRange(int fromIndex, int toIndex)" href="#37-protected-void-removerangeint-fromindex-int-toindex">
        <svg class="gdoc-icon gdoc_link"><use xlink:href="#gdoc_link"></use></svg>
    </a>
</div>
<p>删除当前列表中所有索引位置在<code>fromIndex</code>（包含）和<code>toIndex</code>（不包含）之间的元素。后面的元素都向左异动（减小其索引）。</p>
<p>调用此方法会缩短列表<code>(toIndex - fromIndex)</code>个元素。如果<code>toIndex==fromIndex</code>，该操作将不会对列表造成影响。</p>
<p>源码如下：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#a90d91">protected</span> <span style="color:#a90d91">void</span> <span style="color:#000">removeRange</span>(<span style="color:#a90d91">int</span> <span style="color:#000">fromIndex</span>, <span style="color:#a90d91">int</span> <span style="color:#000">toIndex</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#000">modCount</span><span style="color:#000">++</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// 计算要移动的元素个数，toIndex及之后位置的元素都需要移动</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">int</span> <span style="color:#000">numMoved</span> <span style="color:#000">=</span> <span style="color:#000">size</span> <span style="color:#000">-</span> <span style="color:#000">toIndex</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// 将toIndex及之后的元素复制到fromIndex及之后的位置</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">System</span>.<span style="color:#836c28">arraycopy</span>(<span style="color:#000">elementData</span>, <span style="color:#000">toIndex</span>, <span style="color:#000">elementData</span>, <span style="color:#000">fromIndex</span>,
</span></span><span style="display:flex;"><span>                     <span style="color:#000">numMoved</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// clear to let GC do its work</span>
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// 拿到列表的新大小</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">int</span> <span style="color:#000">newSize</span> <span style="color:#000">=</span> <span style="color:#000">size</span> <span style="color:#000">-</span> (<span style="color:#000">toIndex</span><span style="color:#000">-</span><span style="color:#000">fromIndex</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// 将索引位置在新大小之后的元素均置为null</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">for</span> (<span style="color:#a90d91">int</span> <span style="color:#000">i</span> <span style="color:#000">=</span> <span style="color:#000">newSize</span>; <span style="color:#000">i</span> <span style="color:#000">&lt;</span> <span style="color:#000">size</span>; <span style="color:#000">i</span><span style="color:#000">++</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#000">elementData</span><span style="color:#000">[</span><span style="color:#000">i</span><span style="color:#000">]</span> <span style="color:#000">=</span> <span style="color:#a90d91">null</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#000">size</span> <span style="color:#000">=</span> <span style="color:#000">newSize</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><hr>
<div class="flex align-center gdoc-page__anchorwrap">
    <h1 id="38-private-void-rangecheckint-index"
    >
        38. private void rangeCheck(int index)
    </h1>
    <a data-clipboard-text="https://hongmao.run/jdk8-src-note/java/util/ArrayList/#38-private-void-rangecheckint-index" class="gdoc-page__anchor clip flex align-center" title="锚定到： 38. private void rangeCheck(int index)" aria-label="锚定到： 38. private void rangeCheck(int index)" href="#38-private-void-rangecheckint-index">
        <svg class="gdoc-icon gdoc_link"><use xlink:href="#gdoc_link"></use></svg>
    </a>
</div>
<p>检查给定的索引是否在范围内。如果不是，则抛出适当的运行时异常。此方法不检查索引是否为负数：它始终在数组访问之前立即使用，如果索引为负数，则抛出 <code>ArrayIndexOutOfBoundsException</code>。</p>
<p>源码如下：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#a90d91">private</span> <span style="color:#a90d91">void</span> <span style="color:#000">rangeCheck</span>(<span style="color:#a90d91">int</span> <span style="color:#000">index</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">if</span> (<span style="color:#000">index</span> <span style="color:#000">&gt;=</span> <span style="color:#000">size</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#a90d91">throw</span> <span style="color:#a90d91">new</span> <span style="color:#000">IndexOutOfBoundsException</span>(<span style="color:#000">outOfBoundsMsg</span>(<span style="color:#000">index</span>));
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><hr>
<div class="flex align-center gdoc-page__anchorwrap">
    <h1 id="39-private-void-rangecheckforaddint-index"
    >
        39. private void rangeCheckForAdd(int index)
    </h1>
    <a data-clipboard-text="https://hongmao.run/jdk8-src-note/java/util/ArrayList/#39-private-void-rangecheckforaddint-index" class="gdoc-page__anchor clip flex align-center" title="锚定到： 39. private void rangeCheckForAdd(int index)" aria-label="锚定到： 39. private void rangeCheckForAdd(int index)" href="#39-private-void-rangecheckforaddint-index">
        <svg class="gdoc-icon gdoc_link"><use xlink:href="#gdoc_link"></use></svg>
    </a>
</div>
<p><code>add</code>和<code>addAll</code>使用的<code>rangeCheck</code>版本。</p>
<p>源码如下：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#a90d91">private</span> <span style="color:#a90d91">void</span> <span style="color:#000">rangeCheckForAdd</span>(<span style="color:#a90d91">int</span> <span style="color:#000">index</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// 该校验允许index等于size，因为在插入元素时，可以往size这个索引位置插入</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">if</span> (<span style="color:#000">index</span> <span style="color:#000">&gt;</span> <span style="color:#000">size</span> <span style="color:#000">||</span> <span style="color:#000">index</span> <span style="color:#000">&lt;</span> <span style="color:#000">0</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#a90d91">throw</span> <span style="color:#a90d91">new</span> <span style="color:#000">IndexOutOfBoundsException</span>(<span style="color:#000">outOfBoundsMsg</span>(<span style="color:#000">index</span>));
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><hr>
<div class="flex align-center gdoc-page__anchorwrap">
    <h1 id="40-private-string-outofboundsmsgint-index"
    >
        40. private String outOfBoundsMsg(int index)
    </h1>
    <a data-clipboard-text="https://hongmao.run/jdk8-src-note/java/util/ArrayList/#40-private-string-outofboundsmsgint-index" class="gdoc-page__anchor clip flex align-center" title="锚定到： 40. private String outOfBoundsMsg(int index)" aria-label="锚定到： 40. private String outOfBoundsMsg(int index)" href="#40-private-string-outofboundsmsgint-index">
        <svg class="gdoc-icon gdoc_link"><use xlink:href="#gdoc_link"></use></svg>
    </a>
</div>
<p>构造一个<code>IndexOutOfBoundsException</code>详细消息。在错误处理代码的许多可能重构中，这种“概述”在服务器和客户端VM上表现最佳。</p>
<p>源码如下：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#a90d91">private</span> <span style="color:#000">String</span> <span style="color:#000">outOfBoundsMsg</span>(<span style="color:#a90d91">int</span> <span style="color:#000">index</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">return</span> <span style="color:#c41a16">&#34;Index: &#34;</span><span style="color:#000">+</span><span style="color:#000">index</span><span style="color:#000">+</span><span style="color:#c41a16">&#34;, Size: &#34;</span><span style="color:#000">+</span><span style="color:#000">size</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><hr>
<div class="flex align-center gdoc-page__anchorwrap">
    <h1 id="41-public-boolean-removeallcollection-c"
    >
        41. public boolean removeAll(Collection<!-- raw HTML omitted --> c)
    </h1>
    <a data-clipboard-text="https://hongmao.run/jdk8-src-note/java/util/ArrayList/#41-public-boolean-removeallcollection-c" class="gdoc-page__anchor clip flex align-center" title="锚定到： 41. public boolean removeAll(Collection c)" aria-label="锚定到： 41. public boolean removeAll(Collection c)" href="#41-public-boolean-removeallcollection-c">
        <svg class="gdoc-icon gdoc_link"><use xlink:href="#gdoc_link"></use></svg>
    </a>
</div>
<p>从此列表中移除指定集合中包含的所有元素。</p>
<p>源码如下：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#a90d91">public</span> <span style="color:#a90d91">boolean</span> <span style="color:#000">removeAll</span>(<span style="color:#000">Collection</span><span style="color:#000">&lt;?&gt;</span> <span style="color:#000">c</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// 指定集合c不可为空</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">Objects</span>.<span style="color:#836c28">requireNonNull</span>(<span style="color:#000">c</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// 调用batchRemove方法删除元素</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">return</span> <span style="color:#000">batchRemove</span>(<span style="color:#000">c</span>, <span style="color:#a90d91">false</span>);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><hr>
<div class="flex align-center gdoc-page__anchorwrap">
    <h1 id="42-public-boolean-retainallcollection-c"
    >
        42. public boolean retainAll(Collection<!-- raw HTML omitted --> c)
    </h1>
    <a data-clipboard-text="https://hongmao.run/jdk8-src-note/java/util/ArrayList/#42-public-boolean-retainallcollection-c" class="gdoc-page__anchor clip flex align-center" title="锚定到： 42. public boolean retainAll(Collection c)" aria-label="锚定到： 42. public boolean retainAll(Collection c)" href="#42-public-boolean-retainallcollection-c">
        <svg class="gdoc-icon gdoc_link"><use xlink:href="#gdoc_link"></use></svg>
    </a>
</div>
<p>仅保留此列表中指定集合中包含的元素。换句话说，从该列表中删除所有未包含在指定集合中的元素。</p>
<p>源码如下：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#a90d91">public</span> <span style="color:#a90d91">boolean</span> <span style="color:#000">retainAll</span>(<span style="color:#000">Collection</span><span style="color:#000">&lt;?&gt;</span> <span style="color:#000">c</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// 指定集合c必须非空</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">Objects</span>.<span style="color:#836c28">requireNonNull</span>(<span style="color:#000">c</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// 调用batchRemove方法，此处与removeAll方法内不同，此处传的第二个参数为true</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">return</span> <span style="color:#000">batchRemove</span>(<span style="color:#000">c</span>, <span style="color:#a90d91">true</span>);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><hr>
<div class="flex align-center gdoc-page__anchorwrap">
    <h1 id="43-private-boolean-batchremovecollection-c-boolean-complement"
    >
        43. private boolean batchRemove(Collection<!-- raw HTML omitted --> c, boolean complement)
    </h1>
    <a data-clipboard-text="https://hongmao.run/jdk8-src-note/java/util/ArrayList/#43-private-boolean-batchremovecollection-c-boolean-complement" class="gdoc-page__anchor clip flex align-center" title="锚定到： 43. private boolean batchRemove(Collection c, boolean complement)" aria-label="锚定到： 43. private boolean batchRemove(Collection c, boolean complement)" href="#43-private-boolean-batchremovecollection-c-boolean-complement">
        <svg class="gdoc-icon gdoc_link"><use xlink:href="#gdoc_link"></use></svg>
    </a>
</div>
<p>批量删除的方法，参数<code>complement</code>为补集的意思。也就是，当<code>complement</code>为<code>true</code>时，批量删除掉的是补集（即当前列表在指定集合c中的补集），否则批量删除掉的就是集合<code>c</code>。</p>
<p>源码如下：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#a90d91">private</span> <span style="color:#a90d91">boolean</span> <span style="color:#000">batchRemove</span>(<span style="color:#000">Collection</span><span style="color:#000">&lt;?&gt;</span> <span style="color:#000">c</span>, <span style="color:#a90d91">boolean</span> <span style="color:#000">complement</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">final</span> <span style="color:#000">Object</span><span style="color:#000">[]</span> <span style="color:#000">elementData</span> <span style="color:#000">=</span> <span style="color:#a90d91">this</span>.<span style="color:#836c28">elementData</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// r：遍历当前集合时遍历到的索引位置；w：“新”对象数组的size</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">int</span> <span style="color:#000">r</span> <span style="color:#000">=</span> <span style="color:#000">0</span>, <span style="color:#000">w</span> <span style="color:#000">=</span> <span style="color:#000">0</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">boolean</span> <span style="color:#000">modified</span> <span style="color:#000">=</span> <span style="color:#a90d91">false</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">try</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#177500">// 遍历当前集合</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a90d91">for</span> (; <span style="color:#000">r</span> <span style="color:#000">&lt;</span> <span style="color:#000">size</span>; <span style="color:#000">r</span><span style="color:#000">++</span>)
</span></span><span style="display:flex;"><span>            <span style="color:#177500">// 先求出指定的集合c中是否包含当前迭代到的元素，再根据是否是删除补集来判断出是否要保留当前元素</span>
</span></span><span style="display:flex;"><span>            <span style="color:#a90d91">if</span> (<span style="color:#000">c</span>.<span style="color:#836c28">contains</span>(<span style="color:#000">elementData</span><span style="color:#000">[</span><span style="color:#000">r</span><span style="color:#000">]</span>) <span style="color:#000">==</span> <span style="color:#000">complement</span>)
</span></span><span style="display:flex;"><span>                <span style="color:#177500">// 将当前元素从新排入对象数组</span>
</span></span><span style="display:flex;"><span>                <span style="color:#000">elementData</span><span style="color:#000">[</span><span style="color:#000">w</span><span style="color:#000">++]</span> <span style="color:#000">=</span> <span style="color:#000">elementData</span><span style="color:#000">[</span><span style="color:#000">r</span><span style="color:#000">]</span>;
</span></span><span style="display:flex;"><span>    } <span style="color:#a90d91">finally</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#177500">// Preserve behavioral compatibility with AbstractCollection,</span>
</span></span><span style="display:flex;"><span>        <span style="color:#177500">// even if c.contains() throws.</span>
</span></span><span style="display:flex;"><span>        <span style="color:#177500">// 此处，如果r和size不相等，说明在遍历当前集合的过程中抛出了异常，未能遍历完</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a90d91">if</span> (<span style="color:#000">r</span> <span style="color:#000">!=</span> <span style="color:#000">size</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#177500">// 此时将遍历停止的位置及之后的元素拼接到对象数组的w位置之后</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">System</span>.<span style="color:#836c28">arraycopy</span>(<span style="color:#000">elementData</span>, <span style="color:#000">r</span>,
</span></span><span style="display:flex;"><span>                             <span style="color:#000">elementData</span>, <span style="color:#000">w</span>,
</span></span><span style="display:flex;"><span>                             <span style="color:#000">size</span> <span style="color:#000">-</span> <span style="color:#000">r</span>);
</span></span><span style="display:flex;"><span>            <span style="color:#177500">// “新”对象数组的size加上后面那些没遍历到的元素个数，这就是调用完此方法后当前列表的元素个数了</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">w</span> <span style="color:#000">+=</span> <span style="color:#000">size</span> <span style="color:#000">-</span> <span style="color:#000">r</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#177500">// 如果“新”对象数组的元素个数与当前列表的元素个数不相等，说明有元素被删除了</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a90d91">if</span> (<span style="color:#000">w</span> <span style="color:#000">!=</span> <span style="color:#000">size</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#177500">// clear to let GC do its work</span>
</span></span><span style="display:flex;"><span>            <span style="color:#177500">// 遍历对象数组从“新”数组大小之后的元素，对其逐个置为null</span>
</span></span><span style="display:flex;"><span>            <span style="color:#a90d91">for</span> (<span style="color:#a90d91">int</span> <span style="color:#000">i</span> <span style="color:#000">=</span> <span style="color:#000">w</span>; <span style="color:#000">i</span> <span style="color:#000">&lt;</span> <span style="color:#000">size</span>; <span style="color:#000">i</span><span style="color:#000">++</span>)
</span></span><span style="display:flex;"><span>                <span style="color:#000">elementData</span><span style="color:#000">[</span><span style="color:#000">i</span><span style="color:#000">]</span> <span style="color:#000">=</span> <span style="color:#a90d91">null</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#000">modCount</span> <span style="color:#000">+=</span> <span style="color:#000">size</span> <span style="color:#000">-</span> <span style="color:#000">w</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#000">size</span> <span style="color:#000">=</span> <span style="color:#000">w</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#000">modified</span> <span style="color:#000">=</span> <span style="color:#a90d91">true</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">return</span> <span style="color:#000">modified</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>上述所提到的“新”对象数组，其实数组还是当前列表的对象数组，只不过该方法在删除元素时采用的不是“删除”操作，而是采用的“保留”操作，未被保留的元素相当于被删除了。如果方法判定该元素需保留，则会将它放到对象数组的合适位置，该合适位置是从0开始往后排的，这些位置存放的都是要被保留的元素，这也就是所谓的“新”对象数组。</p>
<hr>
<div class="flex align-center gdoc-page__anchorwrap">
    <h1 id="44-private-void-writeobjectjavaioobjectoutputstream-s"
    >
        44. private void writeObject(java.io.ObjectOutputStream s)
    </h1>
    <a data-clipboard-text="https://hongmao.run/jdk8-src-note/java/util/ArrayList/#44-private-void-writeobjectjavaioobjectoutputstream-s" class="gdoc-page__anchor clip flex align-center" title="锚定到： 44. private void writeObject(java.io.ObjectOutputStream s)" aria-label="锚定到： 44. private void writeObject(java.io.ObjectOutputStream s)" href="#44-private-void-writeobjectjavaioobjectoutputstream-s">
        <svg class="gdoc-icon gdoc_link"><use xlink:href="#gdoc_link"></use></svg>
    </a>
</div>
<p>将<code>ArrayList</code>实例的状态保存到流中（即序列化它）。该列表的对象数组的长度以及其存放的元素（会以正确的顺序）都会被序列化。</p>
<p>源码如下：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#a90d91">private</span> <span style="color:#a90d91">void</span> <span style="color:#000">writeObject</span>(<span style="color:#000">java</span>.<span style="color:#836c28">io</span>.<span style="color:#836c28">ObjectOutputStream</span> <span style="color:#000">s</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">throws</span> <span style="color:#000">java</span>.<span style="color:#836c28">io</span>.<span style="color:#836c28">IOException</span>{
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// Write out element count, and any hidden stuff</span>
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// 写出元素数量和任何隐藏的内容</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">int</span> <span style="color:#000">expectedModCount</span> <span style="color:#000">=</span> <span style="color:#000">modCount</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#000">s</span>.<span style="color:#836c28">defaultWriteObject</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// Write out size as capacity for behavioural compatibility with clone()</span>
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// 写出大小作为与 clone() 的行为兼容性的容量</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">s</span>.<span style="color:#836c28">writeInt</span>(<span style="color:#000">size</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// Write out all elements in the proper order.</span>
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// 以合适的顺序写出所有的元素</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">for</span> (<span style="color:#a90d91">int</span> <span style="color:#000">i</span><span style="color:#000">=</span><span style="color:#000">0</span>; <span style="color:#000">i</span><span style="color:#000">&lt;</span><span style="color:#000">size</span>; <span style="color:#000">i</span><span style="color:#000">++</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#000">s</span>.<span style="color:#836c28">writeObject</span>(<span style="color:#000">elementData</span><span style="color:#000">[</span><span style="color:#000">i</span><span style="color:#000">]</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">if</span> (<span style="color:#000">modCount</span> <span style="color:#000">!=</span> <span style="color:#000">expectedModCount</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#a90d91">throw</span> <span style="color:#a90d91">new</span> <span style="color:#000">ConcurrentModificationException</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><hr>
<div class="flex align-center gdoc-page__anchorwrap">
    <h1 id="45-private-void-readobjectjavaioobjectinputstream-s"
    >
        45. private void readObject(java.io.ObjectInputStream s)
    </h1>
    <a data-clipboard-text="https://hongmao.run/jdk8-src-note/java/util/ArrayList/#45-private-void-readobjectjavaioobjectinputstream-s" class="gdoc-page__anchor clip flex align-center" title="锚定到： 45. private void readObject(java.io.ObjectInputStream s)" aria-label="锚定到： 45. private void readObject(java.io.ObjectInputStream s)" href="#45-private-void-readobjectjavaioobjectinputstream-s">
        <svg class="gdoc-icon gdoc_link"><use xlink:href="#gdoc_link"></use></svg>
    </a>
</div>
<p>从流中重新构造<code>ArrayList</code>实例（即反序列化它）。</p>
<p>源码如下：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#a90d91">private</span> <span style="color:#a90d91">void</span> <span style="color:#000">readObject</span>(<span style="color:#000">java</span>.<span style="color:#836c28">io</span>.<span style="color:#836c28">ObjectInputStream</span> <span style="color:#000">s</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">throws</span> <span style="color:#000">java</span>.<span style="color:#836c28">io</span>.<span style="color:#836c28">IOException</span>, <span style="color:#000">ClassNotFoundException</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#000">elementData</span> <span style="color:#000">=</span> <span style="color:#000">EMPTY_ELEMENTDATA</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// Read in size, and any hidden stuff</span>
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// 读取数量和任意隐藏的内容</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">s</span>.<span style="color:#836c28">defaultReadObject</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// Read in capacity</span>
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// 读取容量</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">s</span>.<span style="color:#836c28">readInt</span>(); <span style="color:#177500">// ignored</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// 如果容量大于0才读取元素</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">if</span> (<span style="color:#000">size</span> <span style="color:#000">&gt;</span> <span style="color:#000">0</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#177500">// be like clone(), allocate array based upon size not capacity</span>
</span></span><span style="display:flex;"><span>        <span style="color:#177500">// 就像 clone()，根据大小而不是容量分配数组</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a90d91">int</span> <span style="color:#000">capacity</span> <span style="color:#000">=</span> <span style="color:#000">calculateCapacity</span>(<span style="color:#000">elementData</span>, <span style="color:#000">size</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#000">SharedSecrets</span>.<span style="color:#836c28">getJavaOISAccess</span>().<span style="color:#836c28">checkArray</span>(<span style="color:#000">s</span>, <span style="color:#000">Object</span><span style="color:#000">[]</span>.<span style="color:#836c28">class</span>, <span style="color:#000">capacity</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#000">ensureCapacityInternal</span>(<span style="color:#000">size</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">Object</span><span style="color:#000">[]</span> <span style="color:#000">a</span> <span style="color:#000">=</span> <span style="color:#000">elementData</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#177500">// Read in all elements in the proper order.</span>
</span></span><span style="display:flex;"><span>        <span style="color:#177500">// 以合适的顺序读取所有元素</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a90d91">for</span> (<span style="color:#a90d91">int</span> <span style="color:#000">i</span><span style="color:#000">=</span><span style="color:#000">0</span>; <span style="color:#000">i</span><span style="color:#000">&lt;</span><span style="color:#000">size</span>; <span style="color:#000">i</span><span style="color:#000">++</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#000">a</span><span style="color:#000">[</span><span style="color:#000">i</span><span style="color:#000">]</span> <span style="color:#000">=</span> <span style="color:#000">s</span>.<span style="color:#836c28">readObject</span>();
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><hr>
<div class="flex align-center gdoc-page__anchorwrap">
    <h1 id="46-public-listiteratorlte-listiteratorint-index"
    >
        46. public ListIterator&lt;E&gt; listIterator(int index)
    </h1>
    <a data-clipboard-text="https://hongmao.run/jdk8-src-note/java/util/ArrayList/#46-public-listiteratorlte-listiteratorint-index" class="gdoc-page__anchor clip flex align-center" title="锚定到： 46. public ListIterator&lt;E&gt; listIterator(int index)" aria-label="锚定到： 46. public ListIterator&lt;E&gt; listIterator(int index)" href="#46-public-listiteratorlte-listiteratorint-index">
        <svg class="gdoc-icon gdoc_link"><use xlink:href="#gdoc_link"></use></svg>
    </a>
</div>
<p>从列表中的指定位置开始，返回此列表列表迭代器（元素以适当的顺序返回）。指定的索引表示初始调用<code>ListIterator.next</code>将返回的第一个元素。初次调用<code>ListIterator#previous</code>将返回具有指定索引减一的元素。</p>
<p>源码如下：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#a90d91">public</span> <span style="color:#000">ListIterator</span><span style="color:#000">&lt;</span><span style="color:#000">E</span><span style="color:#000">&gt;</span> <span style="color:#000">listIterator</span>(<span style="color:#a90d91">int</span> <span style="color:#000">index</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// 对指定索引index进行校验</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">if</span> (<span style="color:#000">index</span> <span style="color:#000">&lt;</span> <span style="color:#000">0</span> <span style="color:#000">||</span> <span style="color:#000">index</span> <span style="color:#000">&gt;</span> <span style="color:#000">size</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#a90d91">throw</span> <span style="color:#a90d91">new</span> <span style="color:#000">IndexOutOfBoundsException</span>(<span style="color:#c41a16">&#34;Index: &#34;</span><span style="color:#000">+</span><span style="color:#000">index</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// 返回一个新ListItr实例</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">return</span> <span style="color:#a90d91">new</span> <span style="color:#000">ListItr</span>(<span style="color:#000">index</span>);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>如下为一些单元测试：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#000">@Test</span>
</span></span><span style="display:flex;"><span><span style="color:#a90d91">public</span> <span style="color:#a90d91">void</span> <span style="color:#000">testListIterator</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#000">List</span><span style="color:#000">&lt;</span><span style="color:#000">Integer</span><span style="color:#000">&gt;</span> <span style="color:#000">list</span> <span style="color:#000">=</span> <span style="color:#a90d91">new</span> <span style="color:#000">ArrayList</span><span style="color:#000">&lt;&gt;</span>();
</span></span><span style="display:flex;"><span>    <span style="color:#000">list</span>.<span style="color:#836c28">add</span>(<span style="color:#000">1</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#000">list</span>.<span style="color:#836c28">add</span>(<span style="color:#000">2</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#000">list</span>.<span style="color:#836c28">add</span>(<span style="color:#000">3</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#000">list</span>.<span style="color:#836c28">add</span>(<span style="color:#000">4</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#000">list</span>.<span style="color:#836c28">add</span>(<span style="color:#000">5</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// 指定索引获取的迭代器，调用next方法会获得该索引位置的元素</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">System</span>.<span style="color:#836c28">out</span>.<span style="color:#836c28">println</span>(<span style="color:#000">list</span>.<span style="color:#836c28">listIterator</span>(<span style="color:#000">2</span>).<span style="color:#836c28">previous</span>());
</span></span><span style="display:flex;"><span>    <span style="color:#000">System</span>.<span style="color:#836c28">out</span>.<span style="color:#836c28">println</span>(<span style="color:#000">list</span>.<span style="color:#836c28">listIterator</span>(<span style="color:#000">2</span>).<span style="color:#836c28">next</span>());
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// 不指定索引，等同于指定的索引为0，也即从头开始</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">System</span>.<span style="color:#836c28">out</span>.<span style="color:#836c28">println</span>(<span style="color:#000">list</span>.<span style="color:#836c28">listIterator</span>().<span style="color:#836c28">hasPrevious</span>());
</span></span><span style="display:flex;"><span>    <span style="color:#000">System</span>.<span style="color:#836c28">out</span>.<span style="color:#836c28">println</span>(<span style="color:#000">list</span>.<span style="color:#836c28">listIterator</span>().<span style="color:#836c28">next</span>());
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>输出：</p>
<pre tabindex="0"><code>2
3
false
1
</code></pre><hr>
<div class="flex align-center gdoc-page__anchorwrap">
    <h1 id="47-public-listiteratorlte-listiterator"
    >
        47. public ListIterator&lt;E&gt; listIterator()
    </h1>
    <a data-clipboard-text="https://hongmao.run/jdk8-src-note/java/util/ArrayList/#47-public-listiteratorlte-listiterator" class="gdoc-page__anchor clip flex align-center" title="锚定到： 47. public ListIterator&lt;E&gt; listIterator()" aria-label="锚定到： 47. public ListIterator&lt;E&gt; listIterator()" href="#47-public-listiteratorlte-listiterator">
        <svg class="gdoc-icon gdoc_link"><use xlink:href="#gdoc_link"></use></svg>
    </a>
</div>
<p>返回此列表中的元素的列表迭代器（按适当顺序）。</p>
<p>源码如下：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#a90d91">public</span> <span style="color:#000">ListIterator</span><span style="color:#000">&lt;</span><span style="color:#000">E</span><span style="color:#000">&gt;</span> <span style="color:#000">listIterator</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">return</span> <span style="color:#a90d91">new</span> <span style="color:#000">ListItr</span>(<span style="color:#000">0</span>);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><hr>
<div class="flex align-center gdoc-page__anchorwrap">
    <h1 id="48-public-iteratorlte-iterator"
    >
        48. public Iterator&lt;E&gt; iterator()
    </h1>
    <a data-clipboard-text="https://hongmao.run/jdk8-src-note/java/util/ArrayList/#48-public-iteratorlte-iterator" class="gdoc-page__anchor clip flex align-center" title="锚定到： 48. public Iterator&lt;E&gt; iterator()" aria-label="锚定到： 48. public Iterator&lt;E&gt; iterator()" href="#48-public-iteratorlte-iterator">
        <svg class="gdoc-icon gdoc_link"><use xlink:href="#gdoc_link"></use></svg>
    </a>
</div>
<p>返回一个以正确的顺序包含此列表中元素的迭代器。 源码如下：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#a90d91">public</span> <span style="color:#000">Iterator</span><span style="color:#000">&lt;</span><span style="color:#000">E</span><span style="color:#000">&gt;</span> <span style="color:#000">iterator</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">return</span> <span style="color:#a90d91">new</span> <span style="color:#000">Itr</span>();
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><hr>
<div class="flex align-center gdoc-page__anchorwrap">
    <h1 id="49-private-class-itr-implements-iteratorlte"
    >
        49. private class Itr implements Iterator&lt;E&gt;
    </h1>
    <a data-clipboard-text="https://hongmao.run/jdk8-src-note/java/util/ArrayList/#49-private-class-itr-implements-iteratorlte" class="gdoc-page__anchor clip flex align-center" title="锚定到： 49. private class Itr implements Iterator&lt;E&gt;" aria-label="锚定到： 49. private class Itr implements Iterator&lt;E&gt;" href="#49-private-class-itr-implements-iteratorlte">
        <svg class="gdoc-icon gdoc_link"><use xlink:href="#gdoc_link"></use></svg>
    </a>
</div>
<p>优化版本的<code>AbstractList.Itr</code>，实现了<code>Iterator</code>接口。</p>
<div class="flex align-center gdoc-page__anchorwrap">
    <h2 id="491-int-cursor"
    >
        49.1 int cursor;
    </h2>
    <a data-clipboard-text="https://hongmao.run/jdk8-src-note/java/util/ArrayList/#491-int-cursor" class="gdoc-page__anchor clip flex align-center" title="锚定到： 49.1 int cursor;" aria-label="锚定到： 49.1 int cursor;" href="#491-int-cursor">
        <svg class="gdoc-icon gdoc_link"><use xlink:href="#gdoc_link"></use></svg>
    </a>
</div>
<p><code>cursor</code>意为游标，其用于标识当前迭代器已经执行到哪个元素位置了。所以，它代表的是下一个要返回的元素的<code>index</code>。</p>
<div class="flex align-center gdoc-page__anchorwrap">
    <h2 id="492-int-lastret---1"
    >
        49.2 int lastRet = -1;
    </h2>
    <a data-clipboard-text="https://hongmao.run/jdk8-src-note/java/util/ArrayList/#492-int-lastret---1" class="gdoc-page__anchor clip flex align-center" title="锚定到： 49.2 int lastRet = -1;" aria-label="锚定到： 49.2 int lastRet = -1;" href="#492-int-lastret---1">
        <svg class="gdoc-icon gdoc_link"><use xlink:href="#gdoc_link"></use></svg>
    </a>
</div>
<p>该属性代表的是上一个返回的元素的<code>index</code>。当迭代器还没开始遍历的时候，其为-1。</p>
<div class="flex align-center gdoc-page__anchorwrap">
    <h2 id="493-int-expectedmodcount--modcount"
    >
        49.3 int expectedModCount = modCount;
    </h2>
    <a data-clipboard-text="https://hongmao.run/jdk8-src-note/java/util/ArrayList/#493-int-expectedmodcount--modcount" class="gdoc-page__anchor clip flex align-center" title="锚定到： 49.3 int expectedModCount = modCount;" aria-label="锚定到： 49.3 int expectedModCount = modCount;" href="#493-int-expectedmodcount--modcount">
        <svg class="gdoc-icon gdoc_link"><use xlink:href="#gdoc_link"></use></svg>
    </a>
</div>
<p>期望操作数，用于并发修改检查。</p>
<div class="flex align-center gdoc-page__anchorwrap">
    <h2 id="494-itr"
    >
        49.4 Itr()
    </h2>
    <a data-clipboard-text="https://hongmao.run/jdk8-src-note/java/util/ArrayList/#494-itr" class="gdoc-page__anchor clip flex align-center" title="锚定到： 49.4 Itr()" aria-label="锚定到： 49.4 Itr()" href="#494-itr">
        <svg class="gdoc-icon gdoc_link"><use xlink:href="#gdoc_link"></use></svg>
    </a>
</div>
<p>无参构造器。</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#000">Itr</span>() {}
</span></span></code></pre></div><div class="flex align-center gdoc-page__anchorwrap">
    <h2 id="495-public-boolean-hasnext"
    >
        49.5 public boolean hasNext()
    </h2>
    <a data-clipboard-text="https://hongmao.run/jdk8-src-note/java/util/ArrayList/#495-public-boolean-hasnext" class="gdoc-page__anchor clip flex align-center" title="锚定到： 49.5 public boolean hasNext()" aria-label="锚定到： 49.5 public boolean hasNext()" href="#495-public-boolean-hasnext">
        <svg class="gdoc-icon gdoc_link"><use xlink:href="#gdoc_link"></use></svg>
    </a>
</div>
<p>用于判断当前迭代器是否还有其他元素。</p>
<p>源码如下：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#a90d91">public</span> <span style="color:#a90d91">boolean</span> <span style="color:#000">hasNext</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">return</span> <span style="color:#000">cursor</span> <span style="color:#000">!=</span> <span style="color:#000">size</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><div class="flex align-center gdoc-page__anchorwrap">
    <h2 id="496-public-e-next"
    >
        49.6 public E next()
    </h2>
    <a data-clipboard-text="https://hongmao.run/jdk8-src-note/java/util/ArrayList/#496-public-e-next" class="gdoc-page__anchor clip flex align-center" title="锚定到： 49.6 public E next()" aria-label="锚定到： 49.6 public E next()" href="#496-public-e-next">
        <svg class="gdoc-icon gdoc_link"><use xlink:href="#gdoc_link"></use></svg>
    </a>
</div>
<p>用于获取迭代器的下一个元素。</p>
<p>源码如下：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#000">@SuppressWarnings</span>(<span style="color:#c41a16">&#34;unchecked&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#a90d91">public</span> <span style="color:#000">E</span> <span style="color:#000">next</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#000">checkForComodification</span>();
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// 记录下来当前游标位置</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">int</span> <span style="color:#000">i</span> <span style="color:#000">=</span> <span style="color:#000">cursor</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">if</span> (<span style="color:#000">i</span> <span style="color:#000">&gt;=</span> <span style="color:#000">size</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#a90d91">throw</span> <span style="color:#a90d91">new</span> <span style="color:#000">NoSuchElementException</span>();
</span></span><span style="display:flex;"><span>    <span style="color:#000">Object</span><span style="color:#000">[]</span> <span style="color:#000">elementData</span> <span style="color:#000">=</span> <span style="color:#000">ArrayList</span>.<span style="color:#836c28">this</span>.<span style="color:#836c28">elementData</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">if</span> (<span style="color:#000">i</span> <span style="color:#000">&gt;=</span> <span style="color:#000">elementData</span>.<span style="color:#836c28">length</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#a90d91">throw</span> <span style="color:#a90d91">new</span> <span style="color:#000">ConcurrentModificationException</span>();
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// 游标后移一位</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">cursor</span> <span style="color:#000">=</span> <span style="color:#000">i</span> <span style="color:#000">+</span> <span style="color:#000">1</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// 将之前记录下的游标位置i赋值给最近一次返回的索引，然后取出该位置的元素并返回</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">return</span> (<span style="color:#000">E</span>) <span style="color:#000">elementData</span><span style="color:#000">[</span><span style="color:#000">lastRet</span> <span style="color:#000">=</span> <span style="color:#000">i</span><span style="color:#000">]</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><div class="flex align-center gdoc-page__anchorwrap">
    <h2 id="497-public-void-remove"
    >
        49.7 public void remove()
    </h2>
    <a data-clipboard-text="https://hongmao.run/jdk8-src-note/java/util/ArrayList/#497-public-void-remove" class="gdoc-page__anchor clip flex align-center" title="锚定到： 49.7 public void remove()" aria-label="锚定到： 49.7 public void remove()" href="#497-public-void-remove">
        <svg class="gdoc-icon gdoc_link"><use xlink:href="#gdoc_link"></use></svg>
    </a>
</div>
<p>删除当前元素。</p>
<p>源码如下：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#a90d91">public</span> <span style="color:#a90d91">void</span> <span style="color:#000">remove</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">if</span> (<span style="color:#000">lastRet</span> <span style="color:#000">&lt;</span> <span style="color:#000">0</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#a90d91">throw</span> <span style="color:#a90d91">new</span> <span style="color:#000">IllegalStateException</span>();
</span></span><span style="display:flex;"><span>    <span style="color:#000">checkForComodification</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">try</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#177500">// 调用ArrayList的remove方法删除元素</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">ArrayList</span>.<span style="color:#836c28">this</span>.<span style="color:#836c28">remove</span>(<span style="color:#000">lastRet</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#177500">// 将上次返回的元素索引赋值给游标</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">cursor</span> <span style="color:#000">=</span> <span style="color:#000">lastRet</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#177500">// 将最近返回的元素索引置为-1</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">lastRet</span> <span style="color:#000">=</span> <span style="color:#000">-</span><span style="color:#000">1</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#000">expectedModCount</span> <span style="color:#000">=</span> <span style="color:#000">modCount</span>;
</span></span><span style="display:flex;"><span>    } <span style="color:#a90d91">catch</span> (<span style="color:#000">IndexOutOfBoundsException</span> <span style="color:#000">ex</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#a90d91">throw</span> <span style="color:#a90d91">new</span> <span style="color:#000">ConcurrentModificationException</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><div class="flex align-center gdoc-page__anchorwrap">
    <h2 id="498-public-void-foreachremainingconsumer-consumer"
    >
        49.8 public void forEachRemaining(Consumer consumer)
    </h2>
    <a data-clipboard-text="https://hongmao.run/jdk8-src-note/java/util/ArrayList/#498-public-void-foreachremainingconsumer-consumer" class="gdoc-page__anchor clip flex align-center" title="锚定到： 49.8 public void forEachRemaining(Consumer consumer)" aria-label="锚定到： 49.8 public void forEachRemaining(Consumer consumer)" href="#498-public-void-foreachremainingconsumer-consumer">
        <svg class="gdoc-icon gdoc_link"><use xlink:href="#gdoc_link"></use></svg>
    </a>
</div>
<p>对迭代器尚未遍历到的元素执行给定的操作。</p>
<p>源码如下：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#000">@Override</span>
</span></span><span style="display:flex;"><span><span style="color:#000">@SuppressWarnings</span>(<span style="color:#c41a16">&#34;unchecked&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#a90d91">public</span> <span style="color:#a90d91">void</span> <span style="color:#000">forEachRemaining</span>(<span style="color:#000">Consumer</span><span style="color:#000">&lt;?</span> <span style="color:#a90d91">super</span> <span style="color:#000">E</span><span style="color:#000">&gt;</span> <span style="color:#000">consumer</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#000">Objects</span>.<span style="color:#836c28">requireNonNull</span>(<span style="color:#000">consumer</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">final</span> <span style="color:#a90d91">int</span> <span style="color:#000">size</span> <span style="color:#000">=</span> <span style="color:#000">ArrayList</span>.<span style="color:#836c28">this</span>.<span style="color:#836c28">size</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// 记录下当前游标位置</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">int</span> <span style="color:#000">i</span> <span style="color:#000">=</span> <span style="color:#000">cursor</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// 如果当前游标位置大于等于列表元素个数，说明已无未遍历到的元素了，直接返回即可</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">if</span> (<span style="color:#000">i</span> <span style="color:#000">&gt;=</span> <span style="color:#000">size</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#a90d91">return</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">final</span> <span style="color:#000">Object</span><span style="color:#000">[]</span> <span style="color:#000">elementData</span> <span style="color:#000">=</span> <span style="color:#000">ArrayList</span>.<span style="color:#836c28">this</span>.<span style="color:#836c28">elementData</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">if</span> (<span style="color:#000">i</span> <span style="color:#000">&gt;=</span> <span style="color:#000">elementData</span>.<span style="color:#836c28">length</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#a90d91">throw</span> <span style="color:#a90d91">new</span> <span style="color:#000">ConcurrentModificationException</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// 从当前游标位置一直到列表末尾，对每个元素执行给定的操作</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">while</span> (<span style="color:#000">i</span> <span style="color:#000">!=</span> <span style="color:#000">size</span> <span style="color:#000">&amp;&amp;</span> <span style="color:#000">modCount</span> <span style="color:#000">==</span> <span style="color:#000">expectedModCount</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#000">consumer</span>.<span style="color:#836c28">accept</span>((<span style="color:#000">E</span>) <span style="color:#000">elementData</span><span style="color:#000">[</span><span style="color:#000">i</span><span style="color:#000">++]</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// update once at end of iteration to reduce heap write traffic</span>
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// 在迭代结束时更新一次游标和lastRet，以减少堆写入流量</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">cursor</span> <span style="color:#000">=</span> <span style="color:#000">i</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#000">lastRet</span> <span style="color:#000">=</span> <span style="color:#000">i</span> <span style="color:#000">-</span> <span style="color:#000">1</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#000">checkForComodification</span>();
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><div class="flex align-center gdoc-page__anchorwrap">
    <h2 id="499-final-void-checkforcomodification"
    >
        49.9 final void checkForComodification()
    </h2>
    <a data-clipboard-text="https://hongmao.run/jdk8-src-note/java/util/ArrayList/#499-final-void-checkforcomodification" class="gdoc-page__anchor clip flex align-center" title="锚定到： 49.9 final void checkForComodification()" aria-label="锚定到： 49.9 final void checkForComodification()" href="#499-final-void-checkforcomodification">
        <svg class="gdoc-icon gdoc_link"><use xlink:href="#gdoc_link"></use></svg>
    </a>
</div>
<p>判断是否存在并发修改操作，若存在则抛出并发修改异常。</p>
<p>源码如下：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#a90d91">final</span> <span style="color:#a90d91">void</span> <span style="color:#000">checkForComodification</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// 修改次数与期望修改次数不等，说明存在并发修改异常</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">if</span> (<span style="color:#000">modCount</span> <span style="color:#000">!=</span> <span style="color:#000">expectedModCount</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#a90d91">throw</span> <span style="color:#a90d91">new</span> <span style="color:#000">ConcurrentModificationException</span>();
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><hr>
<div class="flex align-center gdoc-page__anchorwrap">
    <h1 id="50-private-class-listitr-extends-itr-implements-listiteratorlte"
    >
        50. private class ListItr extends Itr implements ListIterator&lt;E&gt;
    </h1>
    <a data-clipboard-text="https://hongmao.run/jdk8-src-note/java/util/ArrayList/#50-private-class-listitr-extends-itr-implements-listiteratorlte" class="gdoc-page__anchor clip flex align-center" title="锚定到： 50. private class ListItr extends Itr implements ListIterator&lt;E&gt;" aria-label="锚定到： 50. private class ListItr extends Itr implements ListIterator&lt;E&gt;" href="#50-private-class-listitr-extends-itr-implements-listiteratorlte">
        <svg class="gdoc-icon gdoc_link"><use xlink:href="#gdoc_link"></use></svg>
    </a>
</div>
<p>优化版本的<code>AbstractList.ListItr</code>，继承了<code>Itr</code>类并实现了<code>ListIterator</code>接口。</p>
<div class="flex align-center gdoc-page__anchorwrap">
    <h2 id="501-listitrint-index"
    >
        50.1 ListItr(int index)
    </h2>
    <a data-clipboard-text="https://hongmao.run/jdk8-src-note/java/util/ArrayList/#501-listitrint-index" class="gdoc-page__anchor clip flex align-center" title="锚定到： 50.1 ListItr(int index)" aria-label="锚定到： 50.1 ListItr(int index)" href="#501-listitrint-index">
        <svg class="gdoc-icon gdoc_link"><use xlink:href="#gdoc_link"></use></svg>
    </a>
</div>
<p>列表迭代器的构造方法，源码如下：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#000">ListItr</span>(<span style="color:#a90d91">int</span> <span style="color:#000">index</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">super</span>();
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// 设置游标位置为指定索引</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">cursor</span> <span style="color:#000">=</span> <span style="color:#000">index</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><div class="flex align-center gdoc-page__anchorwrap">
    <h2 id="502-public-boolean-hasprevious"
    >
        50.2 public boolean hasPrevious()
    </h2>
    <a data-clipboard-text="https://hongmao.run/jdk8-src-note/java/util/ArrayList/#502-public-boolean-hasprevious" class="gdoc-page__anchor clip flex align-center" title="锚定到： 50.2 public boolean hasPrevious()" aria-label="锚定到： 50.2 public boolean hasPrevious()" href="#502-public-boolean-hasprevious">
        <svg class="gdoc-icon gdoc_link"><use xlink:href="#gdoc_link"></use></svg>
    </a>
</div>
<p>判断当前迭代器是否还有上一个元素，判断依据是当前游标<code>cursor</code>是否不等于0，不等于0，说明还有上一个元素，为0说明已到列表的开始位置，没有上一个元素了。</p>
<p>源码如下：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#a90d91">public</span> <span style="color:#a90d91">boolean</span> <span style="color:#000">hasPrevious</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">return</span> <span style="color:#000">cursor</span> <span style="color:#000">!=</span> <span style="color:#000">0</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><div class="flex align-center gdoc-page__anchorwrap">
    <h2 id="503-public-int-nextindex"
    >
        50.3 public int nextIndex()
    </h2>
    <a data-clipboard-text="https://hongmao.run/jdk8-src-note/java/util/ArrayList/#503-public-int-nextindex" class="gdoc-page__anchor clip flex align-center" title="锚定到： 50.3 public int nextIndex()" aria-label="锚定到： 50.3 public int nextIndex()" href="#503-public-int-nextindex">
        <svg class="gdoc-icon gdoc_link"><use xlink:href="#gdoc_link"></use></svg>
    </a>
</div>
<p>返回下一个元素的索引，其实就是返回当前游标<code>cursor</code>。</p>
<p>源码如下：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#a90d91">public</span> <span style="color:#a90d91">int</span> <span style="color:#000">nextIndex</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">return</span> <span style="color:#000">cursor</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><div class="flex align-center gdoc-page__anchorwrap">
    <h2 id="504-public-int-previousindex"
    >
        50.4 public int previousIndex()
    </h2>
    <a data-clipboard-text="https://hongmao.run/jdk8-src-note/java/util/ArrayList/#504-public-int-previousindex" class="gdoc-page__anchor clip flex align-center" title="锚定到： 50.4 public int previousIndex()" aria-label="锚定到： 50.4 public int previousIndex()" href="#504-public-int-previousindex">
        <svg class="gdoc-icon gdoc_link"><use xlink:href="#gdoc_link"></use></svg>
    </a>
</div>
<p>返回上一个元素的索引，其实就是返回当前游标<code>cursor - 1</code>。</p>
<p>源码如下：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#a90d91">public</span> <span style="color:#a90d91">int</span> <span style="color:#000">previousIndex</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">return</span> <span style="color:#000">cursor</span> <span style="color:#000">-</span> <span style="color:#000">1</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><div class="flex align-center gdoc-page__anchorwrap">
    <h2 id="505-public-e-previous"
    >
        50.5 public E previous()
    </h2>
    <a data-clipboard-text="https://hongmao.run/jdk8-src-note/java/util/ArrayList/#505-public-e-previous" class="gdoc-page__anchor clip flex align-center" title="锚定到： 50.5 public E previous()" aria-label="锚定到： 50.5 public E previous()" href="#505-public-e-previous">
        <svg class="gdoc-icon gdoc_link"><use xlink:href="#gdoc_link"></use></svg>
    </a>
</div>
<p>返回上一个元素（非上一个返回的元素）。</p>
<p>源码如下：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#000">@SuppressWarnings</span>(<span style="color:#c41a16">&#34;unchecked&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#a90d91">public</span> <span style="color:#000">E</span> <span style="color:#000">previous</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// 进行并发修改检查</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">checkForComodification</span>();
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// 取出上一个元素的索引位置</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">int</span> <span style="color:#000">i</span> <span style="color:#000">=</span> <span style="color:#000">cursor</span> <span style="color:#000">-</span> <span style="color:#000">1</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// 对得到的索引位置进行范围检查</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">if</span> (<span style="color:#000">i</span> <span style="color:#000">&lt;</span> <span style="color:#000">0</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#a90d91">throw</span> <span style="color:#a90d91">new</span> <span style="color:#000">NoSuchElementException</span>();
</span></span><span style="display:flex;"><span>    <span style="color:#000">Object</span><span style="color:#000">[]</span> <span style="color:#000">elementData</span> <span style="color:#000">=</span> <span style="color:#000">ArrayList</span>.<span style="color:#836c28">this</span>.<span style="color:#836c28">elementData</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">if</span> (<span style="color:#000">i</span> <span style="color:#000">&gt;=</span> <span style="color:#000">elementData</span>.<span style="color:#836c28">length</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#a90d91">throw</span> <span style="color:#a90d91">new</span> <span style="color:#000">ConcurrentModificationException</span>();
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// 将当前游标左移一位</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">cursor</span> <span style="color:#000">=</span> <span style="color:#000">i</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// 将最后返回的索引置为之前算出的索引，然后返回该索引位置的元素</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">return</span> (<span style="color:#000">E</span>) <span style="color:#000">elementData</span><span style="color:#000">[</span><span style="color:#000">lastRet</span> <span style="color:#000">=</span> <span style="color:#000">i</span><span style="color:#000">]</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><div class="flex align-center gdoc-page__anchorwrap">
    <h2 id="506-public-void-sete-e"
    >
        50.6 public void set(E e)
    </h2>
    <a data-clipboard-text="https://hongmao.run/jdk8-src-note/java/util/ArrayList/#506-public-void-sete-e" class="gdoc-page__anchor clip flex align-center" title="锚定到： 50.6 public void set(E e)" aria-label="锚定到： 50.6 public void set(E e)" href="#506-public-void-sete-e">
        <svg class="gdoc-icon gdoc_link"><use xlink:href="#gdoc_link"></use></svg>
    </a>
</div>
<p>将迭代器最后返回的元素替换为指定的元素<code>e</code>。</p>
<p>源码如下：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#a90d91">public</span> <span style="color:#a90d91">void</span> <span style="color:#000">set</span>(<span style="color:#000">E</span> <span style="color:#000">e</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// lastRet小于0说明没有最近返回的元素或者最近返回的元素已被删除</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">if</span> (<span style="color:#000">lastRet</span> <span style="color:#000">&lt;</span> <span style="color:#000">0</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#a90d91">throw</span> <span style="color:#a90d91">new</span> <span style="color:#000">IllegalStateException</span>();
</span></span><span style="display:flex;"><span>    <span style="color:#000">checkForComodification</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">try</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#000">ArrayList</span>.<span style="color:#836c28">this</span>.<span style="color:#836c28">set</span>(<span style="color:#000">lastRet</span>, <span style="color:#000">e</span>);
</span></span><span style="display:flex;"><span>    } <span style="color:#a90d91">catch</span> (<span style="color:#000">IndexOutOfBoundsException</span> <span style="color:#000">ex</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#a90d91">throw</span> <span style="color:#a90d91">new</span> <span style="color:#000">ConcurrentModificationException</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><div class="flex align-center gdoc-page__anchorwrap">
    <h2 id="507-public-void-adde-e"
    >
        50.7 public void add(E e)
    </h2>
    <a data-clipboard-text="https://hongmao.run/jdk8-src-note/java/util/ArrayList/#507-public-void-adde-e" class="gdoc-page__anchor clip flex align-center" title="锚定到： 50.7 public void add(E e)" aria-label="锚定到： 50.7 public void add(E e)" href="#507-public-void-adde-e">
        <svg class="gdoc-icon gdoc_link"><use xlink:href="#gdoc_link"></use></svg>
    </a>
</div>
<p>在当前游标位置插入指定的元素<code>e</code>。</p>
<p>源码如下：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#a90d91">public</span> <span style="color:#a90d91">void</span> <span style="color:#000">add</span>(<span style="color:#000">E</span> <span style="color:#000">e</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#000">checkForComodification</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">try</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a90d91">int</span> <span style="color:#000">i</span> <span style="color:#000">=</span> <span style="color:#000">cursor</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#177500">// 在游标位置插入元素e</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">ArrayList</span>.<span style="color:#836c28">this</span>.<span style="color:#836c28">add</span>(<span style="color:#000">i</span>, <span style="color:#000">e</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#177500">// 游标右移一位</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">cursor</span> <span style="color:#000">=</span> <span style="color:#000">i</span> <span style="color:#000">+</span> <span style="color:#000">1</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#177500">// 最近返回的索引置为-1，这个需要特别注意，此处并非置为新插入元素的索引位置</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">lastRet</span> <span style="color:#000">=</span> <span style="color:#000">-</span><span style="color:#000">1</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#000">expectedModCount</span> <span style="color:#000">=</span> <span style="color:#000">modCount</span>;
</span></span><span style="display:flex;"><span>    } <span style="color:#a90d91">catch</span> (<span style="color:#000">IndexOutOfBoundsException</span> <span style="color:#000">ex</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#a90d91">throw</span> <span style="color:#a90d91">new</span> <span style="color:#000">ConcurrentModificationException</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><hr>
<div class="flex align-center gdoc-page__anchorwrap">
    <h1 id="51-public-listlte-sublistint-fromindex-int-toindex"
    >
        51. public List&lt;E&gt; subList(int fromIndex, int toIndex)
    </h1>
    <a data-clipboard-text="https://hongmao.run/jdk8-src-note/java/util/ArrayList/#51-public-listlte-sublistint-fromindex-int-toindex" class="gdoc-page__anchor clip flex align-center" title="锚定到： 51. public List&lt;E&gt; subList(int fromIndex, int toIndex)" aria-label="锚定到： 51. public List&lt;E&gt; subList(int fromIndex, int toIndex)" href="#51-public-listlte-sublistint-fromindex-int-toindex">
        <svg class="gdoc-icon gdoc_link"><use xlink:href="#gdoc_link"></use></svg>
    </a>
</div>
<p>返回当前列表在指定的<code>fromIndex</code>（包含）和<code>toIndex</code>（不包含）之间部分的视图。（如果<code>fromIndex</code>和<code>toIndex</code>相等，则返回的列表为空）返回的列表基于本列表，因此返回列表中的非结构性更改将反映会影响本列表，反之亦然。返回的列表支持列表的所有可选操作。 这种方法消除了显式范围操作（数组中常见的那种操作）的需要。任何期望获得列表的操作都可以用范围操作来代替，通过传递子列表视图而不是整个列表来实现。例如，下面的习惯用法从列表中删除一个元素范围：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#000">list</span>.<span style="color:#836c28">subList</span>(<span style="color:#000">from</span>, <span style="color:#000">to</span>).<span style="color:#836c28">clear</span>();
</span></span></code></pre></div><p><code>indexOf(Object)</code>和<code>lastIndexOf(Object)</code>可以构造类似的习惯用法，并且<code>Collections</code>类中的所有算法都可以应用于子列表。 如果后备列表（即此列表）以除通过返回列表以外的任何其他方式进行结构化修改，则此方法返回的列表的操作将变得不确定。 （结构修改是指更改此列表的大小的结构修改，或以其他方式扰乱此列表的方式，使得正在进行的迭代可能会产生错误的结果。）</p>
<p>源码如下：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#a90d91">public</span> <span style="color:#000">List</span><span style="color:#000">&lt;</span><span style="color:#000">E</span><span style="color:#000">&gt;</span> <span style="color:#000">subList</span>(<span style="color:#a90d91">int</span> <span style="color:#000">fromIndex</span>, <span style="color:#a90d91">int</span> <span style="color:#000">toIndex</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#000">subListRangeCheck</span>(<span style="color:#000">fromIndex</span>, <span style="color:#000">toIndex</span>, <span style="color:#000">size</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">return</span> <span style="color:#a90d91">new</span> <span style="color:#000">SubList</span>(<span style="color:#a90d91">this</span>, <span style="color:#000">0</span>, <span style="color:#000">fromIndex</span>, <span style="color:#000">toIndex</span>);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>示例：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#000">@Test</span>
</span></span><span style="display:flex;"><span><span style="color:#a90d91">public</span> <span style="color:#a90d91">void</span> <span style="color:#000">testSubList</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#000">List</span><span style="color:#000">&lt;</span><span style="color:#000">Integer</span><span style="color:#000">&gt;</span> <span style="color:#000">list</span> <span style="color:#000">=</span> <span style="color:#a90d91">new</span> <span style="color:#000">ArrayList</span><span style="color:#000">&lt;&gt;</span>();
</span></span><span style="display:flex;"><span>    <span style="color:#000">list</span>.<span style="color:#836c28">add</span>(<span style="color:#000">1</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#000">list</span>.<span style="color:#836c28">add</span>(<span style="color:#000">2</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#000">list</span>.<span style="color:#836c28">add</span>(<span style="color:#000">3</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#000">list</span>.<span style="color:#836c28">add</span>(<span style="color:#000">4</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#000">list</span>.<span style="color:#836c28">add</span>(<span style="color:#000">5</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#000">List</span><span style="color:#000">&lt;</span><span style="color:#000">Integer</span><span style="color:#000">&gt;</span> <span style="color:#000">subList</span> <span style="color:#000">=</span> <span style="color:#000">list</span>.<span style="color:#836c28">subList</span>(<span style="color:#000">1</span>, <span style="color:#000">3</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#000">System</span>.<span style="color:#836c28">out</span>.<span style="color:#836c28">println</span>(<span style="color:#000">list</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#000">System</span>.<span style="color:#836c28">out</span>.<span style="color:#836c28">println</span>(<span style="color:#000">subList</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#000">System</span>.<span style="color:#836c28">out</span>.<span style="color:#836c28">println</span>(<span style="color:#000">subList</span>.<span style="color:#836c28">getClass</span>());
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>输出：</p>
<pre tabindex="0"><code>[1, 2, 3, 4, 5]
[2, 3]
class java.util.ArrayList$SubList
</code></pre><hr>
<div class="flex align-center gdoc-page__anchorwrap">
    <h1 id="52-static-void-sublistrangecheckint-fromindex-int-toindex-int-size"
    >
        52. static void subListRangeCheck(int fromIndex, int toIndex, int size)
    </h1>
    <a data-clipboard-text="https://hongmao.run/jdk8-src-note/java/util/ArrayList/#52-static-void-sublistrangecheckint-fromindex-int-toindex-int-size" class="gdoc-page__anchor clip flex align-center" title="锚定到： 52. static void subListRangeCheck(int fromIndex, int toIndex, int size)" aria-label="锚定到： 52. static void subListRangeCheck(int fromIndex, int toIndex, int size)" href="#52-static-void-sublistrangecheckint-fromindex-int-toindex-int-size">
        <svg class="gdoc-icon gdoc_link"><use xlink:href="#gdoc_link"></use></svg>
    </a>
</div>
<p>对子列表的范围进行检查。</p>
<p>源码如下：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#a90d91">static</span> <span style="color:#a90d91">void</span> <span style="color:#000">subListRangeCheck</span>(<span style="color:#a90d91">int</span> <span style="color:#000">fromIndex</span>, <span style="color:#a90d91">int</span> <span style="color:#000">toIndex</span>, <span style="color:#a90d91">int</span> <span style="color:#000">size</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">if</span> (<span style="color:#000">fromIndex</span> <span style="color:#000">&lt;</span> <span style="color:#000">0</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#a90d91">throw</span> <span style="color:#a90d91">new</span> <span style="color:#000">IndexOutOfBoundsException</span>(<span style="color:#c41a16">&#34;fromIndex = &#34;</span> <span style="color:#000">+</span> <span style="color:#000">fromIndex</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">if</span> (<span style="color:#000">toIndex</span> <span style="color:#000">&gt;</span> <span style="color:#000">size</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#a90d91">throw</span> <span style="color:#a90d91">new</span> <span style="color:#000">IndexOutOfBoundsException</span>(<span style="color:#c41a16">&#34;toIndex = &#34;</span> <span style="color:#000">+</span> <span style="color:#000">toIndex</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">if</span> (<span style="color:#000">fromIndex</span> <span style="color:#000">&gt;</span> <span style="color:#000">toIndex</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#a90d91">throw</span> <span style="color:#a90d91">new</span> <span style="color:#000">IllegalArgumentException</span>(<span style="color:#c41a16">&#34;fromIndex(&#34;</span> <span style="color:#000">+</span> <span style="color:#000">fromIndex</span> <span style="color:#000">+</span>
</span></span><span style="display:flex;"><span>                                           <span style="color:#c41a16">&#34;) &gt; toIndex(&#34;</span> <span style="color:#000">+</span> <span style="color:#000">toIndex</span> <span style="color:#000">+</span> <span style="color:#c41a16">&#34;)&#34;</span>);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><hr>
<div class="flex align-center gdoc-page__anchorwrap">
    <h1 id="53-private-class-sublist-extends-abstractlistlte-implements-randomaccess"
    >
        53. private class SubList extends AbstractList&lt;E&gt; implements RandomAccess
    </h1>
    <a data-clipboard-text="https://hongmao.run/jdk8-src-note/java/util/ArrayList/#53-private-class-sublist-extends-abstractlistlte-implements-randomaccess" class="gdoc-page__anchor clip flex align-center" title="锚定到： 53. private class SubList extends AbstractList&lt;E&gt; implements RandomAccess" aria-label="锚定到： 53. private class SubList extends AbstractList&lt;E&gt; implements RandomAccess" href="#53-private-class-sublist-extends-abstractlistlte-implements-randomaccess">
        <svg class="gdoc-icon gdoc_link"><use xlink:href="#gdoc_link"></use></svg>
    </a>
</div>

<div style='text-align: center'>
    <img src='https://img.hongmao.run/blog/2021/07/ArrayList-SubList.png' width='50%' alt=''>
</div>


<p>“子”列表类，更准确地说，其实它是当前<code>ArrayList</code>的一个视图。</p>
<p>它提供<code>AbstractList</code>可以提供的一切操作，但是它底层并非是像<code>ArrayList</code>一样通过<code>elementData</code>对象数组来存储数据，而是持有它父列表的引用，并且维护一个相对于其父列表的索引偏移量<code>parentOffset</code>，以及一个相对于其最顶层列表（非<code>SubList</code>类的实例，而是<code>ArrayList</code>类的实例）的偏移量<code>offset</code>。</p>
<p>假设子列表中的某元素在子列表中的索引为<code>subIndex</code>，则该元素在父列表中的索引为：<code>subIndex + parentOffset</code>，在其最顶层的ArrayList中的索引为：<code>subIndex + offset</code>。</p>
<div class="flex align-center gdoc-page__anchorwrap">
    <h2 id="531-private-final-abstractlistlte-parent"
    >
        53.1 private final AbstractList&lt;E&gt; parent;
    </h2>
    <a data-clipboard-text="https://hongmao.run/jdk8-src-note/java/util/ArrayList/#531-private-final-abstractlistlte-parent" class="gdoc-page__anchor clip flex align-center" title="锚定到： 53.1 private final AbstractList&lt;E&gt; parent;" aria-label="锚定到： 53.1 private final AbstractList&lt;E&gt; parent;" href="#531-private-final-abstractlistlte-parent">
        <svg class="gdoc-icon gdoc_link"><use xlink:href="#gdoc_link"></use></svg>
    </a>
</div>
<p>当前子列表的父列表。</p>
<div class="flex align-center gdoc-page__anchorwrap">
    <h2 id="532-private-final-int-parentoffset"
    >
        53.2 private final int parentOffset;
    </h2>
    <a data-clipboard-text="https://hongmao.run/jdk8-src-note/java/util/ArrayList/#532-private-final-int-parentoffset" class="gdoc-page__anchor clip flex align-center" title="锚定到： 53.2 private final int parentOffset;" aria-label="锚定到： 53.2 private final int parentOffset;" href="#532-private-final-int-parentoffset">
        <svg class="gdoc-icon gdoc_link"><use xlink:href="#gdoc_link"></use></svg>
    </a>
</div>
<p>当前子列表的父列表在其父列表中的偏移量。</p>
<div class="flex align-center gdoc-page__anchorwrap">
    <h2 id="533-private-final-int-offset"
    >
        53.3 private final int offset;
    </h2>
    <a data-clipboard-text="https://hongmao.run/jdk8-src-note/java/util/ArrayList/#533-private-final-int-offset" class="gdoc-page__anchor clip flex align-center" title="锚定到： 53.3 private final int offset;" aria-label="锚定到： 53.3 private final int offset;" href="#533-private-final-int-offset">
        <svg class="gdoc-icon gdoc_link"><use xlink:href="#gdoc_link"></use></svg>
    </a>
</div>
<p>当前子列表在其最顶层的<code>ArrayList</code>列表中的偏移量。</p>
<p>假设存在<code>ArrayList</code>的实例<code>A</code>：<code>[&quot;零&quot;, &quot;一&quot;, &quot;二&quot;, &quot;三&quot;, &quot;四&quot;, &quot;五&quot;]</code>，</p>
<p>存在<code>A</code>的子列表<code>SubList</code>的实例<code>S1</code>：<code>[&quot;二&quot;, &quot;三&quot;, &quot;四&quot;]</code>，”<code>二</code>“这个元素在该<code>S1</code>中的索引为<code>0</code>，在其父列表<code>A</code>中的索引为<code>2</code>，此时<code>S1</code>的<code>parentOffset</code>为<code>2</code>，同时<code>S1</code>的<code>offset</code>也为<code>2</code>。</p>
<p>再假设<code>S1</code>也存在子列表<code>SubList</code>的实例<code>S2</code>：<code>[&quot;三&quot;, &quot;四&quot;]</code>，”<code>四</code>“这个元素在<code>S2</code>中的索引为<code>1</code>，在其父列表<code>S1</code>中的索引为<code>2</code>，在其最顶层的<code>ArrayList</code>列表<code>A</code>中的索引为<code>4</code>，此时<code>S2</code>的<code>parentOffset</code>为<code>1</code>（<code>2 - 1</code>），<code>offset</code>为<code>3</code>（<code>4 - 1</code>）。</p>
<div class="flex align-center gdoc-page__anchorwrap">
    <h2 id="534-int-size"
    >
        53.4 int size;
    </h2>
    <a data-clipboard-text="https://hongmao.run/jdk8-src-note/java/util/ArrayList/#534-int-size" class="gdoc-page__anchor clip flex align-center" title="锚定到： 53.4 int size;" aria-label="锚定到： 53.4 int size;" href="#534-int-size">
        <svg class="gdoc-icon gdoc_link"><use xlink:href="#gdoc_link"></use></svg>
    </a>
</div>
<p>当前子列表的大小。</p>
<div class="flex align-center gdoc-page__anchorwrap">
    <h2 id="535-sublistabstractlistlte-parent-int-offset-int-fromindex-int-toindex"
    >
        53.5 SubList(AbstractList&lt;E&gt; parent, int offset, int fromIndex, int toIndex)
    </h2>
    <a data-clipboard-text="https://hongmao.run/jdk8-src-note/java/util/ArrayList/#535-sublistabstractlistlte-parent-int-offset-int-fromindex-int-toindex" class="gdoc-page__anchor clip flex align-center" title="锚定到： 53.5 SubList(AbstractList&lt;E&gt; parent, int offset, int fromIndex, int toIndex)" aria-label="锚定到： 53.5 SubList(AbstractList&lt;E&gt; parent, int offset, int fromIndex, int toIndex)" href="#535-sublistabstractlistlte-parent-int-offset-int-fromindex-int-toindex">
        <svg class="gdoc-icon gdoc_link"><use xlink:href="#gdoc_link"></use></svg>
    </a>
</div>
<p><code>SubList</code>类唯一的构造函数。</p>
<p>源码如下：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#000">SubList</span>(<span style="color:#000">AbstractList</span><span style="color:#000">&lt;</span><span style="color:#000">E</span><span style="color:#000">&gt;</span> <span style="color:#000">parent</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a90d91">int</span> <span style="color:#000">offset</span>, <span style="color:#a90d91">int</span> <span style="color:#000">fromIndex</span>, <span style="color:#a90d91">int</span> <span style="color:#000">toIndex</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// 执行各种初始化</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">this</span>.<span style="color:#836c28">parent</span> <span style="color:#000">=</span> <span style="color:#000">parent</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// 将fromIndex置为当前子列表相对于其父列表的偏移量</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">this</span>.<span style="color:#836c28">parentOffset</span> <span style="color:#000">=</span> <span style="color:#000">fromIndex</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// 将当前子列表相对于其最顶级列表的偏移量加上当前子列表相对于其父列表的偏移量</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">this</span>.<span style="color:#836c28">offset</span> <span style="color:#000">=</span> <span style="color:#000">offset</span> <span style="color:#000">+</span> <span style="color:#000">fromIndex</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">this</span>.<span style="color:#836c28">size</span> <span style="color:#000">=</span> <span style="color:#000">toIndex</span> <span style="color:#000">-</span> <span style="color:#000">fromIndex</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">this</span>.<span style="color:#836c28">modCount</span> <span style="color:#000">=</span> <span style="color:#000">ArrayList</span>.<span style="color:#836c28">this</span>.<span style="color:#836c28">modCount</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><div class="flex align-center gdoc-page__anchorwrap">
    <h2 id="536-public-e-setint-index-e-e"
    >
        53.6 public E set(int index, E e)
    </h2>
    <a data-clipboard-text="https://hongmao.run/jdk8-src-note/java/util/ArrayList/#536-public-e-setint-index-e-e" class="gdoc-page__anchor clip flex align-center" title="锚定到： 53.6 public E set(int index, E e)" aria-label="锚定到： 53.6 public E set(int index, E e)" href="#536-public-e-setint-index-e-e">
        <svg class="gdoc-icon gdoc_link"><use xlink:href="#gdoc_link"></use></svg>
    </a>
</div>
<p>设置当前子列表指定索引位置的元素为指定的元素<code>e</code>。</p>
<p>源码如下：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#a90d91">public</span> <span style="color:#000">E</span> <span style="color:#000">set</span>(<span style="color:#a90d91">int</span> <span style="color:#000">index</span>, <span style="color:#000">E</span> <span style="color:#000">e</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// 首先对指定索引index进行检查</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">rangeCheck</span>(<span style="color:#000">index</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// 检查是否存在并发修改</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">checkForComodification</span>();
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// 首先计算出当前子列表中的index位置转换为其父列表的index（即当前指定索引加上偏移量）</span>
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// 调用父类的elementData方法取出对应位置的元素</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">E</span> <span style="color:#000">oldValue</span> <span style="color:#000">=</span> <span style="color:#000">ArrayList</span>.<span style="color:#836c28">this</span>.<span style="color:#836c28">elementData</span>(<span style="color:#000">offset</span> <span style="color:#000">+</span> <span style="color:#000">index</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// 将父类对应位置的元素替换为指定的元素e</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">ArrayList</span>.<span style="color:#836c28">this</span>.<span style="color:#836c28">elementData</span><span style="color:#000">[</span><span style="color:#000">offset</span> <span style="color:#000">+</span> <span style="color:#000">index</span><span style="color:#000">]</span> <span style="color:#000">=</span> <span style="color:#000">e</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// 返回旧元素</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">return</span> <span style="color:#000">oldValue</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><div class="flex align-center gdoc-page__anchorwrap">
    <h2 id="537-public-e-getint-index"
    >
        53.7 public E get(int index)
    </h2>
    <a data-clipboard-text="https://hongmao.run/jdk8-src-note/java/util/ArrayList/#537-public-e-getint-index" class="gdoc-page__anchor clip flex align-center" title="锚定到： 53.7 public E get(int index)" aria-label="锚定到： 53.7 public E get(int index)" href="#537-public-e-getint-index">
        <svg class="gdoc-icon gdoc_link"><use xlink:href="#gdoc_link"></use></svg>
    </a>
</div>
<p>获取指定索引位置的元素。</p>
<p>源码如下：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#a90d91">public</span> <span style="color:#000">E</span> <span style="color:#000">get</span>(<span style="color:#a90d91">int</span> <span style="color:#000">index</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// 首先进行范围检查</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">rangeCheck</span>(<span style="color:#000">index</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// 进行并发修改检查</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">checkForComodification</span>();
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// 通过指定索引index和偏移量计算出目标元素在父列表中的位置，然后从父列表中将其取出并返回</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">return</span> <span style="color:#000">ArrayList</span>.<span style="color:#836c28">this</span>.<span style="color:#836c28">elementData</span>(<span style="color:#000">offset</span> <span style="color:#000">+</span> <span style="color:#000">index</span>);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><div class="flex align-center gdoc-page__anchorwrap">
    <h2 id="538-public-int-size"
    >
        53.8 public int size()
    </h2>
    <a data-clipboard-text="https://hongmao.run/jdk8-src-note/java/util/ArrayList/#538-public-int-size" class="gdoc-page__anchor clip flex align-center" title="锚定到： 53.8 public int size()" aria-label="锚定到： 53.8 public int size()" href="#538-public-int-size">
        <svg class="gdoc-icon gdoc_link"><use xlink:href="#gdoc_link"></use></svg>
    </a>
</div>
<p>获取当前子列表的大小。</p>
<p>源码如下：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#a90d91">public</span> <span style="color:#a90d91">int</span> <span style="color:#000">size</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// 并发修改检查</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">checkForComodification</span>();
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// 返回当前子列表大小</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">return</span> <span style="color:#a90d91">this</span>.<span style="color:#836c28">size</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><div class="flex align-center gdoc-page__anchorwrap">
    <h2 id="539-public-void-addint-index-e-e"
    >
        53.9 public void add(int index, E e)
    </h2>
    <a data-clipboard-text="https://hongmao.run/jdk8-src-note/java/util/ArrayList/#539-public-void-addint-index-e-e" class="gdoc-page__anchor clip flex align-center" title="锚定到： 53.9 public void add(int index, E e)" aria-label="锚定到： 53.9 public void add(int index, E e)" href="#539-public-void-addint-index-e-e">
        <svg class="gdoc-icon gdoc_link"><use xlink:href="#gdoc_link"></use></svg>
    </a>
</div>
<p>向指定索引位置插入指定元素。</p>
<p>源码如下：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#a90d91">public</span> <span style="color:#a90d91">void</span> <span style="color:#000">add</span>(<span style="color:#a90d91">int</span> <span style="color:#000">index</span>, <span style="color:#000">E</span> <span style="color:#000">e</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// 校验指定索引是否满足新增的要求</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">rangeCheckForAdd</span>(<span style="color:#000">index</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// 并发修改校验</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">checkForComodification</span>();
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// 此处是调用的父类的add方法，而非最顶层的ArrayList的add方法</span>
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// 所以计算索引时，要使用parentOffset，而非offset</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">parent</span>.<span style="color:#836c28">add</span>(<span style="color:#000">parentOffset</span> <span style="color:#000">+</span> <span style="color:#000">index</span>, <span style="color:#000">e</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">this</span>.<span style="color:#836c28">modCount</span> <span style="color:#000">=</span> <span style="color:#000">parent</span>.<span style="color:#836c28">modCount</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// 列表大小加1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">this</span>.<span style="color:#836c28">size</span><span style="color:#000">++</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><div class="flex align-center gdoc-page__anchorwrap">
    <h2 id="5310-public-e-removeint-index"
    >
        53.10 public E remove(int index)
    </h2>
    <a data-clipboard-text="https://hongmao.run/jdk8-src-note/java/util/ArrayList/#5310-public-e-removeint-index" class="gdoc-page__anchor clip flex align-center" title="锚定到： 53.10 public E remove(int index)" aria-label="锚定到： 53.10 public E remove(int index)" href="#5310-public-e-removeint-index">
        <svg class="gdoc-icon gdoc_link"><use xlink:href="#gdoc_link"></use></svg>
    </a>
</div>
<p>删除指定索引位置的元素，并将该元素返回。</p>
<p>源码如下：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#a90d91">public</span> <span style="color:#000">E</span> <span style="color:#000">remove</span>(<span style="color:#a90d91">int</span> <span style="color:#000">index</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#000">rangeCheck</span>(<span style="color:#000">index</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#000">checkForComodification</span>();
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// 与add一样，删除也是调用父类的方法，所以计算索引时要使用parentOffset</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">E</span> <span style="color:#000">result</span> <span style="color:#000">=</span> <span style="color:#000">parent</span>.<span style="color:#836c28">remove</span>(<span style="color:#000">parentOffset</span> <span style="color:#000">+</span> <span style="color:#000">index</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">this</span>.<span style="color:#836c28">modCount</span> <span style="color:#000">=</span> <span style="color:#000">parent</span>.<span style="color:#836c28">modCount</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">this</span>.<span style="color:#836c28">size</span><span style="color:#000">--</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">return</span> <span style="color:#000">result</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><div class="flex align-center gdoc-page__anchorwrap">
    <h2 id="5311-protected-void-removerangeint-fromindex-int-toindex"
    >
        53.11 protected void removeRange(int fromIndex, int toIndex)
    </h2>
    <a data-clipboard-text="https://hongmao.run/jdk8-src-note/java/util/ArrayList/#5311-protected-void-removerangeint-fromindex-int-toindex" class="gdoc-page__anchor clip flex align-center" title="锚定到： 53.11 protected void removeRange(int fromIndex, int toIndex)" aria-label="锚定到： 53.11 protected void removeRange(int fromIndex, int toIndex)" href="#5311-protected-void-removerangeint-fromindex-int-toindex">
        <svg class="gdoc-icon gdoc_link"><use xlink:href="#gdoc_link"></use></svg>
    </a>
</div>
<p>删除索引在指定返回范围<code>fromIndex</code>（包含）和<code>toIndex</code>（不包含）之间的元素。</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#a90d91">protected</span> <span style="color:#a90d91">void</span> <span style="color:#000">removeRange</span>(<span style="color:#a90d91">int</span> <span style="color:#000">fromIndex</span>, <span style="color:#a90d91">int</span> <span style="color:#000">toIndex</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#000">checkForComodification</span>();
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// 也是调用父类的范围删除方法来执行删除，所以使用parentOffset计算索引</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">parent</span>.<span style="color:#836c28">removeRange</span>(<span style="color:#000">parentOffset</span> <span style="color:#000">+</span> <span style="color:#000">fromIndex</span>,
</span></span><span style="display:flex;"><span>                       <span style="color:#000">parentOffset</span> <span style="color:#000">+</span> <span style="color:#000">toIndex</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">this</span>.<span style="color:#836c28">modCount</span> <span style="color:#000">=</span> <span style="color:#000">parent</span>.<span style="color:#836c28">modCount</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">this</span>.<span style="color:#836c28">size</span> <span style="color:#000">-=</span> <span style="color:#000">toIndex</span> <span style="color:#000">-</span> <span style="color:#000">fromIndex</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><div class="flex align-center gdoc-page__anchorwrap">
    <h2 id="5312-public-boolean-addallcollection-extends-e-c"
    >
        53.12 public boolean addAll(Collection&lt;? extends E&gt; c)
    </h2>
    <a data-clipboard-text="https://hongmao.run/jdk8-src-note/java/util/ArrayList/#5312-public-boolean-addallcollection-extends-e-c" class="gdoc-page__anchor clip flex align-center" title="锚定到： 53.12 public boolean addAll(Collection&lt;? extends E&gt; c)" aria-label="锚定到： 53.12 public boolean addAll(Collection&lt;? extends E&gt; c)" href="#5312-public-boolean-addallcollection-extends-e-c">
        <svg class="gdoc-icon gdoc_link"><use xlink:href="#gdoc_link"></use></svg>
    </a>
</div>
<p>将指定集合内的元素添加到当前子列表的末尾。</p>
<p>源码如下：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#a90d91">public</span> <span style="color:#a90d91">boolean</span> <span style="color:#000">addAll</span>(<span style="color:#000">Collection</span><span style="color:#000">&lt;?</span> <span style="color:#a90d91">extends</span> <span style="color:#000">E</span><span style="color:#000">&gt;</span> <span style="color:#000">c</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// 调用addAll方法，指定插入位置的索引为当前列表的size大小处，也即紧接着列表的末尾后面</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">return</span> <span style="color:#000">addAll</span>(<span style="color:#a90d91">this</span>.<span style="color:#836c28">size</span>, <span style="color:#000">c</span>);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><div class="flex align-center gdoc-page__anchorwrap">
    <h2 id="5313-public-boolean-addallint-index-collection-extends-e-c"
    >
        53.13 public boolean addAll(int index, Collection&lt;? extends E&gt; c)
    </h2>
    <a data-clipboard-text="https://hongmao.run/jdk8-src-note/java/util/ArrayList/#5313-public-boolean-addallint-index-collection-extends-e-c" class="gdoc-page__anchor clip flex align-center" title="锚定到： 53.13 public boolean addAll(int index, Collection&lt;? extends E&gt; c)" aria-label="锚定到： 53.13 public boolean addAll(int index, Collection&lt;? extends E&gt; c)" href="#5313-public-boolean-addallint-index-collection-extends-e-c">
        <svg class="gdoc-icon gdoc_link"><use xlink:href="#gdoc_link"></use></svg>
    </a>
</div>
<p>将指定集合内的元素添加到当前子列表的指定索引处。</p>
<p>源码如下：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#a90d91">public</span> <span style="color:#a90d91">boolean</span> <span style="color:#000">addAll</span>(<span style="color:#a90d91">int</span> <span style="color:#000">index</span>, <span style="color:#000">Collection</span><span style="color:#000">&lt;?</span> <span style="color:#a90d91">extends</span> <span style="color:#000">E</span><span style="color:#000">&gt;</span> <span style="color:#000">c</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#000">rangeCheckForAdd</span>(<span style="color:#000">index</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">int</span> <span style="color:#000">cSize</span> <span style="color:#000">=</span> <span style="color:#000">c</span>.<span style="color:#836c28">size</span>();
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// 指定的列表没有元素，直接返回false</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">if</span> (<span style="color:#000">cSize</span><span style="color:#000">==</span><span style="color:#000">0</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#a90d91">return</span> <span style="color:#a90d91">false</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">checkForComodification</span>();
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// 调用父类的插入方法</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">parent</span>.<span style="color:#836c28">addAll</span>(<span style="color:#000">parentOffset</span> <span style="color:#000">+</span> <span style="color:#000">index</span>, <span style="color:#000">c</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">this</span>.<span style="color:#836c28">modCount</span> <span style="color:#000">=</span> <span style="color:#000">parent</span>.<span style="color:#836c28">modCount</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">this</span>.<span style="color:#836c28">size</span> <span style="color:#000">+=</span> <span style="color:#000">cSize</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">return</span> <span style="color:#a90d91">true</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><div class="flex align-center gdoc-page__anchorwrap">
    <h2 id="5314-public-iteratorlte-iterator"
    >
        53.14 public Iterator&lt;E&gt; iterator()
    </h2>
    <a data-clipboard-text="https://hongmao.run/jdk8-src-note/java/util/ArrayList/#5314-public-iteratorlte-iterator" class="gdoc-page__anchor clip flex align-center" title="锚定到： 53.14 public Iterator&lt;E&gt; iterator()" aria-label="锚定到： 53.14 public Iterator&lt;E&gt; iterator()" href="#5314-public-iteratorlte-iterator">
        <svg class="gdoc-icon gdoc_link"><use xlink:href="#gdoc_link"></use></svg>
    </a>
</div>
<p>获取迭代器。</p>
<p>源码如下：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#a90d91">public</span> <span style="color:#000">Iterator</span><span style="color:#000">&lt;</span><span style="color:#000">E</span><span style="color:#000">&gt;</span> <span style="color:#000">iterator</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// 调用AbstractList中的listIterator()方法获取迭代器</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">return</span> <span style="color:#000">listIterator</span>();
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><div class="flex align-center gdoc-page__anchorwrap">
    <h2 id="5315-public-listiteratorlte-listiteratorfinal-int-index"
    >
        53.15 public ListIterator&lt;E&gt; listIterator(final int index)
    </h2>
    <a data-clipboard-text="https://hongmao.run/jdk8-src-note/java/util/ArrayList/#5315-public-listiteratorlte-listiteratorfinal-int-index" class="gdoc-page__anchor clip flex align-center" title="锚定到： 53.15 public ListIterator&lt;E&gt; listIterator(final int index)" aria-label="锚定到： 53.15 public ListIterator&lt;E&gt; listIterator(final int index)" href="#5315-public-listiteratorlte-listiteratorfinal-int-index">
        <svg class="gdoc-icon gdoc_link"><use xlink:href="#gdoc_link"></use></svg>
    </a>
</div>
<p>获取从指定位置开始的迭代器。</p>
<p>源码如下：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#a90d91">public</span> <span style="color:#000">ListIterator</span><span style="color:#000">&lt;</span><span style="color:#000">E</span><span style="color:#000">&gt;</span> <span style="color:#000">listIterator</span>(<span style="color:#a90d91">final</span> <span style="color:#a90d91">int</span> <span style="color:#000">index</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#000">checkForComodification</span>();
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// 此处借用了插入元素时的索引校验方法，即允许指定的索引为列表的size</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">rangeCheckForAdd</span>(<span style="color:#000">index</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">final</span> <span style="color:#a90d91">int</span> <span style="color:#000">offset</span> <span style="color:#000">=</span> <span style="color:#a90d91">this</span>.<span style="color:#836c28">offset</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// 此处返回一个ListIterator接口的匿名内部类的实例</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">return</span> <span style="color:#a90d91">new</span> <span style="color:#000">ListIterator</span><span style="color:#000">&lt;</span><span style="color:#000">E</span><span style="color:#000">&gt;</span>() {
</span></span><span style="display:flex;"><span>        <span style="color:#177500">// 游标等于指定索引</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a90d91">int</span> <span style="color:#000">cursor</span> <span style="color:#000">=</span> <span style="color:#000">index</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#a90d91">int</span> <span style="color:#000">lastRet</span> <span style="color:#000">=</span> <span style="color:#000">-</span><span style="color:#000">1</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#a90d91">int</span> <span style="color:#000">expectedModCount</span> <span style="color:#000">=</span> <span style="color:#000">ArrayList</span>.<span style="color:#836c28">this</span>.<span style="color:#836c28">modCount</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#177500">// 判断是否还有下一个元素</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a90d91">public</span> <span style="color:#a90d91">boolean</span> <span style="color:#000">hasNext</span>() {
</span></span><span style="display:flex;"><span>            <span style="color:#177500">// 判断当前游标是否等于当前子列表的大小</span>
</span></span><span style="display:flex;"><span>            <span style="color:#a90d91">return</span> <span style="color:#000">cursor</span> <span style="color:#000">!=</span> <span style="color:#000">SubList</span>.<span style="color:#836c28">this</span>.<span style="color:#836c28">size</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#177500">// 获取下一个元素</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">@SuppressWarnings</span>(<span style="color:#c41a16">&#34;unchecked&#34;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#a90d91">public</span> <span style="color:#000">E</span> <span style="color:#000">next</span>() {
</span></span><span style="display:flex;"><span>            <span style="color:#000">checkForComodification</span>();
</span></span><span style="display:flex;"><span>            <span style="color:#a90d91">int</span> <span style="color:#000">i</span> <span style="color:#000">=</span> <span style="color:#000">cursor</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#a90d91">if</span> (<span style="color:#000">i</span> <span style="color:#000">&gt;=</span> <span style="color:#000">SubList</span>.<span style="color:#836c28">this</span>.<span style="color:#836c28">size</span>)
</span></span><span style="display:flex;"><span>                <span style="color:#a90d91">throw</span> <span style="color:#a90d91">new</span> <span style="color:#000">NoSuchElementException</span>();
</span></span><span style="display:flex;"><span>            <span style="color:#000">Object</span><span style="color:#000">[]</span> <span style="color:#000">elementData</span> <span style="color:#000">=</span> <span style="color:#000">ArrayList</span>.<span style="color:#836c28">this</span>.<span style="color:#836c28">elementData</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#177500">// 计算元素在顶层的ArrayList列表内的索引，若大于等于数组长度，则报错</span>
</span></span><span style="display:flex;"><span>            <span style="color:#a90d91">if</span> (<span style="color:#000">offset</span> <span style="color:#000">+</span> <span style="color:#000">i</span> <span style="color:#000">&gt;=</span> <span style="color:#000">elementData</span>.<span style="color:#836c28">length</span>)
</span></span><span style="display:flex;"><span>                <span style="color:#a90d91">throw</span> <span style="color:#a90d91">new</span> <span style="color:#000">ConcurrentModificationException</span>();
</span></span><span style="display:flex;"><span>            <span style="color:#177500">// 游标右移一位</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">cursor</span> <span style="color:#000">=</span> <span style="color:#000">i</span> <span style="color:#000">+</span> <span style="color:#000">1</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#177500">// 将原游标位置赋值给最近返回的元素索引</span>
</span></span><span style="display:flex;"><span>            <span style="color:#177500">// 计算出要取出的元素在其顶层的ArrayList中的索引位置</span>
</span></span><span style="display:flex;"><span>            <span style="color:#177500">// 通过顶层列表的对象数组elementData获取对应索引位置的元素</span>
</span></span><span style="display:flex;"><span>            <span style="color:#a90d91">return</span> (<span style="color:#000">E</span>) <span style="color:#000">elementData</span><span style="color:#000">[</span><span style="color:#000">offset</span> <span style="color:#000">+</span> (<span style="color:#000">lastRet</span> <span style="color:#000">=</span> <span style="color:#000">i</span>)<span style="color:#000">]</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#177500">// 判断前面是否还有元素</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a90d91">public</span> <span style="color:#a90d91">boolean</span> <span style="color:#000">hasPrevious</span>() {
</span></span><span style="display:flex;"><span>            <span style="color:#177500">// 判断当前游标是否为0</span>
</span></span><span style="display:flex;"><span>            <span style="color:#a90d91">return</span> <span style="color:#000">cursor</span> <span style="color:#000">!=</span> <span style="color:#000">0</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#177500">// 获取前面一个元素</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">@SuppressWarnings</span>(<span style="color:#c41a16">&#34;unchecked&#34;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#a90d91">public</span> <span style="color:#000">E</span> <span style="color:#000">previous</span>() {
</span></span><span style="display:flex;"><span>            <span style="color:#000">checkForComodification</span>();
</span></span><span style="display:flex;"><span>            <span style="color:#177500">// 计算出前一个元素在当前子列表中的索引位置</span>
</span></span><span style="display:flex;"><span>            <span style="color:#a90d91">int</span> <span style="color:#000">i</span> <span style="color:#000">=</span> <span style="color:#000">cursor</span> <span style="color:#000">-</span> <span style="color:#000">1</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#a90d91">if</span> (<span style="color:#000">i</span> <span style="color:#000">&lt;</span> <span style="color:#000">0</span>)
</span></span><span style="display:flex;"><span>                <span style="color:#a90d91">throw</span> <span style="color:#a90d91">new</span> <span style="color:#000">NoSuchElementException</span>();
</span></span><span style="display:flex;"><span>            <span style="color:#000">Object</span><span style="color:#000">[]</span> <span style="color:#000">elementData</span> <span style="color:#000">=</span> <span style="color:#000">ArrayList</span>.<span style="color:#836c28">this</span>.<span style="color:#836c28">elementData</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#177500">// 计算出前一个元素在顶层的ArrayList中的索引位置，并校验</span>
</span></span><span style="display:flex;"><span>            <span style="color:#a90d91">if</span> (<span style="color:#000">offset</span> <span style="color:#000">+</span> <span style="color:#000">i</span> <span style="color:#000">&gt;=</span> <span style="color:#000">elementData</span>.<span style="color:#836c28">length</span>)
</span></span><span style="display:flex;"><span>                <span style="color:#a90d91">throw</span> <span style="color:#a90d91">new</span> <span style="color:#000">ConcurrentModificationException</span>();
</span></span><span style="display:flex;"><span>            <span style="color:#177500">// 这一步相当于是游标前移一位</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">cursor</span> <span style="color:#000">=</span> <span style="color:#000">i</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#177500">// 将最近返回的索引位置置为前一个元素，并返回该元素</span>
</span></span><span style="display:flex;"><span>            <span style="color:#a90d91">return</span> (<span style="color:#000">E</span>) <span style="color:#000">elementData</span><span style="color:#000">[</span><span style="color:#000">offset</span> <span style="color:#000">+</span> (<span style="color:#000">lastRet</span> <span style="color:#000">=</span> <span style="color:#000">i</span>)<span style="color:#000">]</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#177500">// 对剩下未遍历到的元素执行给定的操作</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">@SuppressWarnings</span>(<span style="color:#c41a16">&#34;unchecked&#34;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#a90d91">public</span> <span style="color:#a90d91">void</span> <span style="color:#000">forEachRemaining</span>(<span style="color:#000">Consumer</span><span style="color:#000">&lt;?</span> <span style="color:#a90d91">super</span> <span style="color:#000">E</span><span style="color:#000">&gt;</span> <span style="color:#000">consumer</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#000">Objects</span>.<span style="color:#836c28">requireNonNull</span>(<span style="color:#000">consumer</span>);
</span></span><span style="display:flex;"><span>            <span style="color:#a90d91">final</span> <span style="color:#a90d91">int</span> <span style="color:#000">size</span> <span style="color:#000">=</span> <span style="color:#000">SubList</span>.<span style="color:#836c28">this</span>.<span style="color:#836c28">size</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#a90d91">int</span> <span style="color:#000">i</span> <span style="color:#000">=</span> <span style="color:#000">cursor</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#177500">// 游标已在子列表末尾或之后，则说明已无未迭代到的元素，直接返回</span>
</span></span><span style="display:flex;"><span>            <span style="color:#a90d91">if</span> (<span style="color:#000">i</span> <span style="color:#000">&gt;=</span> <span style="color:#000">size</span>) {
</span></span><span style="display:flex;"><span>                <span style="color:#a90d91">return</span>;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            <span style="color:#a90d91">final</span> <span style="color:#000">Object</span><span style="color:#000">[]</span> <span style="color:#000">elementData</span> <span style="color:#000">=</span> <span style="color:#000">ArrayList</span>.<span style="color:#836c28">this</span>.<span style="color:#836c28">elementData</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#177500">// 计算出当前游标在顶层ArrayList中的索引位置，并校验</span>
</span></span><span style="display:flex;"><span>            <span style="color:#a90d91">if</span> (<span style="color:#000">offset</span> <span style="color:#000">+</span> <span style="color:#000">i</span> <span style="color:#000">&gt;=</span> <span style="color:#000">elementData</span>.<span style="color:#836c28">length</span>) {
</span></span><span style="display:flex;"><span>                <span style="color:#a90d91">throw</span> <span style="color:#a90d91">new</span> <span style="color:#000">ConcurrentModificationException</span>();
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            <span style="color:#177500">// 从游标位置开始往后遍历，直到当前子列表的末尾，对每个元素执行给定的操作</span>
</span></span><span style="display:flex;"><span>            <span style="color:#a90d91">while</span> (<span style="color:#000">i</span> <span style="color:#000">!=</span> <span style="color:#000">size</span> <span style="color:#000">&amp;&amp;</span> <span style="color:#000">modCount</span> <span style="color:#000">==</span> <span style="color:#000">expectedModCount</span>) {
</span></span><span style="display:flex;"><span>                <span style="color:#000">consumer</span>.<span style="color:#836c28">accept</span>((<span style="color:#000">E</span>) <span style="color:#000">elementData</span><span style="color:#000">[</span><span style="color:#000">offset</span> <span style="color:#000">+</span> (<span style="color:#000">i</span><span style="color:#000">++</span>)<span style="color:#000">]</span>);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            <span style="color:#177500">// update once at end of iteration to reduce heap write traffic</span>
</span></span><span style="display:flex;"><span>            <span style="color:#177500">// 最近返回索引和当前游标均一次性更新至子列表末尾</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">lastRet</span> <span style="color:#000">=</span> <span style="color:#000">cursor</span> <span style="color:#000">=</span> <span style="color:#000">i</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#000">checkForComodification</span>();
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>				<span style="color:#177500">// 获取下一个元素索引</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a90d91">public</span> <span style="color:#a90d91">int</span> <span style="color:#000">nextIndex</span>() {
</span></span><span style="display:flex;"><span>            <span style="color:#177500">// 返回当前游标</span>
</span></span><span style="display:flex;"><span>            <span style="color:#a90d91">return</span> <span style="color:#000">cursor</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#177500">// 获取上一个元素索引</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a90d91">public</span> <span style="color:#a90d91">int</span> <span style="color:#000">previousIndex</span>() {
</span></span><span style="display:flex;"><span>            <span style="color:#177500">// 返回当前游标之前的位置</span>
</span></span><span style="display:flex;"><span>            <span style="color:#a90d91">return</span> <span style="color:#000">cursor</span> <span style="color:#000">-</span> <span style="color:#000">1</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#177500">// 删除迭代器当前迭代到的元素</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a90d91">public</span> <span style="color:#a90d91">void</span> <span style="color:#000">remove</span>() {
</span></span><span style="display:flex;"><span>            <span style="color:#177500">// 最近返回元素小于0，将抛出异常</span>
</span></span><span style="display:flex;"><span>            <span style="color:#a90d91">if</span> (<span style="color:#000">lastRet</span> <span style="color:#000">&lt;</span> <span style="color:#000">0</span>)
</span></span><span style="display:flex;"><span>                <span style="color:#a90d91">throw</span> <span style="color:#a90d91">new</span> <span style="color:#000">IllegalStateException</span>();
</span></span><span style="display:flex;"><span>            <span style="color:#000">checkForComodification</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#a90d91">try</span> {
</span></span><span style="display:flex;"><span>                <span style="color:#177500">// 调用子列表的remove方法删除对应元素</span>
</span></span><span style="display:flex;"><span>                <span style="color:#000">SubList</span>.<span style="color:#836c28">this</span>.<span style="color:#836c28">remove</span>(<span style="color:#000">lastRet</span>);
</span></span><span style="display:flex;"><span>                <span style="color:#177500">// 将游标置于最近返回的元素索引位置，相当于左移一位</span>
</span></span><span style="display:flex;"><span>                <span style="color:#000">cursor</span> <span style="color:#000">=</span> <span style="color:#000">lastRet</span>;
</span></span><span style="display:flex;"><span>                <span style="color:#177500">// 将最近返回的索引位置置为-1</span>
</span></span><span style="display:flex;"><span>                <span style="color:#000">lastRet</span> <span style="color:#000">=</span> <span style="color:#000">-</span><span style="color:#000">1</span>;
</span></span><span style="display:flex;"><span>                <span style="color:#000">expectedModCount</span> <span style="color:#000">=</span> <span style="color:#000">ArrayList</span>.<span style="color:#836c28">this</span>.<span style="color:#836c28">modCount</span>;
</span></span><span style="display:flex;"><span>            } <span style="color:#a90d91">catch</span> (<span style="color:#000">IndexOutOfBoundsException</span> <span style="color:#000">ex</span>) {
</span></span><span style="display:flex;"><span>                <span style="color:#a90d91">throw</span> <span style="color:#a90d91">new</span> <span style="color:#000">ConcurrentModificationException</span>();
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#177500">// 替换最近返回的索引位置的元素为指定的元素</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a90d91">public</span> <span style="color:#a90d91">void</span> <span style="color:#000">set</span>(<span style="color:#000">E</span> <span style="color:#000">e</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#177500">// 最近返回的索引位置不可小于0，否则可能是迭代器还未获取过元素，或者已经进行了元素的增加（add）或删除（remove）</span>
</span></span><span style="display:flex;"><span>            <span style="color:#a90d91">if</span> (<span style="color:#000">lastRet</span> <span style="color:#000">&lt;</span> <span style="color:#000">0</span>)
</span></span><span style="display:flex;"><span>                <span style="color:#a90d91">throw</span> <span style="color:#a90d91">new</span> <span style="color:#000">IllegalStateException</span>();
</span></span><span style="display:flex;"><span>            <span style="color:#000">checkForComodification</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#a90d91">try</span> {
</span></span><span style="display:flex;"><span>                <span style="color:#177500">// 计算出元素在顶层ArrayList中的索引位置，用ArrayList的set方法替换元素</span>
</span></span><span style="display:flex;"><span>                <span style="color:#000">ArrayList</span>.<span style="color:#836c28">this</span>.<span style="color:#836c28">set</span>(<span style="color:#000">offset</span> <span style="color:#000">+</span> <span style="color:#000">lastRet</span>, <span style="color:#000">e</span>);
</span></span><span style="display:flex;"><span>            } <span style="color:#a90d91">catch</span> (<span style="color:#000">IndexOutOfBoundsException</span> <span style="color:#000">ex</span>) {
</span></span><span style="display:flex;"><span>                <span style="color:#a90d91">throw</span> <span style="color:#a90d91">new</span> <span style="color:#000">ConcurrentModificationException</span>();
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#177500">// 在当前游标位置插入指定元素</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a90d91">public</span> <span style="color:#a90d91">void</span> <span style="color:#000">add</span>(<span style="color:#000">E</span> <span style="color:#000">e</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#000">checkForComodification</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#a90d91">try</span> {
</span></span><span style="display:flex;"><span>                <span style="color:#a90d91">int</span> <span style="color:#000">i</span> <span style="color:#000">=</span> <span style="color:#000">cursor</span>;
</span></span><span style="display:flex;"><span>                <span style="color:#177500">// 调用子列表的add方法，在当前游标位置插入指定元素</span>
</span></span><span style="display:flex;"><span>                <span style="color:#000">SubList</span>.<span style="color:#836c28">this</span>.<span style="color:#836c28">add</span>(<span style="color:#000">i</span>, <span style="color:#000">e</span>);
</span></span><span style="display:flex;"><span>                <span style="color:#177500">// 将游标右移一位</span>
</span></span><span style="display:flex;"><span>                <span style="color:#000">cursor</span> <span style="color:#000">=</span> <span style="color:#000">i</span> <span style="color:#000">+</span> <span style="color:#000">1</span>;
</span></span><span style="display:flex;"><span>                <span style="color:#177500">// 将最近返回的索引置为-1</span>
</span></span><span style="display:flex;"><span>                <span style="color:#000">lastRet</span> <span style="color:#000">=</span> <span style="color:#000">-</span><span style="color:#000">1</span>;
</span></span><span style="display:flex;"><span>                <span style="color:#000">expectedModCount</span> <span style="color:#000">=</span> <span style="color:#000">ArrayList</span>.<span style="color:#836c28">this</span>.<span style="color:#836c28">modCount</span>;
</span></span><span style="display:flex;"><span>            } <span style="color:#a90d91">catch</span> (<span style="color:#000">IndexOutOfBoundsException</span> <span style="color:#000">ex</span>) {
</span></span><span style="display:flex;"><span>                <span style="color:#a90d91">throw</span> <span style="color:#a90d91">new</span> <span style="color:#000">ConcurrentModificationException</span>();
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#177500">// 检查是否存在并发修改</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a90d91">final</span> <span style="color:#a90d91">void</span> <span style="color:#000">checkForComodification</span>() {
</span></span><span style="display:flex;"><span>            <span style="color:#177500">// 如果子列表的期望修改次数不等于ArrayList修改次数，说明存在并发修改</span>
</span></span><span style="display:flex;"><span>            <span style="color:#a90d91">if</span> (<span style="color:#000">expectedModCount</span> <span style="color:#000">!=</span> <span style="color:#000">ArrayList</span>.<span style="color:#836c28">this</span>.<span style="color:#836c28">modCount</span>)
</span></span><span style="display:flex;"><span>                <span style="color:#a90d91">throw</span> <span style="color:#a90d91">new</span> <span style="color:#000">ConcurrentModificationException</span>();
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    };
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><div class="flex align-center gdoc-page__anchorwrap">
    <h2 id="5316-public-listlte-sublistint-fromindex-int-toindex"
    >
        53.16 public List&lt;E&gt; subList(int fromIndex, int toIndex)
    </h2>
    <a data-clipboard-text="https://hongmao.run/jdk8-src-note/java/util/ArrayList/#5316-public-listlte-sublistint-fromindex-int-toindex" class="gdoc-page__anchor clip flex align-center" title="锚定到： 53.16 public List&lt;E&gt; subList(int fromIndex, int toIndex)" aria-label="锚定到： 53.16 public List&lt;E&gt; subList(int fromIndex, int toIndex)" href="#5316-public-listlte-sublistint-fromindex-int-toindex">
        <svg class="gdoc-icon gdoc_link"><use xlink:href="#gdoc_link"></use></svg>
    </a>
</div>
<p>获取当前<code>SubList</code>实例的子列表。</p>
<p>源码如下：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#a90d91">public</span> <span style="color:#000">List</span><span style="color:#000">&lt;</span><span style="color:#000">E</span><span style="color:#000">&gt;</span> <span style="color:#000">subList</span>(<span style="color:#a90d91">int</span> <span style="color:#000">fromIndex</span>, <span style="color:#a90d91">int</span> <span style="color:#000">toIndex</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#000">subListRangeCheck</span>(<span style="color:#000">fromIndex</span>, <span style="color:#000">toIndex</span>, <span style="color:#000">size</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// 看，此处传入的offset为当前子列表的offset，而非ArrayList的subList方法中传入的0</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">return</span> <span style="color:#a90d91">new</span> <span style="color:#000">SubList</span>(<span style="color:#a90d91">this</span>, <span style="color:#000">offset</span>, <span style="color:#000">fromIndex</span>, <span style="color:#000">toIndex</span>);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><div class="flex align-center gdoc-page__anchorwrap">
    <h2 id="5317-private-void-rangecheckint-index"
    >
        53.17 private void rangeCheck(int index)
    </h2>
    <a data-clipboard-text="https://hongmao.run/jdk8-src-note/java/util/ArrayList/#5317-private-void-rangecheckint-index" class="gdoc-page__anchor clip flex align-center" title="锚定到： 53.17 private void rangeCheck(int index)" aria-label="锚定到： 53.17 private void rangeCheck(int index)" href="#5317-private-void-rangecheckint-index">
        <svg class="gdoc-icon gdoc_link"><use xlink:href="#gdoc_link"></use></svg>
    </a>
</div>
<p>对指定索引进行合法性检查。</p>
<p>源码如下：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#a90d91">private</span> <span style="color:#a90d91">void</span> <span style="color:#000">rangeCheck</span>(<span style="color:#a90d91">int</span> <span style="color:#000">index</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// 指定的索引必须大于0且小于size，否则将造成数据越界</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">if</span> (<span style="color:#000">index</span> <span style="color:#000">&lt;</span> <span style="color:#000">0</span> <span style="color:#000">||</span> <span style="color:#000">index</span> <span style="color:#000">&gt;=</span> <span style="color:#a90d91">this</span>.<span style="color:#836c28">size</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#a90d91">throw</span> <span style="color:#a90d91">new</span> <span style="color:#000">IndexOutOfBoundsException</span>(<span style="color:#000">outOfBoundsMsg</span>(<span style="color:#000">index</span>));
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><div class="flex align-center gdoc-page__anchorwrap">
    <h2 id="5318-private-void-rangecheckforaddint-index"
    >
        53.18 private void rangeCheckForAdd(int index)
    </h2>
    <a data-clipboard-text="https://hongmao.run/jdk8-src-note/java/util/ArrayList/#5318-private-void-rangecheckforaddint-index" class="gdoc-page__anchor clip flex align-center" title="锚定到： 53.18 private void rangeCheckForAdd(int index)" aria-label="锚定到： 53.18 private void rangeCheckForAdd(int index)" href="#5318-private-void-rangecheckforaddint-index">
        <svg class="gdoc-icon gdoc_link"><use xlink:href="#gdoc_link"></use></svg>
    </a>
</div>
<p>在列表插入元素时，对插入位置进行校验。</p>
<p>源码如下：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#a90d91">private</span> <span style="color:#a90d91">void</span> <span style="color:#000">rangeCheckForAdd</span>(<span style="color:#a90d91">int</span> <span style="color:#000">index</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// 相较于rangeCheck，本校验方法允许指定索引等于size，因为可以往size位置插入元素</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">if</span> (<span style="color:#000">index</span> <span style="color:#000">&lt;</span> <span style="color:#000">0</span> <span style="color:#000">||</span> <span style="color:#000">index</span> <span style="color:#000">&gt;</span> <span style="color:#a90d91">this</span>.<span style="color:#836c28">size</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#a90d91">throw</span> <span style="color:#a90d91">new</span> <span style="color:#000">IndexOutOfBoundsException</span>(<span style="color:#000">outOfBoundsMsg</span>(<span style="color:#000">index</span>));
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><div class="flex align-center gdoc-page__anchorwrap">
    <h2 id="5319-private-string-outofboundsmsgint-index"
    >
        53.19 private String outOfBoundsMsg(int index)
    </h2>
    <a data-clipboard-text="https://hongmao.run/jdk8-src-note/java/util/ArrayList/#5319-private-string-outofboundsmsgint-index" class="gdoc-page__anchor clip flex align-center" title="锚定到： 53.19 private String outOfBoundsMsg(int index)" aria-label="锚定到： 53.19 private String outOfBoundsMsg(int index)" href="#5319-private-string-outofboundsmsgint-index">
        <svg class="gdoc-icon gdoc_link"><use xlink:href="#gdoc_link"></use></svg>
    </a>
</div>
<p>获取数组越界异常的提示信息。</p>
<p>源码如下：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#a90d91">private</span> <span style="color:#000">String</span> <span style="color:#000">outOfBoundsMsg</span>(<span style="color:#a90d91">int</span> <span style="color:#000">index</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">return</span> <span style="color:#c41a16">&#34;Index: &#34;</span><span style="color:#000">+</span><span style="color:#000">index</span><span style="color:#000">+</span><span style="color:#c41a16">&#34;, Size: &#34;</span><span style="color:#000">+</span><span style="color:#a90d91">this</span>.<span style="color:#836c28">size</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><div class="flex align-center gdoc-page__anchorwrap">
    <h2 id="5320-private-void-checkforcomodification"
    >
        53.20 private void checkForComodification()
    </h2>
    <a data-clipboard-text="https://hongmao.run/jdk8-src-note/java/util/ArrayList/#5320-private-void-checkforcomodification" class="gdoc-page__anchor clip flex align-center" title="锚定到： 53.20 private void checkForComodification()" aria-label="锚定到： 53.20 private void checkForComodification()" href="#5320-private-void-checkforcomodification">
        <svg class="gdoc-icon gdoc_link"><use xlink:href="#gdoc_link"></use></svg>
    </a>
</div>
<p>检查列表是否存在并发修改。</p>
<p>源码如下：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#a90d91">private</span> <span style="color:#a90d91">void</span> <span style="color:#000">checkForComodification</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// 判断ArrayList的修改次数与当前子列表的修改次数是否一致，否则抛出并发修改异常</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">if</span> (<span style="color:#000">ArrayList</span>.<span style="color:#836c28">this</span>.<span style="color:#836c28">modCount</span> <span style="color:#000">!=</span> <span style="color:#a90d91">this</span>.<span style="color:#836c28">modCount</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#a90d91">throw</span> <span style="color:#a90d91">new</span> <span style="color:#000">ConcurrentModificationException</span>();
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><div class="flex align-center gdoc-page__anchorwrap">
    <h2 id="5321-public-spliteratorlte-spliterator"
    >
        53.21 public Spliterator&lt;E&gt; spliterator()
    </h2>
    <a data-clipboard-text="https://hongmao.run/jdk8-src-note/java/util/ArrayList/#5321-public-spliteratorlte-spliterator" class="gdoc-page__anchor clip flex align-center" title="锚定到： 53.21 public Spliterator&lt;E&gt; spliterator()" aria-label="锚定到： 53.21 public Spliterator&lt;E&gt; spliterator()" href="#5321-public-spliteratorlte-spliterator">
        <svg class="gdoc-icon gdoc_link"><use xlink:href="#gdoc_link"></use></svg>
    </a>
</div>
<p>获取当前子列表的拆分器。</p>
<p>源码如下：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#a90d91">public</span> <span style="color:#000">Spliterator</span><span style="color:#000">&lt;</span><span style="color:#000">E</span><span style="color:#000">&gt;</span> <span style="color:#000">spliterator</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#000">checkForComodification</span>();
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// 注意，此处传入的是ArrayList，而非当前子列表</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">return</span> <span style="color:#a90d91">new</span> <span style="color:#000">ArrayListSpliterator</span><span style="color:#000">&lt;</span><span style="color:#000">E</span><span style="color:#000">&gt;</span>(<span style="color:#000">ArrayList</span>.<span style="color:#836c28">this</span>, <span style="color:#000">offset</span>,
</span></span><span style="display:flex;"><span>                                       <span style="color:#000">offset</span> <span style="color:#000">+</span> <span style="color:#a90d91">this</span>.<span style="color:#836c28">size</span>, <span style="color:#a90d91">this</span>.<span style="color:#836c28">modCount</span>);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><hr>
<div class="flex align-center gdoc-page__anchorwrap">
    <h1 id="54-public-void-foreachconsumer-super-e-action"
    >
        54. public void forEach(Consumer&lt;? super E&gt; action)
    </h1>
    <a data-clipboard-text="https://hongmao.run/jdk8-src-note/java/util/ArrayList/#54-public-void-foreachconsumer-super-e-action" class="gdoc-page__anchor clip flex align-center" title="锚定到： 54. public void forEach(Consumer&lt;? super E&gt; action)" aria-label="锚定到： 54. public void forEach(Consumer&lt;? super E&gt; action)" href="#54-public-void-foreachconsumer-super-e-action">
        <svg class="gdoc-icon gdoc_link"><use xlink:href="#gdoc_link"></use></svg>
    </a>
</div>
<p>遍历当前列表，对每个元素执行给定的操作，直到每个元素都被迭代到或者中间出了异常。</p>
<p>源码如下：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#000">@Override</span>
</span></span><span style="display:flex;"><span><span style="color:#a90d91">public</span> <span style="color:#a90d91">void</span> <span style="color:#000">forEach</span>(<span style="color:#000">Consumer</span><span style="color:#000">&lt;?</span> <span style="color:#a90d91">super</span> <span style="color:#000">E</span><span style="color:#000">&gt;</span> <span style="color:#000">action</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#000">Objects</span>.<span style="color:#836c28">requireNonNull</span>(<span style="color:#000">action</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">final</span> <span style="color:#a90d91">int</span> <span style="color:#000">expectedModCount</span> <span style="color:#000">=</span> <span style="color:#000">modCount</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#000">@SuppressWarnings</span>(<span style="color:#c41a16">&#34;unchecked&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// 取出当前列表的对象数组，待会就遍历它</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">final</span> <span style="color:#000">E</span><span style="color:#000">[]</span> <span style="color:#000">elementData</span> <span style="color:#000">=</span> (<span style="color:#000">E</span><span style="color:#000">[]</span>) <span style="color:#a90d91">this</span>.<span style="color:#836c28">elementData</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">final</span> <span style="color:#a90d91">int</span> <span style="color:#000">size</span> <span style="color:#000">=</span> <span style="color:#a90d91">this</span>.<span style="color:#836c28">size</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// 遍历时每次循环都校验是否存在并发修改，存在则直接结束遍历</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">for</span> (<span style="color:#a90d91">int</span> <span style="color:#000">i</span><span style="color:#000">=</span><span style="color:#000">0</span>; <span style="color:#000">modCount</span> <span style="color:#000">==</span> <span style="color:#000">expectedModCount</span> <span style="color:#000">&amp;&amp;</span> <span style="color:#000">i</span> <span style="color:#000">&lt;</span> <span style="color:#000">size</span>; <span style="color:#000">i</span><span style="color:#000">++</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#000">action</span>.<span style="color:#836c28">accept</span>(<span style="color:#000">elementData</span><span style="color:#000">[</span><span style="color:#000">i</span><span style="color:#000">]</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// 若存在并发修改，直接抛出异常</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">if</span> (<span style="color:#000">modCount</span> <span style="color:#000">!=</span> <span style="color:#000">expectedModCount</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#a90d91">throw</span> <span style="color:#a90d91">new</span> <span style="color:#000">ConcurrentModificationException</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><hr>
<div class="flex align-center gdoc-page__anchorwrap">
    <h1 id="55-public-spliteratorlte-spliterator"
    >
        55. public Spliterator&lt;E&gt; spliterator()
    </h1>
    <a data-clipboard-text="https://hongmao.run/jdk8-src-note/java/util/ArrayList/#55-public-spliteratorlte-spliterator" class="gdoc-page__anchor clip flex align-center" title="锚定到： 55. public Spliterator&lt;E&gt; spliterator()" aria-label="锚定到： 55. public Spliterator&lt;E&gt; spliterator()" href="#55-public-spliteratorlte-spliterator">
        <svg class="gdoc-icon gdoc_link"><use xlink:href="#gdoc_link"></use></svg>
    </a>
</div>
<p>在此列表中的元素上创建一个“后期绑定”和“快速失败”的<code>Spliterator</code>。<code>Spliterator</code>报告<code>Spliterator#SIZED</code>、<code>Spliterator#SUBSIZED</code>和<code>Spliterator#ORDERED</code>。覆盖本实现应该记录其他特征值的描述。</p>
<p>源码如下：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#000">@Override</span>
</span></span><span style="display:flex;"><span><span style="color:#a90d91">public</span> <span style="color:#000">Spliterator</span><span style="color:#000">&lt;</span><span style="color:#000">E</span><span style="color:#000">&gt;</span> <span style="color:#000">spliterator</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">return</span> <span style="color:#a90d91">new</span> <span style="color:#000">ArrayListSpliterator</span><span style="color:#000">&lt;&gt;</span>(<span style="color:#a90d91">this</span>, <span style="color:#000">0</span>, <span style="color:#000">-</span><span style="color:#000">1</span>, <span style="color:#000">0</span>);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><hr>
<div class="flex align-center gdoc-page__anchorwrap">
    <h1 id="56-static-final-class-arraylistspliteratorlte-implements-spliteratorlte"
    >
        56. static final class ArrayListSpliterator&lt;E&gt; implements Spliterator&lt;E&gt;
    </h1>
    <a data-clipboard-text="https://hongmao.run/jdk8-src-note/java/util/ArrayList/#56-static-final-class-arraylistspliteratorlte-implements-spliteratorlte" class="gdoc-page__anchor clip flex align-center" title="锚定到： 56. static final class ArrayListSpliterator&lt;E&gt; implements Spliterator&lt;E&gt;" aria-label="锚定到： 56. static final class ArrayListSpliterator&lt;E&gt; implements Spliterator&lt;E&gt;" href="#56-static-final-class-arraylistspliteratorlte-implements-spliteratorlte">
        <svg class="gdoc-icon gdoc_link"><use xlink:href="#gdoc_link"></use></svg>
    </a>
</div>
<p>基于索引一分为二、延迟初始化的<code>Spliterator</code>。</p>
<p>如果<code>ArrayList</code>是不可变的或结构上不可变的（没有添加，删除等），我们可以使用<code>Arrays.spliterator</code>实现它们的分隔器。相反，我们在不牺牲太多性能的情况下，在遍历过程中检测到尽可能多的干扰。我们主要依靠modCounts，这不能保证检测到并发冲突，并且有时对线程内干扰过于保守，但是可以检测到足够的问题，值得在实践中使用。为了实现这一点：</p>
<ol>
<li>我们延迟初始化<code>fence</code>和<code>expectedModCount</code>，直到需要提交给正在检查状态的最新点，从而提高精度。 （这不适用于<code>SubList</code>，因为<code>SubList</code>会创建带有当前非惰性值的<code>Spliterator</code>）。</li>
<li>我们仅在 <code>forEach</code>（对性能最敏感的方法）结束时执行一次 <code>ConcurrentModificationException</code> 检查。当使用<code>forEach</code>（而不是迭代器）时，我们通常只能在动作之后检测干扰，而不是之前。进一步的 CME 触发检查适用于所有其他可能不符合预期的情况，例如 <code>null</code> 或给定 <code>size()</code> 的太小的 <code>elementData</code> 数组，这可能仅由于干扰而发生。这允许 <code>forEach</code> 的内部循环在没有任何进一步检查的情况下运行，并简化了 lambda 解析。虽然这确实需要一些检查，但请注意，在 <code>list.stream().forEach(a)</code> 的常见情况下，除了 <code>forEach</code> 本身之外，不会在任何地方进行检查或其他计算。其他不太常用的方法无法利用这些精简中的大部分。</li>
</ol>
<div class="flex align-center gdoc-page__anchorwrap">
    <h2 id="561-private-final-arraylistlte-list"
    >
        56.1 private final ArrayList&lt;E&gt; list;
    </h2>
    <a data-clipboard-text="https://hongmao.run/jdk8-src-note/java/util/ArrayList/#561-private-final-arraylistlte-list" class="gdoc-page__anchor clip flex align-center" title="锚定到： 56.1 private final ArrayList&lt;E&gt; list;" aria-label="锚定到： 56.1 private final ArrayList&lt;E&gt; list;" href="#561-private-final-arraylistlte-list">
        <svg class="gdoc-icon gdoc_link"><use xlink:href="#gdoc_link"></use></svg>
    </a>
</div>
<p>该拆分器所属的<code>list</code>。</p>
<div class="flex align-center gdoc-page__anchorwrap">
    <h2 id="562-private-int-index"
    >
        56.2 private int index;
    </h2>
    <a data-clipboard-text="https://hongmao.run/jdk8-src-note/java/util/ArrayList/#562-private-int-index" class="gdoc-page__anchor clip flex align-center" title="锚定到： 56.2 private int index;" aria-label="锚定到： 56.2 private int index;" href="#562-private-int-index">
        <svg class="gdoc-icon gdoc_link"><use xlink:href="#gdoc_link"></use></svg>
    </a>
</div>
<p>当前索引，在前进（<code>advance</code>）或拆分（<code>split</code>）时修改。</p>
<div class="flex align-center gdoc-page__anchorwrap">
    <h2 id="563-private-int-fence"
    >
        56.3 private int fence;
    </h2>
    <a data-clipboard-text="https://hongmao.run/jdk8-src-note/java/util/ArrayList/#563-private-int-fence" class="gdoc-page__anchor clip flex align-center" title="锚定到： 56.3 private int fence;" aria-label="锚定到： 56.3 private int fence;" href="#563-private-int-fence">
        <svg class="gdoc-icon gdoc_link"><use xlink:href="#gdoc_link"></use></svg>
    </a>
</div>
<p>直到使用前都是-1，然后直到最后一个索引。</p>
<div class="flex align-center gdoc-page__anchorwrap">
    <h2 id="564-private-int-expectedmodcount"
    >
        56.4 private int expectedModCount;
    </h2>
    <a data-clipboard-text="https://hongmao.run/jdk8-src-note/java/util/ArrayList/#564-private-int-expectedmodcount" class="gdoc-page__anchor clip flex align-center" title="锚定到： 56.4 private int expectedModCount;" aria-label="锚定到： 56.4 private int expectedModCount;" href="#564-private-int-expectedmodcount">
        <svg class="gdoc-icon gdoc_link"><use xlink:href="#gdoc_link"></use></svg>
    </a>
</div>
<p>期望修改次数，设置<code>fence</code>时初始化。</p>
<div class="flex align-center gdoc-page__anchorwrap">
    <h2 id="565-arraylistspliteratorarraylistlte-list-int-origin-int-fence-int-expectedmodcount"
    >
        56.5 ArrayListSpliterator(ArrayList&lt;E&gt; list, int origin, int fence, int expectedModCount)
    </h2>
    <a data-clipboard-text="https://hongmao.run/jdk8-src-note/java/util/ArrayList/#565-arraylistspliteratorarraylistlte-list-int-origin-int-fence-int-expectedmodcount" class="gdoc-page__anchor clip flex align-center" title="锚定到： 56.5 ArrayListSpliterator(ArrayList&lt;E&gt; list, int origin, int fence, int expectedModCount)" aria-label="锚定到： 56.5 ArrayListSpliterator(ArrayList&lt;E&gt; list, int origin, int fence, int expectedModCount)" href="#565-arraylistspliteratorarraylistlte-list-int-origin-int-fence-int-expectedmodcount">
        <svg class="gdoc-icon gdoc_link"><use xlink:href="#gdoc_link"></use></svg>
    </a>
</div>
<p>创建覆盖给定范围的新拆分器。</p>
<p>源码如下：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#000">ArrayListSpliterator</span>(<span style="color:#000">ArrayList</span><span style="color:#000">&lt;</span><span style="color:#000">E</span><span style="color:#000">&gt;</span> <span style="color:#000">list</span>, <span style="color:#a90d91">int</span> <span style="color:#000">origin</span>, <span style="color:#a90d91">int</span> <span style="color:#000">fence</span>,
</span></span><span style="display:flex;"><span>                     <span style="color:#a90d91">int</span> <span style="color:#000">expectedModCount</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// 参数中的list可以为空，除非要遍历它</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">this</span>.<span style="color:#836c28">list</span> <span style="color:#000">=</span> <span style="color:#000">list</span>; <span style="color:#177500">// OK if null unless traversed</span>
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// 属性值初始化</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">this</span>.<span style="color:#836c28">index</span> <span style="color:#000">=</span> <span style="color:#000">origin</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">this</span>.<span style="color:#836c28">fence</span> <span style="color:#000">=</span> <span style="color:#000">fence</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">this</span>.<span style="color:#836c28">expectedModCount</span> <span style="color:#000">=</span> <span style="color:#000">expectedModCount</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><div class="flex align-center gdoc-page__anchorwrap">
    <h2 id="566-private-int-getfence"
    >
        56.6 private int getFence()
    </h2>
    <a data-clipboard-text="https://hongmao.run/jdk8-src-note/java/util/ArrayList/#566-private-int-getfence" class="gdoc-page__anchor clip flex align-center" title="锚定到： 56.6 private int getFence()" aria-label="锚定到： 56.6 private int getFence()" href="#566-private-int-getfence">
        <svg class="gdoc-icon gdoc_link"><use xlink:href="#gdoc_link"></use></svg>
    </a>
</div>
<p>第一次使用时，初始化围栏<code>fence</code>大小。</p>
<p>源码如下：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#a90d91">private</span> <span style="color:#a90d91">int</span> <span style="color:#000">getFence</span>() { <span style="color:#177500">// initialize fence to size on first use</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">int</span> <span style="color:#000">hi</span>; <span style="color:#177500">// (a specialized variant appears in method forEach)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">ArrayList</span><span style="color:#000">&lt;</span><span style="color:#000">E</span><span style="color:#000">&gt;</span> <span style="color:#000">lst</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// 将fence大于等于0，直接返回该值</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">if</span> ((<span style="color:#000">hi</span> <span style="color:#000">=</span> <span style="color:#000">fence</span>) <span style="color:#000">&lt;</span> <span style="color:#000">0</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#177500">// 如果list为空，则fence初始化为0，并最终返回0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a90d91">if</span> ((<span style="color:#000">lst</span> <span style="color:#000">=</span> <span style="color:#000">list</span>) <span style="color:#000">==</span> <span style="color:#a90d91">null</span>)
</span></span><span style="display:flex;"><span>            <span style="color:#000">hi</span> <span style="color:#000">=</span> <span style="color:#000">fence</span> <span style="color:#000">=</span> <span style="color:#000">0</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#a90d91">else</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#177500">// 如果list不为空</span>
</span></span><span style="display:flex;"><span>            <span style="color:#177500">// 初始化拆分器的期望修改次数</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">expectedModCount</span> <span style="color:#000">=</span> <span style="color:#000">lst</span>.<span style="color:#836c28">modCount</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#177500">// 将fence初始化为列表的大小</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">hi</span> <span style="color:#000">=</span> <span style="color:#000">fence</span> <span style="color:#000">=</span> <span style="color:#000">lst</span>.<span style="color:#836c28">size</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">return</span> <span style="color:#000">hi</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><div class="flex align-center gdoc-page__anchorwrap">
    <h2 id="567-public-arraylistspliteratorlte-trysplit"
    >
        56.7 public ArrayListSpliterator&lt;E&gt; trySplit()
    </h2>
    <a data-clipboard-text="https://hongmao.run/jdk8-src-note/java/util/ArrayList/#567-public-arraylistspliteratorlte-trysplit" class="gdoc-page__anchor clip flex align-center" title="锚定到： 56.7 public ArrayListSpliterator&lt;E&gt; trySplit()" aria-label="锚定到： 56.7 public ArrayListSpliterator&lt;E&gt; trySplit()" href="#567-public-arraylistspliteratorlte-trysplit">
        <svg class="gdoc-icon gdoc_link"><use xlink:href="#gdoc_link"></use></svg>
    </a>
</div>
<p>执行拆分。</p>
<p>源码如下：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#a90d91">public</span> <span style="color:#000">ArrayListSpliterator</span><span style="color:#000">&lt;</span><span style="color:#000">E</span><span style="color:#000">&gt;</span> <span style="color:#000">trySplit</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// hi = getFence()，这一步是获取围栏位置</span>
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// lo = index，这一步是获取当前索引</span>
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// mid = (lo + hi) &gt;&gt;&gt; 1，这一步很关键，求取当前迭代到的位置直到围栏位置的中间索引位置，将用于拆分出新拆分器</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">int</span> <span style="color:#000">hi</span> <span style="color:#000">=</span> <span style="color:#000">getFence</span>(), <span style="color:#000">lo</span> <span style="color:#000">=</span> <span style="color:#000">index</span>, <span style="color:#000">mid</span> <span style="color:#000">=</span> (<span style="color:#000">lo</span> <span style="color:#000">+</span> <span style="color:#000">hi</span>) <span style="color:#000">&gt;&gt;&gt;</span> <span style="color:#000">1</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// 除非太小，否则将范围分成两半</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">return</span> (<span style="color:#000">lo</span> <span style="color:#000">&gt;=</span> <span style="color:#000">mid</span>) <span style="color:#000">?</span> <span style="color:#a90d91">null</span> : <span style="color:#177500">// divide range in half unless too small</span>
</span></span><span style="display:flex;"><span>        <span style="color:#177500">// 拆分出去的新拆分器，是从当前迭代到的位置至上面求出的中间位置</span>
</span></span><span style="display:flex;"><span>        <span style="color:#177500">// 此处还有一个不明显但很关键的操作：index = mid，这一步是将当前老拆分器的迭代位置置为上面求出的中间位置</span>
</span></span><span style="display:flex;"><span>        <span style="color:#177500">// 这样老拆分器就一分为二了，新拆分器负责前半部分，老拆分器负责后半部分</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a90d91">new</span> <span style="color:#000">ArrayListSpliterator</span><span style="color:#000">&lt;</span><span style="color:#000">E</span><span style="color:#000">&gt;</span>(<span style="color:#000">list</span>, <span style="color:#000">lo</span>, <span style="color:#000">index</span> <span style="color:#000">=</span> <span style="color:#000">mid</span>,
</span></span><span style="display:flex;"><span>                                    <span style="color:#000">expectedModCount</span>);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>例如：</p>
<p>存在一个<code>ArrayList</code>，其<code>size</code>为<code>35</code>，然后其调用<code>spliterator()</code>获取到一个拆分器，此时该拆分器的<code>fence</code>为<code>-1</code>，<code>index</code>为<code>0</code>。</p>
<p>若此时对该拆分器执行拆分（<code>trySplit()</code>）操作： 首先调用<code>getFence()</code>获取围栏大小，此方法中会对<code>fence</code>做初始化，最终拿到的<code>fence</code>是<code>35</code>，在加上当前索引为<code>0</code>，则计算出的中间值为17（<code>(35 + 0) &gt;&gt;&gt; 1 = 17</code>）。 当前索引为<code>0</code>，小于中间值，此时可以进行拆分，此时方法返回的新拆分器实例的属性分别为：<code>index</code>为<code>0</code>，<code>fence</code>为<code>17</code>。同时，原拆分器的<code>index</code>更新为<code>17</code>。 此时就相当于一个持有<code>35</code>个元素的拆分器，拆分出去了一个持有<code>17</code>个元素的拆分器，自己还剩<code>18</code>个元素。（所谓“持有”，其实这两个拆分器都是持有该拆分器所属的<code>list</code>，但通过围栏字段<code>fence</code>区分出每个拆分器所负责的那一部分）</p>
<p>如图所示：</p>

<div style='text-align: center'>
    <img src='https://img.hongmao.run/blog/2021/08/ArrayListSpliterator.trySplit.png' width='50%' alt=''>
</div>


<div class="flex align-center gdoc-page__anchorwrap">
    <h2 id="568-public-boolean-tryadvanceconsumer-super-e-action"
    >
        56.8 public boolean tryAdvance(Consumer&lt;? super E&gt; action)
    </h2>
    <a data-clipboard-text="https://hongmao.run/jdk8-src-note/java/util/ArrayList/#568-public-boolean-tryadvanceconsumer-super-e-action" class="gdoc-page__anchor clip flex align-center" title="锚定到： 56.8 public boolean tryAdvance(Consumer&lt;? super E&gt; action)" aria-label="锚定到： 56.8 public boolean tryAdvance(Consumer&lt;? super E&gt; action)" href="#568-public-boolean-tryadvanceconsumer-super-e-action">
        <svg class="gdoc-icon gdoc_link"><use xlink:href="#gdoc_link"></use></svg>
    </a>
</div>
<p>对当前拆分器迭代到的元素执行给定的操作<code>action</code>。</p>
<p>源码如下：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#a90d91">public</span> <span style="color:#a90d91">boolean</span> <span style="color:#000">tryAdvance</span>(<span style="color:#000">Consumer</span><span style="color:#000">&lt;?</span> <span style="color:#a90d91">super</span> <span style="color:#000">E</span><span style="color:#000">&gt;</span> <span style="color:#000">action</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">if</span> (<span style="color:#000">action</span> <span style="color:#000">==</span> <span style="color:#a90d91">null</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#a90d91">throw</span> <span style="color:#a90d91">new</span> <span style="color:#000">NullPointerException</span>();
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// 获取围栏位置以及当前索引</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">int</span> <span style="color:#000">hi</span> <span style="color:#000">=</span> <span style="color:#000">getFence</span>(), <span style="color:#000">i</span> <span style="color:#000">=</span> <span style="color:#000">index</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// 如果当前索引大于等于围栏位置，说明所有元素均已遍历完，此时没有元素执行给定的操作</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">if</span> (<span style="color:#000">i</span> <span style="color:#000">&lt;</span> <span style="color:#000">hi</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#177500">// 将索引右移一位</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">index</span> <span style="color:#000">=</span> <span style="color:#000">i</span> <span style="color:#000">+</span> <span style="color:#000">1</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#177500">// 取出右移前索引位置的元素</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">@SuppressWarnings</span>(<span style="color:#c41a16">&#34;unchecked&#34;</span>) <span style="color:#000">E</span> <span style="color:#000">e</span> <span style="color:#000">=</span> (<span style="color:#000">E</span>)<span style="color:#000">list</span>.<span style="color:#836c28">elementData</span><span style="color:#000">[</span><span style="color:#000">i</span><span style="color:#000">]</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#177500">// 对取出的元素执行给定的操作</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">action</span>.<span style="color:#836c28">accept</span>(<span style="color:#000">e</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#177500">// 校验是否存在并发修改</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a90d91">if</span> (<span style="color:#000">list</span>.<span style="color:#836c28">modCount</span> <span style="color:#000">!=</span> <span style="color:#000">expectedModCount</span>)
</span></span><span style="display:flex;"><span>            <span style="color:#a90d91">throw</span> <span style="color:#a90d91">new</span> <span style="color:#000">ConcurrentModificationException</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#a90d91">return</span> <span style="color:#a90d91">true</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">return</span> <span style="color:#a90d91">false</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><div class="flex align-center gdoc-page__anchorwrap">
    <h2 id="569-public-void-foreachremainingconsumer-super-e-action"
    >
        56.9 public void forEachRemaining(Consumer&lt;? super E&gt; action)
    </h2>
    <a data-clipboard-text="https://hongmao.run/jdk8-src-note/java/util/ArrayList/#569-public-void-foreachremainingconsumer-super-e-action" class="gdoc-page__anchor clip flex align-center" title="锚定到： 56.9 public void forEachRemaining(Consumer&lt;? super E&gt; action)" aria-label="锚定到： 56.9 public void forEachRemaining(Consumer&lt;? super E&gt; action)" href="#569-public-void-foreachremainingconsumer-super-e-action">
        <svg class="gdoc-icon gdoc_link"><use xlink:href="#gdoc_link"></use></svg>
    </a>
</div>
<p>对当前拆分器剩余未迭代到的元素执行给定的操作<code>action</code>。所谓剩余是指：从当前索引位置到围栏位置之间的元素。</p>
<p>源码如下：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#a90d91">public</span> <span style="color:#a90d91">void</span> <span style="color:#000">forEachRemaining</span>(<span style="color:#000">Consumer</span><span style="color:#000">&lt;?</span> <span style="color:#a90d91">super</span> <span style="color:#000">E</span><span style="color:#000">&gt;</span> <span style="color:#000">action</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">int</span> <span style="color:#000">i</span>, <span style="color:#000">hi</span>, <span style="color:#000">mc</span>; <span style="color:#177500">// hoist accesses and checks from loop</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">ArrayList</span><span style="color:#000">&lt;</span><span style="color:#000">E</span><span style="color:#000">&gt;</span> <span style="color:#000">lst</span>; <span style="color:#000">Object</span><span style="color:#000">[]</span> <span style="color:#000">a</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">if</span> (<span style="color:#000">action</span> <span style="color:#000">==</span> <span style="color:#a90d91">null</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#a90d91">throw</span> <span style="color:#a90d91">new</span> <span style="color:#000">NullPointerException</span>();
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// 列表必须不能为空，否则抛出并发修改异常</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">if</span> ((<span style="color:#000">lst</span> <span style="color:#000">=</span> <span style="color:#000">list</span>) <span style="color:#000">!=</span> <span style="color:#a90d91">null</span> <span style="color:#000">&amp;&amp;</span> (<span style="color:#000">a</span> <span style="color:#000">=</span> <span style="color:#000">lst</span>.<span style="color:#836c28">elementData</span>) <span style="color:#000">!=</span> <span style="color:#a90d91">null</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#177500">// 如果围栏位置小于0，可能是刚基于列表创建的拆分器</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a90d91">if</span> ((<span style="color:#000">hi</span> <span style="color:#000">=</span> <span style="color:#000">fence</span>) <span style="color:#000">&lt;</span> <span style="color:#000">0</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#000">mc</span> <span style="color:#000">=</span> <span style="color:#000">lst</span>.<span style="color:#836c28">modCount</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#000">hi</span> <span style="color:#000">=</span> <span style="color:#000">lst</span>.<span style="color:#836c28">size</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#a90d91">else</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">mc</span> <span style="color:#000">=</span> <span style="color:#000">expectedModCount</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#177500">// 如果当前索引位置大于等于0 且 围栏位置小于等于列表中对象数组的长度，则迭代数组</span>
</span></span><span style="display:flex;"><span>        <span style="color:#177500">// 此处的隐秘操作：index = hi，这一步将拆分器的当前索引推至围栏位置了</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a90d91">if</span> ((<span style="color:#000">i</span> <span style="color:#000">=</span> <span style="color:#000">index</span>) <span style="color:#000">&gt;=</span> <span style="color:#000">0</span> <span style="color:#000">&amp;&amp;</span> (<span style="color:#000">index</span> <span style="color:#000">=</span> <span style="color:#000">hi</span>) <span style="color:#000">&lt;=</span> <span style="color:#000">a</span>.<span style="color:#836c28">length</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#a90d91">for</span> (; <span style="color:#000">i</span> <span style="color:#000">&lt;</span> <span style="color:#000">hi</span>; <span style="color:#000">++</span><span style="color:#000">i</span>) {
</span></span><span style="display:flex;"><span>                <span style="color:#000">@SuppressWarnings</span>(<span style="color:#c41a16">&#34;unchecked&#34;</span>) <span style="color:#000">E</span> <span style="color:#000">e</span> <span style="color:#000">=</span> (<span style="color:#000">E</span>) <span style="color:#000">a</span><span style="color:#000">[</span><span style="color:#000">i</span><span style="color:#000">]</span>;
</span></span><span style="display:flex;"><span>                <span style="color:#000">action</span>.<span style="color:#836c28">accept</span>(<span style="color:#000">e</span>);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            <span style="color:#a90d91">if</span> (<span style="color:#000">lst</span>.<span style="color:#836c28">modCount</span> <span style="color:#000">==</span> <span style="color:#000">mc</span>)
</span></span><span style="display:flex;"><span>                <span style="color:#a90d91">return</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">throw</span> <span style="color:#a90d91">new</span> <span style="color:#000">ConcurrentModificationException</span>();
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><div class="flex align-center gdoc-page__anchorwrap">
    <h2 id="5610-public-long-estimatesize"
    >
        56.10 public long estimateSize()
    </h2>
    <a data-clipboard-text="https://hongmao.run/jdk8-src-note/java/util/ArrayList/#5610-public-long-estimatesize" class="gdoc-page__anchor clip flex align-center" title="锚定到： 56.10 public long estimateSize()" aria-label="锚定到： 56.10 public long estimateSize()" href="#5610-public-long-estimatesize">
        <svg class="gdoc-icon gdoc_link"><use xlink:href="#gdoc_link"></use></svg>
    </a>
</div>
<p>获取当前拆分器还未进行操作的元素数量。</p>
<p>源码如下：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#a90d91">public</span> <span style="color:#a90d91">long</span> <span style="color:#000">estimateSize</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// 所有获取围栏位置，然后减去当前索引</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">return</span> (<span style="color:#a90d91">long</span>) (<span style="color:#000">getFence</span>() <span style="color:#000">-</span> <span style="color:#000">index</span>);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><div class="flex align-center gdoc-page__anchorwrap">
    <h2 id="5611-public-int-characteristics"
    >
        56.11 public int characteristics()
    </h2>
    <a data-clipboard-text="https://hongmao.run/jdk8-src-note/java/util/ArrayList/#5611-public-int-characteristics" class="gdoc-page__anchor clip flex align-center" title="锚定到： 56.11 public int characteristics()" aria-label="锚定到： 56.11 public int characteristics()" href="#5611-public-int-characteristics">
        <svg class="gdoc-icon gdoc_link"><use xlink:href="#gdoc_link"></use></svg>
    </a>
</div>
<p>该方法是返回当前拆分器的特征值，就<code>ArrayListSpliterator</code>而言，其特征值有：<code>Spliterator.ORDERED</code>、<code>Spliterator.SIZED</code>、<code>Spliterator.SUBSIZED</code>。</p>
<p>源码如下：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#a90d91">public</span> <span style="color:#a90d91">int</span> <span style="color:#000">characteristics</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">return</span> <span style="color:#000">Spliterator</span>.<span style="color:#836c28">ORDERED</span> <span style="color:#000">|</span> <span style="color:#000">Spliterator</span>.<span style="color:#836c28">SIZED</span> <span style="color:#000">|</span> <span style="color:#000">Spliterator</span>.<span style="color:#836c28">SUBSIZED</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><hr>
<div class="flex align-center gdoc-page__anchorwrap">
    <h1 id="57-public-boolean-removeifpredicate-super-e-filter"
    >
        57. public boolean removeIf(Predicate&lt;? super E&gt; filter)
    </h1>
    <a data-clipboard-text="https://hongmao.run/jdk8-src-note/java/util/ArrayList/#57-public-boolean-removeifpredicate-super-e-filter" class="gdoc-page__anchor clip flex align-center" title="锚定到： 57. public boolean removeIf(Predicate&lt;? super E&gt; filter)" aria-label="锚定到： 57. public boolean removeIf(Predicate&lt;? super E&gt; filter)" href="#57-public-boolean-removeifpredicate-super-e-filter">
        <svg class="gdoc-icon gdoc_link"><use xlink:href="#gdoc_link"></use></svg>
    </a>
</div>
<p>参数为一个断言，该方法即对当前列表的每个元素执行该断言的<code>test</code>方法，命中的则在当前列表中删除，最后返回的是是否删除了本列表的元素。</p>
<p>源码如下：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#000">@Override</span>
</span></span><span style="display:flex;"><span><span style="color:#a90d91">public</span> <span style="color:#a90d91">boolean</span> <span style="color:#000">removeIf</span>(<span style="color:#000">Predicate</span><span style="color:#000">&lt;?</span> <span style="color:#a90d91">super</span> <span style="color:#000">E</span><span style="color:#000">&gt;</span> <span style="color:#000">filter</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#000">Objects</span>.<span style="color:#836c28">requireNonNull</span>(<span style="color:#000">filter</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// figure out which elements are to be removed</span>
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// any exception thrown from the filter predicate at this stage</span>
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// will leave the collection unmodified</span>
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// 找出要删除哪些元素，在此阶段从断言中抛出的任何异常都不会使集合改变</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">int</span> <span style="color:#000">removeCount</span> <span style="color:#000">=</span> <span style="color:#000">0</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// 声明一个BitSet，用于存储要删除元素的索引</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">final</span> <span style="color:#000">BitSet</span> <span style="color:#000">removeSet</span> <span style="color:#000">=</span> <span style="color:#a90d91">new</span> <span style="color:#000">BitSet</span>(<span style="color:#000">size</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">final</span> <span style="color:#a90d91">int</span> <span style="color:#000">expectedModCount</span> <span style="color:#000">=</span> <span style="color:#000">modCount</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">final</span> <span style="color:#a90d91">int</span> <span style="color:#000">size</span> <span style="color:#000">=</span> <span style="color:#a90d91">this</span>.<span style="color:#836c28">size</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// 从头开始遍历列表，先找出符合删除条件的元素索引</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">for</span> (<span style="color:#a90d91">int</span> <span style="color:#000">i</span><span style="color:#000">=</span><span style="color:#000">0</span>; <span style="color:#000">modCount</span> <span style="color:#000">==</span> <span style="color:#000">expectedModCount</span> <span style="color:#000">&amp;&amp;</span> <span style="color:#000">i</span> <span style="color:#000">&lt;</span> <span style="color:#000">size</span>; <span style="color:#000">i</span><span style="color:#000">++</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#000">@SuppressWarnings</span>(<span style="color:#c41a16">&#34;unchecked&#34;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#177500">// 取出当前迭代到的元素</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a90d91">final</span> <span style="color:#000">E</span> <span style="color:#000">element</span> <span style="color:#000">=</span> (<span style="color:#000">E</span>) <span style="color:#000">elementData</span><span style="color:#000">[</span><span style="color:#000">i</span><span style="color:#000">]</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#177500">// 对取出的元素执行给定的测试</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a90d91">if</span> (<span style="color:#000">filter</span>.<span style="color:#836c28">test</span>(<span style="color:#000">element</span>)) {
</span></span><span style="display:flex;"><span>            <span style="color:#177500">// 若满足条件，将该索引记录到removeSet，并将删除数量加1</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">removeSet</span>.<span style="color:#836c28">set</span>(<span style="color:#000">i</span>);
</span></span><span style="display:flex;"><span>            <span style="color:#000">removeCount</span><span style="color:#000">++</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">if</span> (<span style="color:#000">modCount</span> <span style="color:#000">!=</span> <span style="color:#000">expectedModCount</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#a90d91">throw</span> <span style="color:#a90d91">new</span> <span style="color:#000">ConcurrentModificationException</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// shift surviving elements left over the spaces left by removed elements</span>
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// 将剩下的元素移动到已删除元素留下的空间上</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">final</span> <span style="color:#a90d91">boolean</span> <span style="color:#000">anyToRemove</span> <span style="color:#000">=</span> <span style="color:#000">removeCount</span> <span style="color:#000">&gt;</span> <span style="color:#000">0</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// 上面找到了要删除的元素才执行下面的操作</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">if</span> (<span style="color:#000">anyToRemove</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#177500">// 计算出新的列表大小</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a90d91">final</span> <span style="color:#a90d91">int</span> <span style="color:#000">newSize</span> <span style="color:#000">=</span> <span style="color:#000">size</span> <span style="color:#000">-</span> <span style="color:#000">removeCount</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#177500">// 遍历列表，直到新的列表大小位置处</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a90d91">for</span> (<span style="color:#a90d91">int</span> <span style="color:#000">i</span><span style="color:#000">=</span><span style="color:#000">0</span>, <span style="color:#000">j</span><span style="color:#000">=</span><span style="color:#000">0</span>; (<span style="color:#000">i</span> <span style="color:#000">&lt;</span> <span style="color:#000">size</span>) <span style="color:#000">&amp;&amp;</span> (<span style="color:#000">j</span> <span style="color:#000">&lt;</span> <span style="color:#000">newSize</span>); <span style="color:#000">i</span><span style="color:#000">++</span>, <span style="color:#000">j</span><span style="color:#000">++</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#177500">// 找到下一个未删除的元素索引</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">i</span> <span style="color:#000">=</span> <span style="color:#000">removeSet</span>.<span style="color:#836c28">nextClearBit</span>(<span style="color:#000">i</span>);
</span></span><span style="display:flex;"><span>            <span style="color:#177500">// 将该索引位置的元素复制到j位置</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">elementData</span><span style="color:#000">[</span><span style="color:#000">j</span><span style="color:#000">]</span> <span style="color:#000">=</span> <span style="color:#000">elementData</span><span style="color:#000">[</span><span style="color:#000">i</span><span style="color:#000">]</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#177500">// 将新列表尾部的元素都置为null（这些元素都已被复制到前面，覆盖了前面被删掉的元素）</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a90d91">for</span> (<span style="color:#a90d91">int</span> <span style="color:#000">k</span><span style="color:#000">=</span><span style="color:#000">newSize</span>; <span style="color:#000">k</span> <span style="color:#000">&lt;</span> <span style="color:#000">size</span>; <span style="color:#000">k</span><span style="color:#000">++</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#000">elementData</span><span style="color:#000">[</span><span style="color:#000">k</span><span style="color:#000">]</span> <span style="color:#000">=</span> <span style="color:#a90d91">null</span>;  <span style="color:#177500">// Let gc do its work</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#177500">// 将新列表的大小赋值给当前列表大小</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a90d91">this</span>.<span style="color:#836c28">size</span> <span style="color:#000">=</span> <span style="color:#000">newSize</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#177500">// 执行并发修改检查</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a90d91">if</span> (<span style="color:#000">modCount</span> <span style="color:#000">!=</span> <span style="color:#000">expectedModCount</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#a90d91">throw</span> <span style="color:#a90d91">new</span> <span style="color:#000">ConcurrentModificationException</span>();
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#000">modCount</span><span style="color:#000">++</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">return</span> <span style="color:#000">anyToRemove</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>如下为示例：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#000">@Test</span>
</span></span><span style="display:flex;"><span><span style="color:#a90d91">public</span> <span style="color:#a90d91">void</span> <span style="color:#000">testRemoveIf</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#000">List</span><span style="color:#000">&lt;</span><span style="color:#000">Integer</span><span style="color:#000">&gt;</span> <span style="color:#000">list</span> <span style="color:#000">=</span> <span style="color:#a90d91">new</span> <span style="color:#000">ArrayList</span><span style="color:#000">&lt;&gt;</span>();
</span></span><span style="display:flex;"><span>    <span style="color:#000">list</span>.<span style="color:#836c28">add</span>(<span style="color:#000">1</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#000">list</span>.<span style="color:#836c28">add</span>(<span style="color:#000">2</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#000">list</span>.<span style="color:#836c28">add</span>(<span style="color:#000">3</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#000">list</span>.<span style="color:#836c28">add</span>(<span style="color:#000">4</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#000">list</span>.<span style="color:#836c28">add</span>(<span style="color:#000">5</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#000">list</span>.<span style="color:#836c28">removeIf</span>(<span style="color:#000">l</span> <span style="color:#000">-&gt;</span> <span style="color:#000">l</span> <span style="color:#000">&gt;</span><span style="color:#000">1</span> <span style="color:#000">&amp;&amp;</span> <span style="color:#000">l</span> <span style="color:#000">&lt;</span> <span style="color:#000">4</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#000">System</span>.<span style="color:#836c28">out</span>.<span style="color:#836c28">println</span>(<span style="color:#000">list</span>);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>输出：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#000">[</span>1, 4, 5<span style="color:#000">]</span>
</span></span></code></pre></div><hr>
<div class="flex align-center gdoc-page__anchorwrap">
    <h1 id="58-public-void-replaceallunaryoperatorlte-operator"
    >
        58. public void replaceAll(UnaryOperator&lt;E&gt; operator)
    </h1>
    <a data-clipboard-text="https://hongmao.run/jdk8-src-note/java/util/ArrayList/#58-public-void-replaceallunaryoperatorlte-operator" class="gdoc-page__anchor clip flex align-center" title="锚定到： 58. public void replaceAll(UnaryOperator&lt;E&gt; operator)" aria-label="锚定到： 58. public void replaceAll(UnaryOperator&lt;E&gt; operator)" href="#58-public-void-replaceallunaryoperatorlte-operator">
        <svg class="gdoc-icon gdoc_link"><use xlink:href="#gdoc_link"></use></svg>
    </a>
</div>
<p>对列表中每个元素执行参数中指定的操作，并使用此操作获得的值代替当前位置上的元素。</p>
<p>源码如下：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#000">@Override</span>
</span></span><span style="display:flex;"><span><span style="color:#000">@SuppressWarnings</span>(<span style="color:#c41a16">&#34;unchecked&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#a90d91">public</span> <span style="color:#a90d91">void</span> <span style="color:#000">replaceAll</span>(<span style="color:#000">UnaryOperator</span><span style="color:#000">&lt;</span><span style="color:#000">E</span><span style="color:#000">&gt;</span> <span style="color:#000">operator</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#000">Objects</span>.<span style="color:#836c28">requireNonNull</span>(<span style="color:#000">operator</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">final</span> <span style="color:#a90d91">int</span> <span style="color:#000">expectedModCount</span> <span style="color:#000">=</span> <span style="color:#000">modCount</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">final</span> <span style="color:#a90d91">int</span> <span style="color:#000">size</span> <span style="color:#000">=</span> <span style="color:#a90d91">this</span>.<span style="color:#836c28">size</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// 遍历当前列表</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">for</span> (<span style="color:#a90d91">int</span> <span style="color:#000">i</span><span style="color:#000">=</span><span style="color:#000">0</span>; <span style="color:#000">modCount</span> <span style="color:#000">==</span> <span style="color:#000">expectedModCount</span> <span style="color:#000">&amp;&amp;</span> <span style="color:#000">i</span> <span style="color:#000">&lt;</span> <span style="color:#000">size</span>; <span style="color:#000">i</span><span style="color:#000">++</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#177500">// 对每个元素执行给定的操作，使用计算出的结果替代当前元素</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">elementData</span><span style="color:#000">[</span><span style="color:#000">i</span><span style="color:#000">]</span> <span style="color:#000">=</span> <span style="color:#000">operator</span>.<span style="color:#836c28">apply</span>((<span style="color:#000">E</span>) <span style="color:#000">elementData</span><span style="color:#000">[</span><span style="color:#000">i</span><span style="color:#000">]</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">if</span> (<span style="color:#000">modCount</span> <span style="color:#000">!=</span> <span style="color:#000">expectedModCount</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#a90d91">throw</span> <span style="color:#a90d91">new</span> <span style="color:#000">ConcurrentModificationException</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#000">modCount</span><span style="color:#000">++</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>如下所示：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#000">@Test</span>
</span></span><span style="display:flex;"><span><span style="color:#a90d91">public</span> <span style="color:#a90d91">void</span> <span style="color:#000">testReplaceAll</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#000">List</span><span style="color:#000">&lt;</span><span style="color:#000">Integer</span><span style="color:#000">&gt;</span> <span style="color:#000">list</span> <span style="color:#000">=</span> <span style="color:#a90d91">new</span> <span style="color:#000">ArrayList</span><span style="color:#000">&lt;&gt;</span>();
</span></span><span style="display:flex;"><span>    <span style="color:#000">list</span>.<span style="color:#836c28">add</span>(<span style="color:#000">1</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#000">list</span>.<span style="color:#836c28">add</span>(<span style="color:#000">2</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#000">list</span>.<span style="color:#836c28">add</span>(<span style="color:#000">3</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#000">list</span>.<span style="color:#836c28">add</span>(<span style="color:#000">4</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#000">list</span>.<span style="color:#836c28">add</span>(<span style="color:#000">5</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#000">list</span>.<span style="color:#836c28">replaceAll</span>(<span style="color:#000">i</span> <span style="color:#000">-&gt;</span> <span style="color:#000">i</span> <span style="color:#000">*</span> <span style="color:#000">5</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#000">System</span>.<span style="color:#836c28">out</span>.<span style="color:#836c28">println</span>(<span style="color:#000">list</span>);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>输出：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#000">[</span>5, 10, 15, 20, 25<span style="color:#000">]</span>
</span></span></code></pre></div><hr>
<div class="flex align-center gdoc-page__anchorwrap">
    <h1 id="59-public-void-sortcomparator-super-e-c"
    >
        59. public void sort(Comparator&lt;? super E&gt; c)
    </h1>
    <a data-clipboard-text="https://hongmao.run/jdk8-src-note/java/util/ArrayList/#59-public-void-sortcomparator-super-e-c" class="gdoc-page__anchor clip flex align-center" title="锚定到： 59. public void sort(Comparator&lt;? super E&gt; c)" aria-label="锚定到： 59. public void sort(Comparator&lt;? super E&gt; c)" href="#59-public-void-sortcomparator-super-e-c">
        <svg class="gdoc-icon gdoc_link"><use xlink:href="#gdoc_link"></use></svg>
    </a>
</div>
<p>基于参数中指定的比较器，对当前列表进行排序。</p>
<p>源码如下：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#000">@Override</span>
</span></span><span style="display:flex;"><span><span style="color:#000">@SuppressWarnings</span>(<span style="color:#c41a16">&#34;unchecked&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#a90d91">public</span> <span style="color:#a90d91">void</span> <span style="color:#000">sort</span>(<span style="color:#000">Comparator</span><span style="color:#000">&lt;?</span> <span style="color:#a90d91">super</span> <span style="color:#000">E</span><span style="color:#000">&gt;</span> <span style="color:#000">c</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">final</span> <span style="color:#a90d91">int</span> <span style="color:#000">expectedModCount</span> <span style="color:#000">=</span> <span style="color:#000">modCount</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// 使用Arrays的sort方法对当前列表的元素数组执行排序</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">Arrays</span>.<span style="color:#836c28">sort</span>((<span style="color:#000">E</span><span style="color:#000">[]</span>) <span style="color:#000">elementData</span>, <span style="color:#000">0</span>, <span style="color:#000">size</span>, <span style="color:#000">c</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">if</span> (<span style="color:#000">modCount</span> <span style="color:#000">!=</span> <span style="color:#000">expectedModCount</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#a90d91">throw</span> <span style="color:#a90d91">new</span> <span style="color:#000">ConcurrentModificationException</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#000">modCount</span><span style="color:#000">++</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>如下所示：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#000">@Test</span>
</span></span><span style="display:flex;"><span><span style="color:#a90d91">public</span> <span style="color:#a90d91">void</span> <span style="color:#000">testSort</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#000">List</span><span style="color:#000">&lt;</span><span style="color:#000">Integer</span><span style="color:#000">&gt;</span> <span style="color:#000">list</span> <span style="color:#000">=</span> <span style="color:#a90d91">new</span> <span style="color:#000">ArrayList</span><span style="color:#000">&lt;&gt;</span>();
</span></span><span style="display:flex;"><span>    <span style="color:#000">list</span>.<span style="color:#836c28">add</span>(<span style="color:#000">1</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#000">list</span>.<span style="color:#836c28">add</span>(<span style="color:#000">2</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#000">list</span>.<span style="color:#836c28">add</span>(<span style="color:#000">3</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#000">list</span>.<span style="color:#836c28">add</span>(<span style="color:#000">4</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#000">list</span>.<span style="color:#836c28">add</span>(<span style="color:#000">5</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#000">list</span>.<span style="color:#836c28">sort</span>(<span style="color:#000">Comparator</span>.<span style="color:#836c28">comparingInt</span>(<span style="color:#000">i</span> <span style="color:#000">-&gt;</span> <span style="color:#000">-</span><span style="color:#000">i</span>));
</span></span><span style="display:flex;"><span>    <span style="color:#000">System</span>.<span style="color:#836c28">out</span>.<span style="color:#836c28">println</span>(<span style="color:#000">list</span>);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>输出：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#000">[</span>5, 4, 3, 2, 1<span style="color:#000">]</span>
</span></span></code></pre></div>
  </article>



          
          
          <div class="gdoc-page__footer flex flex-wrap justify-between">
            
              








  
  

  
    
    

    
    
      
      
      

      
        
      
      

      

      

      
    

    
    
      
  
  

  
    
    

    
    
      
      
      

      
        
      
      

      

      

      
    

    
    
      
  
  

  
    
    

    
    
      
      
      

      
        
      
      

      

      

      
    

    
    
  

    
  
    
    

    
    
      
      
      

      
        
      
      

      

      

      
    

    
    
      
  
  

  
    
    

    
    
      
      
      

      
        
      
      

      

      

      
    

    
    
      
  
  

  
    
    

    
    
      
      
      

      
        
      
      

      

      

      
    

    
    
  

    
  
    
    

    
    
      
      
      

      
        
      
      

      

      

      
    

    
    
  

    
  
    
    

    
    
      
      
      

      
        
      
      

      

      

      
    

    
    
      
  
  

  
    
    

    
    
      
      
      

      
        
      
      

      

      

      
    

    
    
  
    
    

    
    
      
      
      

      
        
      
      

      

      

      
    

    
    
  
    
    

    
    
      
      
      

      
        
      
      

      

      

      
    

    
    
  
    
    

    
    
      
      
      

      
        
      
      

      

      

      
    

    
    
  
    
    

    
    
      
      
      

      
        
      
      

      

      

      
    

    
    
  
    
    

    
    
      
      
      

      
        
      
      

      

      

      
    

    
    
  
    
    

    
    
      
      
      

      
        
      
      

      

      

      
    

    
    
  

    
  
    
    

    
    
      
      
      

      
        
      
      

      

      

      
    

    
    
      
  
  

  
    
    

    
    
      
      
      

      
        
      
      

      

      

      
    

    
    
  
    
    

    
    
      
      
      

      
        
      
      

      

      

      
    

    
    
  
    
    

    
    
      
      
      

      
        
      
      

      

      

      
    

    
    
  
    
    

    
    
      
      
      

      
        
      
      

      

      

      
    

    
    
  
    
    

    
    
      
      
      

      
        
      
      

      

      

      
    

    
    
  
    
    

    
    
      
      
      

      
        
      
      

      

      
        
        
      

      
    

    
    
  
    
    

    
    
      
      
      

      
        
      
      

      
        
        
      

      

      
    

    
    
  
    
    

    
    
      
      
      

      
        
      
      

      

      

      
    

    
    
  
    
    

    
    
      
      
      

      
        
      
      

      

      

      
    

    
    
  
    
    

    
    
      
      
      

      
        
      
      

      

      

      
    

    
    
  
    
    

    
    
      
      
      

      
        
      
      

      

      

      
    

    
    
  
    
    

    
    
      
      
      

      
        
      
      

      

      

      
    

    
    
  
    
    

    
    
      
      
      

      
        
      
      

      

      

      
    

    
    
  
    
    

    
    
      
      
      

      
        
      
      

      

      

      
    

    
    
  
    
    

    
    
      
      
      

      
        
      
      

      

      

      
    

    
    
  
    
    

    
    
      
      
      

      
        
      
      

      

      

      
    

    
    
  

    
  

    
  
    
    

    
    
      
      
      

      
        
      
      

      

      

      
    

    
    
      
  
  

  
    
    

    
    
      
      
      

      
        
      
      

      

      

      
    

    
    
      
  
  

  
    
    

    
    
      
      
      

      
        
      
      

      

      

      
    

    
    
  

    
  

    
  




<span class="gdoc-page__nav">
  
    <a
      class="gdoc-page__nav--prev flex align-center"
      href="/jdk8-src-note/java/util/AbstractSequentialList/"
      title="AbstractSequentialList"
    >
      <i class="gdoc-icon">gdoc_arrow_left_alt</i>
      AbstractSequentialList
    </a>
  
</span>
<span class="gdoc-page__nav">
  
    <a
      class="gdoc-page__nav--next flex align-center"
      href="/jdk8-src-note/java/util/Collection/"
      title="Collection"
    >
      Collection
      <i class="gdoc-icon">gdoc_arrow_right_alt</i>
    </a>
  
</span>

            
          </div>
          
        </div>
      </main>

      <footer class="gdoc-footer">
  <nav class="container flex">
    <div>
      <section class="flex flex-wrap align-center">
        <span class="gdoc-footer__item gdoc-footer__item--row">
          基于 <a href="https://gohugo.io/" class="gdoc-footer__link">Hugo</a> <svg class="gdoc-icon gdoc_heart"><use xlink:href="#gdoc_heart"></use></svg> 制作

        </span>
        
        
      </section>
      
    </div>
    
      <div class="flex flex-25 justify-end">
        <span class="gdoc-footer__item text-right">
          <a class="gdoc-footer__link fake-link" href="#" aria-label="回到顶部">
            <svg class="gdoc-icon gdoc_keyboard_arrow_up">
              <use xlink:href="#gdoc_keyboard_arrow_up"></use>
            </svg>
            <span class="hidden-mobile">回到顶部</span>
          </a>
        </span>
      </div>
    
  </nav>
</footer>

    </div>

    
  <script defer src="/jdk8-src-note/js/search-95c697e2.bundle.min.js"></script>

  </body>
</html>
